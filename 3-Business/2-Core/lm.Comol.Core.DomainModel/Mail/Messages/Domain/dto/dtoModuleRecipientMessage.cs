using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using lm.Comol.Core.DomainModel;

namespace lm.Comol.Core.Mail.Messages
{
    [Serializable]
    public class dtoModuleRecipientMessage 
    {
        public String MailAddress;
        public String DisplayName;

        public virtual long IdAgency { get; set; }
        public virtual String AgencyName { get; set; }

        /// <summary>
        /// person info
        /// </summary>
        public virtual String Name { get; set; }
        public virtual String Surname { get; set; }
        public virtual Int32 IdPerson { get; set; }
        public virtual Int32 IdProfileType { get; set; }
        public virtual Boolean IsInternal { get { return IdPerson > 0; } }

        public virtual String RoleName { get; set; }
        public virtual String ProfileTypeName { get; set; }
        public virtual Int32 IdRole { get; set; }
        public virtual Boolean IsAutoGeneratedPerson { get; set; }

        /// <summary>
        /// Message info
        /// </summary>
        public virtual dtoUserMessageInfo Message { get; set; }
        //public virtual Int32 IdLanguage { get { return (Message == null) ? 0 : Message.IdLanguage; } }
        //public virtual String CodeLanguage { get { return (Message == null) ? "" : Message.LanguageCode; } }


        public virtual long IdRecipient { get; set; }
        //public virtual RecipientType Type { get; set; }

        private String BaseFirstLetter { get { return (!String.IsNullOrEmpty(DisplayName)) ? DisplayName.Substring(0, 1).ToLower() : (!String.IsNullOrEmpty(MailAddress)) ? MailAddress.Substring(0, 1).ToLower() : ""; } }

      
        //public virtual String ModuleCode { get; set; }
        public virtual long IdUserModule { get; set; }
        //public virtual Boolean IsFromModule { get { return !String.IsNullOrEmpty(ModuleCode); } }

        //public virtual long IdModuleObject { get; set; }
        //public virtual Int32 IdModuleType { get; set; }


        public String FirstLetter { get { return (!String.IsNullOrEmpty(Surname)) ? Surname.Trim().Substring(0, 1).ToLower() : BaseFirstLetter; } } 
       
        public dtoModuleRecipientMessage()
            : base()
        {

        }
        public dtoModuleRecipientMessage(long id)
        {
            IdRecipient = id;
        }
        //public dtoModuleRecipientMessage(lm.Comol.Core.Mail.Messages.dtoModuleRecipientMessage obj)
        //    : base(obj.Id)
        //{
        //    Deleted = obj.Deleted;
        //    MessageNumber = obj.MessageNumber;
        //    IdAgency = obj.IdAgency;
        //    AgencyName = obj.AgencyName;
        //    Message = obj.Message;
        //    IdLanguage = obj.IdLanguage;
        //    CodeLanguage = obj.CodeLanguage;
        //    Type = obj.Type;
        //    IdPerson = obj.IdPerson;
        //    ModuleCode = obj.ModuleCode;
        //    IdUserModule = obj.IdUserModule;
        //    MailAddress = obj.MailAddress;
        //    if (String.IsNullOrEmpty(obj.DisplayName))
        //        DisplayName = obj.MailAddress;
        //    else
        //        DisplayName = obj.DisplayName;
        //}
        //public dtoModuleRecipientMessage(ModuleObject obj, Person p, String moduleCode = "", String anonymousUser = "")
        //{
        //    MessageNumber = 0;
        //    IdLanguage = p.LanguageID;
        //    Type = Core.Mail.RecipientType.BCC;
        //    IdPerson = p.Id;
        //    ModuleCode = moduleCode;
        //    if (p.TypeID == (int)UserTypeStandard.Guest || p.TypeID == (int)UserTypeStandard.PublicUser)
        //    {
        //        MailAddress = "";
        //        DisplayName = anonymousUser;
        //    }
        //    else
        //    {
        //        MailAddress = p.Mail;
        //        DisplayName = p.SurnameAndName;
        //    }
        //    Name = p.Name;
        //    Surname = p.Surname;
        //    IdProfileType = p.TypeID;
        //    IsAutoGeneratedPerson = true;
        //    IdModuleObject = obj.ObjectLongID;
        //    IdModuleType = obj.ObjectTypeID;
        //}
        //public dtoModuleRecipientMessage(ModuleObject obj, Person p, Role role, String moduleCode = "", String anonymousUser = "")
        //    : this(obj,p, moduleCode, anonymousUser)
        //{
        //    IsAutoGeneratedPerson = true;
        //    IdRole= (role==null) ? 0 : role.Id;
        //}
        public void UpdatePersonInfo(Person p, String anonymousUser="")
        {
            if (p == null)
            {
                IdProfileType = (int)UserTypeStandard.Guest;
                MailAddress = "";
                DisplayName = anonymousUser;
                Name = "";
                Surname = "";
            }
            else
            {
                if (p.TypeID == (int)UserTypeStandard.Guest || p.TypeID == (int)UserTypeStandard.PublicUser)
                {
                    MailAddress = "";
                    DisplayName = anonymousUser;
                }
                else
                {
                    MailAddress = p.Mail;
                    DisplayName = p.SurnameAndName;
                }
                Name = p.Name;
                Surname = p.Surname;
                IdProfileType = p.TypeID;
            }
        }
        public void UpdateAgencyInfo(long id, String name)
        {
            IdAgency = id;
            AgencyName = name;
        }
    }
}
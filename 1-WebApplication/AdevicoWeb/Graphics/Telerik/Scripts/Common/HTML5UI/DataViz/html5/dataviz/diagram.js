(function(b,a){a(["./kendo.data","./kendo.draganddrop","./kendo.userevents","./kendo.mobile.scroller","./kendo.drawing","./kendo.core","./kendo.dataviz.core","./kendo.toolbar","./kendo.editable","./kendo.window","./kendo.dropdownlist","./kendo.dataviz.themes"],b);
})(function(){(function(a,m){var j=window.kendo,e=j.dataviz.diagram={},b=j.Class,d=j.deepExtend,i=a.isArray,g=1e-06;
var n={};
d(n,{isNearZero:function(o){return Math.abs(o)<g;
},isDefined:function(o){return typeof o!=="undefined";
},isUndefined:function(o){return(typeof o==="undefined")||o===null;
},isObject:function(o){return o===Object(o);
},has:function(p,o){return Object.hasOwnProperty.call(p,o);
},isString:function(o){return Object.prototype.toString.call(o)=="[object String]";
},isBoolean:function(o){return Object.prototype.toString.call(o)=="[object Boolean]";
},isType:function(o,p){return Object.prototype.toString.call(o)=="[object "+p+"]";
},isNumber:function(o){return !isNaN(parseFloat(o))&&isFinite(o);
},isEmpty:function(p){if(p===null){return true;
}if(i(p)||n.isString(p)){return p.length===0;
}for(var o in p){if(n.has(p,o)){return false;
}}return true;
},simpleExtend:function(o,q){if(!n.isObject(q)){return;
}for(var p in q){o[p]=q[p];
}},initArray:function c(q,r){var o=[];
for(var p=0;
p<q;
++p){o[p]=r;
}return o;
},serializePoints:function(r){var s=[];
for(var o=0;
o<r.length;
o++){var q=r[o];
s.push(q.x+";"+q.y);
}return s.join(";");
},deserializePoints:function(q){var r=q.split(";"),p=[];
if(r.length%2!==0){throw"Not an array of points.";
}for(var o=0;
o<r.length;
o+=2){p.push(new e.Point(parseInt(r[o],10),parseInt(r[o+1],10)));
}return p;
},randomInteger:function(o,p){return parseInt(Math.floor(Math.random()*p)+o,10);
},DFT:function(o,p){p(o);
if(o.childNodes){for(var q=0;
q<o.childNodes.length;
q++){var r=o.childNodes[q];
this.DFT(r,p);
}}},getMatrixAngle:function(o){if(o===null||o.d===0){return 0;
}return Math.atan2(o.b,o.d)*180/Math.PI;
},getMatrixScaling:function(o){var p=Math.sqrt(o.a*o.a+o.c*o.c);
var q=Math.sqrt(o.b*o.b+o.d*o.d);
return[p,q];
}});
function k(t,v,u){if(typeof t=="undefined"||typeof v=="undefined"){return[];
}if(u&&n.sign(v-t)!=n.sign(u)){throw"The sign of the increment should allow to reach the stop-value.";
}u=u||1;
t=t||0;
v=v||t;
if((v-t)/u===Infinity){throw"Infinite range defined.";
}var r=[],o=-1,p;
function s(y){var w=1;
while(y*w%1){w*=10;
}return w;
}var q=s(Math.abs(u));
t*=q;
v*=q;
u*=q;
if(t>v&&u>0){u=-u;
}if(u<0){while((p=t+u*++o)>=v){r.push(p/q);
}}else{while((p=t+u*++o)<=v){r.push(p/q);
}}return r;
}function h(s,p){if(s==p){return 0;
}var q=p.x-s.x,r=s.y-p.y,o=Math.atan(q/r);
if(r>=0){return q<0?o+(2*Math.PI):o;
}return o+Math.PI;
}n.sign=function(o){return o?o<0?-1:1:0;
};
n.findAngle=function(o,p){return h(o,p)*180/Math.PI;
};
n.forEach=function(o,q,r){for(var p=0;
p<o.length;
p++){q.call(r,o[p],p,o);
}};
n.any=function(o,q){for(var p=0;
p<o.length;
++p){if(q(o[p])){return o[p];
}}return null;
};
n.remove=function(o,q){var p;
while((p=n.indexOf(o,q))!==-1){o.splice(p,1);
}return o;
};
n.contains=function(o,p){return n.indexOf(o,p)!==-1;
};
n.indexOf=function(o,p){return a.inArray(p,o);
};
n.fold=function(t,s,o,p){var r=arguments.length>2;
for(var q=0;
q<t.length;
q++){var u=t[q];
if(!r){o=u;
r=true;
}else{o=s.call(p,o,u,q,t);
}}if(!r){throw"Reduce of empty array with no initial value";
}return o;
};
n.find=function(o,q,p){var r;
n.any(o,function(u,s,t){if(q.call(p,u,s,t)){r=u;
return true;
}return false;
});
return r;
};
n.first=function(o,p,q){if(o.length===0){return null;
}if(n.isUndefined(p)){return o[0];
}return n.find(o,p,q);
};
n.insert=function(o,p,q){o.splice(q,0,p);
return o;
};
n.all=function(o,r,p){var s=true;
var t;
for(var q=0;
q<o.length;
q++){t=o[q];
s=s&&r.call(p,t,q,o);
if(!s){break;
}}return s;
};
n.clear=function(o){o.splice(0,o.length);
};
n.bisort=function(o,q,s){if(n.isUndefined(o)){throw"First array is not specified.";
}if(n.isUndefined(q)){throw"Second array is not specified.";
}if(o.length!=q.length){throw"The two arrays should have equal length";
}var p=[],r;
for(r=0;
r<o.length;
r++){p.push({x:o[r],y:q[r]});
}if(n.isUndefined(s)){p.sort(function(t,u){return t.x-u.x;
});
}else{p.sort(function(t,u){return s(t.x,u.x);
});
}n.clear(o);
n.clear(q);
for(r=0;
r<p.length;
r++){o.push(p[r].x);
q.push(p[r].y);
}};
n.addRange=function(o,p){o.push.apply(o,p);
};
var f={easeInOut:function(o){return((-Math.cos(o*Math.PI)/2)+0.5);
}};
var l=j.Class.extend({init:function(){this.adapters=[];
this.target=0;
this.tick=0;
this.interval=20;
this.duration=800;
this.lastTime=null;
this.handlers=[];
var o=this;
this.transition=f.easeInOut;
this.timerDelegate=function(){o.onTimerEvent();
};
},addAdapter:function(o){this.adapters.push(o);
},onComplete:function(o){this.handlers.push(o);
},removeHandler:function(o){this.handlers=a.grep(this.handlers,function(p){return p!==o;
});
},trigger:function(){var o=this;
if(this.handlers){n.forEach(this.handlers,function(p){return p.call(o.caller!==null?o.caller:o);
});
}},onStep:function(){},seekTo:function(o){this.seekFromTo(this.tick,o);
},seekFromTo:function(o,p){this.target=Math.max(0,Math.min(1,p));
this.tick=Math.max(0,Math.min(1,o));
this.lastTime=new Date().getTime();
if(!this.intervalId){this.intervalId=window.setInterval(this.timerDelegate,this.interval);
}},stop:function(){if(this.intervalId){window.clearInterval(this.intervalId);
this.intervalId=null;
this.trigger();
}},play:function(o){if(this.adapters.length===0){return;
}if(o!==null){this.caller=o;
}this.initState();
this.seekFromTo(0,1);
},reverse:function(){this.seekFromTo(1,0);
},initState:function(){if(this.adapters.length===0){return;
}for(var o=0;
o<this.adapters.length;
o++){this.adapters[o].initState();
}},propagate:function(){var p=this.transition(this.tick);
for(var o=0;
o<this.adapters.length;
o++){this.adapters[o].update(p);
}},onTimerEvent:function(){var p=new Date().getTime();
var q=p-this.lastTime;
this.lastTime=p;
var o=(q/this.duration)*(this.tick<this.target?1:-1);
if(Math.abs(o)>=Math.abs(this.tick-this.target)){this.tick=this.target;
}else{this.tick+=o;
}try{this.propagate();
}finally{this.onStep.call(this);
if(this.target==this.tick){this.stop();
}}}});
j.deepExtend(e,{init:function(o){j.init(o,e.ui);
},Utils:n,Range:k,Ticker:l});
})(window.kendo.jQuery);
(function(a,I){var r=window.kendo,f=r.dataviz.diagram,b=r.Class,e=r.deepExtend,d=r.dataviz,J=f.Utils,A=d.Point2D,p=r.isFunction,c=J.contains,t=a.map;
var m=3,h=1e-06;
e(A.fn,{plus:function(K){return new A(this.x+K.x,this.y+K.y);
},minus:function(K){return new A(this.x-K.x,this.y-K.y);
},offset:function(K){return new A(this.x-K,this.y-K);
},times:function(K){return new A(this.x*K,this.y*K);
},normalize:function(){if(this.length()===0){return new A();
}return this.times(1/this.length());
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},toString:function(){return"("+this.x+","+this.y+")";
},lengthSquared:function(){return(this.x*this.x+this.y*this.y);
},middleOf:function w(K,L){return new A(L.x-K.x,L.y-K.y).times(0.5).plus(K);
},toPolar:function(O){var L=1;
if(O){L=180/Math.PI;
}var K=Math.atan2(Math.abs(this.y),Math.abs(this.x));
var M=Math.PI/2;
var N=this.length();
if(this.x===0){if(this.y===0){return new B(0,0);
}if(this.y>0){return new B(N,L*M);
}if(this.y<0){return new B(N,L*3*M);
}}else{if(this.x>0){if(this.y===0){return new B(N,0);
}if(this.y>0){return new B(N,L*K);
}if(this.y<0){return new B(N,L*(4*M-K));
}}else{if(this.y===0){return new B(N,2*M);
}if(this.y>0){return new B(N,L*(2*M-K));
}if(this.y<0){return new B(N,L*(2*M+K));
}}}},isOnLine:function(K,P){if(K.x>P.x){var O=P;
P=K;
K=O;
}var M=new E(K.x,K.y).inflate(m,m),N=new E(P.x,P.y).inflate(m,m),L,Q;
if(M.union(N).contains(this)){if(K.x===P.x||K.y===P.y){return true;
}else{if(K.y<P.y){L=M.x+(((N.x-M.x)*(this.y-(M.y+M.height)))/((N.y+N.height)-(M.y+M.height)));
Q=(M.x+M.width)+((((N.x+N.width)-(M.x+M.width))*(this.y-M.y))/(N.y-M.y));
}else{L=M.x+(((N.x-M.x)*(this.y-M.y))/(N.y-M.y));
Q=(M.x+M.width)+((((N.x+N.width)-(M.x+M.width))*(this.y-(M.y+M.height)))/((N.y+N.height)-(M.y+M.height)));
}}return(this.x>L&&this.x<Q);
}return false;
}});
e(A,{parse:function(K){var L=K.slice(1,K.length-1),N=L.split(","),M=parseInt(N[0],10),O=parseInt(N[1],10);
if(!isNaN(M)&&!isNaN(O)){return new A(M,O);
}}});
var z=b.extend({init:function(L,K,M){this.point=L;
this.left=K;
this.right=M;
}});
var E=b.extend({init:function(M,N,L,K){this.x=M||0;
this.y=N||0;
this.width=L||0;
this.height=K||0;
},contains:function(K){return((K.x>=this.x)&&(K.x<=(this.x+this.width))&&(K.y>=this.y)&&(K.y<=(this.y+this.height)));
},inflate:function(K,L){if(L===I){L=K;
}this.x-=K;
this.y-=L;
this.width+=2*K+1;
this.height+=2*L+1;
return this;
},offset:function(K,L){var M=K,N=L;
if(K instanceof A){M=K.x;
N=K.y;
}this.x+=M;
this.y+=N;
return this;
},union:function(K){var L=Math.min(this.x,K.x);
var N=Math.min(this.y,K.y);
var M=Math.max((this.x+this.width),(K.x+K.width));
var O=Math.max((this.y+this.height),(K.y+K.height));
return new E(L,N,M-L,O-N);
},center:function(){return new A(this.x+this.width/2,this.y+this.height/2);
},top:function(){return new A(this.x+this.width/2,this.y);
},right:function(){return new A(this.x+this.width,this.y+this.height/2);
},bottom:function(){return new A(this.x+this.width/2,this.y+this.height);
},left:function(){return new A(this.x,this.y+this.height/2);
},topLeft:function(){return new A(this.x,this.y);
},topRight:function(){return new A(this.x+this.width,this.y);
},bottomLeft:function(){return new A(this.x,this.y+this.height);
},bottomRight:function(){return new A(this.x+this.width,this.y+this.height);
},clone:function(){return new E(this.x,this.y,this.width,this.height);
},isEmpty:function(){return !this.width&&!this.height;
},equals:function(K){return this.x===K.x&&this.y===K.y&&this.width===K.width&&this.height===K.height;
},rotatedBounds:function(K){var O=this.clone(),N=this.rotatedPoints(K),P=N[0],Q=N[1],M=N[2],L=N[3];
O.x=Math.min(M.x,P.x,Q.x,L.x);
O.y=Math.min(M.y,P.y,Q.y,L.y);
O.width=Math.max(M.x,P.x,Q.x,L.x)-O.x;
O.height=Math.max(M.y,P.y,Q.y,L.y)-O.y;
return O;
},rotatedPoints:function(K){var O=this,N=O.center(),M=O.bottomRight().rotate(N,360-K),P=O.topLeft().rotate(N,360-K),Q=O.topRight().rotate(N,360-K),L=O.bottomLeft().rotate(N,360-K);
return[P,Q,M,L];
},toString:function(K){K=K||" ";
return this.x+K+this.y+K+this.width+K+this.height;
},scale:function(P,Q,R,K,L){var T=this.topLeft();
var S=this.center();
T.rotate(S,360-L).rotate(K,L);
var M=R.minus(T);
var O=new A(M.x*P,M.y*Q);
var N=M.minus(O);
T=T.plus(N);
T.rotate(K,360-L).rotate(S,L);
this.x=T.x;
this.y=T.y;
this.width*=P;
this.height*=Q;
},zoom:function(K){this.x*=K;
this.y*=K;
this.width*=K;
this.height*=K;
return this;
}});
var H=b.extend({init:function(L,K){this.width=L;
this.height=K;
}});
H.prototype.Empty=new H(0,0);
E.toRect=function(K){if(!(K instanceof E)){K=new E(K.x,K.y,K.width,K.height);
}return K;
};
E.empty=function(){return new E(0,0,0,0);
};
E.fromPoints=function(K,L){if(isNaN(K.x)||isNaN(K.y)||isNaN(L.x)||isNaN(L.y)){throw"Some values are NaN.";
}return new E(Math.min(K.x,L.x),Math.min(K.y,L.y),Math.abs(K.x-L.x),Math.abs(K.y-L.y));
};
function q(K){return Math.abs(K)<h;
}function o(R,K,S,L,M){var T=((K.x-R.x)*(L.y-S.y))-((K.y-R.y)*(L.x-S.x));
if(q(T)){return;
}var N=((R.y-S.y)*(L.x-S.x))-((R.x-S.x)*(L.y-S.y));
var O=((R.y-S.y)*(K.x-R.x))-((R.x-S.x)*(K.y-R.y));
var P=N/T;
var Q=O/T;
if(M&&(P<0||P>1||Q<0||Q>1)){return;
}return new A(R.x+(P*(K.x-R.x)),R.y+(P*(K.y-R.y)));
}var n={lines:function(M,K,N,L){return o(M,K,N,L);
},segments:function(M,K,N,L){return o(M,K,N,L,true);
},rectWithLine:function(L,M,K){return n.segments(M,K,L.topLeft(),L.topRight())||n.segments(M,K,L.topRight(),L.bottomRight())||n.segments(M,K,L.bottomLeft(),L.bottomRight())||n.segments(M,K,L.topLeft(),L.bottomLeft());
},rects:function(P,Q,K){var S=Q.topLeft(),T=Q.topRight(),L=Q.bottomLeft(),M=Q.bottomRight();
var N=Q.center();
if(K){S=S.rotate(N,K);
T=T.rotate(N,K);
L=L.rotate(N,K);
M=M.rotate(N,K);
}var O=P.contains(S)||P.contains(T)||P.contains(L)||P.contains(M)||n.rectWithLine(P,S,T)||n.rectWithLine(P,S,L)||n.rectWithLine(P,T,M)||n.rectWithLine(P,L,M);
if(!O){S=P.topLeft();
T=P.topRight();
L=P.bottomLeft();
M=P.bottomRight();
if(K){var R=360-K;
S=S.rotate(N,R);
T=T.rotate(N,R);
L=L.rotate(N,R);
M=M.rotate(N,R);
}O=Q.contains(S)||Q.contains(T)||Q.contains(L)||Q.contains(M);
}return O;
}};
var F=b.extend({init:function(K){this.container=E.toRect(K);
},align:function(M,K){var L=K.toLowerCase().split(" ");
for(var N=0;
N<L.length;
N++){M=this._singleAlign(M,L[N]);
}return M;
},_singleAlign:function(L,K){if(p(this[K])){return this[K](L);
}else{return L;
}},left:function(K){return this._align(K,this._left);
},center:function(K){return this._align(K,this._center);
},right:function(K){return this._align(K,this._right);
},stretch:function(K){return this._align(K,this._stretch);
},top:function(K){return this._align(K,this._top);
},middle:function(K){return this._align(K,this._middle);
},bottom:function(K){return this._align(K,this._bottom);
},_left:function(K,L){L.x=K.x;
},_center:function(K,L){L.x=((K.width-L.width)/2)||0;
},_right:function(K,L){L.x=K.width-L.width;
},_top:function(K,L){L.y=K.y;
},_middle:function(K,L){L.y=((K.height-L.height)/2)||0;
},_bottom:function(K,L){L.y=K.height-L.height;
},_stretch:function(K,L){L.x=0;
L.y=0;
L.height=K.height;
L.width=K.width;
},_align:function(L,K){L=E.toRect(L);
K(this.container,L);
return L;
}});
var B=b.extend({init:function(L,K){this.r=L;
this.angle=K;
}});
var u=b.extend({init:function(K,L,M,N,O,P){this.a=K||0;
this.b=L||0;
this.c=M||0;
this.d=N||0;
this.e=O||0;
this.f=P||0;
},plus:function(K){this.a+=K.a;
this.b+=K.b;
this.c+=K.c;
this.d+=K.d;
this.e+=K.e;
this.f+=K.f;
},minus:function(K){this.a-=K.a;
this.b-=K.b;
this.c-=K.c;
this.d-=K.d;
this.e-=K.e;
this.f-=K.f;
},times:function(K){return new u(this.a*K.a+this.c*K.b,this.b*K.a+this.d*K.b,this.a*K.c+this.c*K.d,this.b*K.c+this.d*K.d,this.a*K.e+this.c*K.f+this.e,this.b*K.e+this.d*K.f+this.f);
},apply:function(K){return new A(this.a*K.x+this.c*K.y+this.e,this.b*K.x+this.d*K.y+this.f);
},applyRect:function(K){return E.fromPoints(this.apply(K.topLeft()),this.apply(K.bottomRight()));
},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")";
}});
e(u,{fromSVGMatrix:function(L){var K=new u();
K.a=L.a;
K.b=L.b;
K.c=L.c;
K.d=L.d;
K.e=L.e;
K.f=L.f;
return K;
},fromMatrixVector:function(L){var K=new u();
K.a=L.a;
K.b=L.b;
K.c=L.c;
K.d=L.d;
K.e=L.e;
K.f=L.f;
return K;
},fromList:function(L){if(L.length!==6){throw"The given list should consist of six elements.";
}var K=new u();
K.a=L[0];
K.b=L[1];
K.c=L[2];
K.d=L[3];
K.e=L[4];
K.f=L[5];
return K;
},translation:function(L,M){var K=new u();
K.a=1;
K.b=0;
K.c=0;
K.d=1;
K.e=L;
K.f=M;
return K;
},unit:function(){return new u(1,0,0,1,0,0);
},rotation:function(K,M,N){var L=new u();
L.a=Math.cos(K*Math.PI/180);
L.b=Math.sin(K*Math.PI/180);
L.c=-L.b;
L.d=L.a;
L.e=(M-M*L.a+N*L.b)||0;
L.f=(N-N*L.a-M*L.b)||0;
return L;
},scaling:function(L,M){var K=new u();
K.a=L;
K.b=0;
K.c=0;
K.d=M;
K.e=0;
K.f=0;
return K;
},parse:function(M){var L,K;
if(M){M=M.trim();
if(M.slice(0,6).toLowerCase()==="matrix"){K=M.slice(7,M.length-1).trim();
L=K.split(",");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}L=K.split(" ");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}if(M.slice(0,1)==="("&&M.slice(M.length-1)===")"){M=M.substr(1,M.length-1);
}if(M.indexOf(",")>0){L=M.split(",");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}if(M.indexOf(" ")>0){L=M.split(" ");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}}return L;
}});
var v=b.extend({init:function(K,L,M,N,O,P){this.a=K||0;
this.b=L||0;
this.c=M||0;
this.d=N||0;
this.e=O||0;
this.f=P||0;
},fromMatrix:function i(K){var L=new v();
L.a=K.a;
L.b=K.b;
L.c=K.c;
L.d=K.d;
L.e=K.e;
L.f=K.f;
return L;
}});
function y(L,K){var N,O,M;
do{N=Math.random()*2-1;
O=Math.random()*2-1;
M=N*N+O*O;
}while(!M||M>1);
return L+K*N*Math.sqrt(-2*Math.log(M)/M);
}function D(M){if(J.isUndefined(M)){M=10;
}var N="";
var K="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
for(var L=M;
L>0;
--L){N+=K.charAt(Math.round(Math.random()*(K.length-1)));
}return N;
}var j={_distanceToLineSquared:function(O,K,L){function M(R,S){return(R.x-S.x)*(R.x-S.x)+(R.y-S.y)*(R.y-S.y);
}if(K===L){return M(O,K);
}var P=L.x-K.x,Q=L.y-K.y,N=(O.x-K.x)*P+(O.y-K.y)*Q;
if(N<0){return M(K,O);
}N=(L.x-O.x)*P+(L.y-O.y)*Q;
if(N<0){return M(L,O);
}N=(L.x-O.x)*Q-(L.y-O.y)*P;
return N*N/(P*P+Q*Q);
},distanceToLine:function(M,K,L){return Math.sqrt(this._distanceToLineSquared(M,K,L));
},distanceToPolyline:function(M,P){var L=Number.MAX_VALUE;
if(J.isUndefined(P)||P.length===0){return Number.MAX_VALUE;
}for(var Q=0;
Q<P.length-1;
Q++){var N=P[Q];
var O=P[Q+1];
var K=this._distanceToLineSquared(M,N,O);
if(K<L){L=K;
}}return Math.sqrt(L);
}};
var l=r.Class.extend({init:function(){this._buckets=[];
this.length=0;
},add:function(K,M){var L=this._createGetBucket(K);
if(J.isDefined(M)){L.value=M;
}return L;
},get:function(K){if(this._bucketExists(K)){return this._createGetBucket(K);
}return null;
},set:function(K,L){this.add(K,L);
},containsKey:function(K){return this._bucketExists(K);
},remove:function(L){if(this._bucketExists(L)){var K=this._hash(L);
delete this._buckets[K];
this.length--;
return L;
}},forEach:function(L){var N=this._hashes();
for(var O=0,P=N.length;
O<P;
O++){var M=N[O];
var K=this._buckets[M];
if(J.isUndefined(K)){continue;
}L(K);
}},clone:function(){var N=new l();
var M=this._hashes();
for(var O=0,P=M.length;
O<P;
O++){var L=M[O];
var K=this._buckets[L];
if(J.isUndefined(K)){continue;
}N.add(K.key,K.value);
}return N;
},_hashes:function(){var L=[];
for(var K in this._buckets){if(this._buckets.hasOwnProperty(K)){L.push(K);
}}return L;
},_bucketExists:function(L){var K=this._hash(L);
return J.isDefined(this._buckets[K]);
},_createGetBucket:function(M){var L=this._hash(M);
var K=this._buckets[L];
if(J.isUndefined(K)){K={key:M};
this._buckets[L]=K;
this.length++;
}return K;
},_hash:function(K){if(J.isNumber(K)){return K;
}if(J.isString(K)){return this._hashString(K);
}if(J.isObject(K)){return this._objectHashId(K);
}throw"Unsupported key type.";
},_hashString:function(N){var M=0;
if(N.length===0){return M;
}for(var L=0;
L<N.length;
L++){var K=N.charCodeAt(L);
M=((M*32)-M)+K;
}return M;
},_objectHashId:function(L){var K=L._hashId;
if(J.isUndefined(K)){K=D();
L._hashId=K;
}return K;
}});
var g=r.Observable.extend({init:function(K){var M=this;
r.Observable.fn.init.call(M);
this._hashTable=new l();
this.length=0;
if(J.isDefined(K)){if(a.isArray(K)){for(var L=0;
L<K.length;
L++){this.add(K[L]);
}}else{K.forEach(function(N,O){this.add(N,O);
},this);
}}},add:function(L,M){var K=this._hashTable.get(L);
if(!K){K=this._hashTable.add(L);
this.length++;
this.trigger("changed");
}K.value=M;
},set:function(K,L){this.add(K,L);
},get:function(L){var K=this._hashTable.get(L);
if(K){return K.value;
}throw new Error("Cannot find key "+L);
},containsKey:function(K){return this._hashTable.containsKey(K);
},remove:function(K){if(this.containsKey(K)){this.trigger("changed");
this.length--;
return this._hashTable.remove(K);
}},forEach:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.key,M.value);
});
},forEachValue:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.value);
});
},forEachKey:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.key);
});
},keys:function(){var K=[];
this.forEachKey(function(L){K.push(L);
});
return K;
}});
var C=r.Class.extend({init:function(){this._tail=null;
this._head=null;
this.length=0;
},enqueue:function(L){var K={value:L,next:null};
if(!this._head){this._head=K;
this._tail=this._head;
}else{this._tail.next=K;
this._tail=this._tail.next;
}this.length++;
},dequeue:function(){if(this.length<1){throw new Error("The queue is empty.");
}var K=this._head.value;
this._head=this._head.next;
this.length--;
return K;
},contains:function(L){var K=this._head;
while(K){if(K.value===L){return true;
}K=K.next;
}return false;
}});
var G=r.Observable.extend({init:function(K){var L=this;
r.Observable.fn.init.call(L);
this._hashTable=new l();
this.length=0;
if(J.isDefined(K)){if(K instanceof l){K.forEach(function(M){this.add(M);
});
}else{if(K instanceof g){K.forEach(function(M,N){this.add({key:M,value:N});
},this);
}}}},contains:function(K){return this._hashTable.containsKey(K);
},add:function(L){var K=this._hashTable.get(L);
if(!K){this._hashTable.add(L,L);
this.length++;
this.trigger("changed");
}},get:function(K){if(this.contains(K)){return this._hashTable.get(K).value;
}else{return null;
}},hash:function(K){return this._hashTable._hash(K);
},remove:function(K){if(this.contains(K)){this._hashTable.remove(K);
this.length--;
this.trigger("changed");
}},forEach:function(L,K){this._hashTable.forEach(function(M){L(M.value);
},K);
},toArray:function(){var K=[];
this.forEach(function(L){K.push(L);
});
return K;
}});
var x=r.Class.extend({init:function(L,M){this.links=[];
this.outgoing=[];
this.incoming=[];
this.weight=1;
if(J.isDefined(L)){this.id=L;
}else{this.id=D();
}if(J.isDefined(M)){this.associatedShape=M;
var K=M.bounds();
this.width=K.width;
this.height=K.height;
this.x=K.x;
this.y=K.y;
}else{this.associatedShape=null;
}this.data=null;
this.type="Node";
this.shortForm="Node '"+this.id+"'";
this.isVirtual=false;
},isIsolated:function(){return J.isEmpty(this.links);
},bounds:function(K){if(!J.isDefined(K)){return new f.Rect(this.x,this.y,this.width,this.height);
}this.x=K.x;
this.y=K.y;
this.width=K.width;
this.height=K.height;
},isLinkedTo:function(K){var L=this;
return J.any(L.links,function(M){return M.getComplement(L)===K;
});
},getChildren:function(){if(this.outgoing.length===0){return[];
}var K=[];
for(var L=0,M=this.outgoing.length;
L<M;
L++){var N=this.outgoing[L];
K.push(N.getComplement(this));
}return K;
},getParents:function(){if(this.incoming.length===0){return[];
}var N=[];
for(var K=0,L=this.incoming.length;
K<L;
K++){var M=this.incoming[K];
N.push(M.getComplement(this));
}return N;
},clone:function(){var K=new x();
if(J.isDefined(this.weight)){K.weight=this.weight;
}if(J.isDefined(this.balance)){K.balance=this.balance;
}if(J.isDefined(this.owner)){K.owner=this.owner;
}K.associatedShape=this.associatedShape;
K.x=this.x;
K.y=this.y;
K.width=this.width;
K.height=this.height;
return K;
},adjacentTo:function(K){return this.isLinkedTo(K)!==null;
},removeLink:function(K){if(K.source===this){J.remove(this.links,K);
J.remove(this.outgoing,K);
K.source=null;
}if(K.target===this){J.remove(this.links,K);
J.remove(this.incoming,K);
K.target=null;
}},hasLinkTo:function(K){return J.any(this.outgoing,function(L){return L.target===K;
});
},degree:function(){return this.links.length;
},incidentWith:function(K){return c(this.links,K);
},getLinksWith:function(K){return J.all(this.links,function(L){return L.getComplement(this)===K;
},this);
},getNeighbors:function(){var K=[];
J.forEach(this.incoming,function(L){K.push(L.getComplement(this));
},this);
J.forEach(this.outgoing,function(L){K.push(L.getComplement(this));
},this);
return K;
}});
var s=r.Class.extend({init:function(M,O,L,K){if(J.isUndefined(M)){throw"The source of the new link is not set.";
}if(J.isUndefined(O)){throw"The target of the new link is not set.";
}var N,P;
if(J.isString(M)){N=new x(M);
}else{N=M;
}if(J.isString(O)){P=new x(O);
}else{P=O;
}this.source=N;
this.target=P;
this.source.links.push(this);
this.target.links.push(this);
this.source.outgoing.push(this);
this.target.incoming.push(this);
if(J.isDefined(L)){this.id=L;
}else{this.id=D();
}if(J.isDefined(K)){this.associatedConnection=K;
}else{this.associatedConnection=null;
}this.type="Link";
this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'";
},getComplement:function(K){if(this.source!==K&&this.target!==K){throw"The given node is not incident with this link.";
}return this.source===K?this.target:this.source;
},getCommonNode:function(K){if(this.source===K.source||this.source===K.target){return this.source;
}if(this.target===K.source||this.target===K.target){return this.target;
}return null;
},isBridging:function(K,L){return this.source===K&&this.target===L||this.source===L&&this.target===K;
},getNodes:function(){return[this.source,this.target];
},incidentWith:function(K){return this.source===K||this.target===K;
},adjacentTo:function(K){return c(this.source.links,K)||c(this.target.links,K);
},changeSource:function(K){J.remove(this.source.links,this);
J.remove(this.source.outgoing,this);
K.links.push(this);
K.outgoing.push(this);
this.source=K;
},changeTarget:function(K){J.remove(this.target.links,this);
J.remove(this.target.incoming,this);
K.links.push(this);
K.incoming.push(this);
this.target=K;
},changesNodes:function(K,L){if(this.source===K){this.changeSource(L);
}else{if(this.target===K){this.changeTarget(L);
}}},reverse:function(){var K=this.source;
var L=this.target;
this.source=L;
J.remove(K.outgoing,this);
this.source.outgoing.push(this);
this.target=K;
J.remove(L.incoming,this);
this.target.incoming.push(this);
return this;
},directTo:function(K){if(this.source!==K&&this.target!==K){throw"The given node is not incident with this link.";
}if(this.target!==K){this.reverse();
}},createReverseEdge:function(){var K=this.clone();
K.reverse();
K.reversed=true;
return K;
},clone:function(){var K=new s(this.source,this.target);
return K;
}});
var k=r.Class.extend({init:function(K){this.links=[];
this.nodes=[];
this.diagram=null;
this._root=null;
if(J.isDefined(K)){if(J.isString(K)){this.id=K;
}else{this.diagram=K;
this.id=K.id;
}}else{this.id=D();
}this.bounds=new E();
this._hasCachedRelationships=false;
this.type="Graph";
},cacheRelationships:function(K){if(J.isUndefined(K)){K=false;
}if(this._hasCachedRelationships&&!K){return;
}for(var L=0,M=this.nodes.length;
L<M;
L++){var N=this.nodes[L];
N.children=this.getChildren(N);
N.parents=this.getParents(N);
}this._hasCachedRelationships=true;
},assignLevels:function(P,O,Q){if(!P){throw"Start node not specified.";
}if(J.isUndefined(O)){O=0;
}this.cacheRelationships();
if(J.isUndefined(Q)){Q=new g();
J.forEach(this.nodes,function(R){Q.add(R,false);
});
}Q.set(P,true);
P.level=O;
var L=P.children;
for(var M=0,N=L.length;
M<N;
M++){var K=L[M];
if(!K||Q.get(K)){continue;
}this.assignLevels(K,O+1,Q);
}},root:function(L){if(J.isUndefined(L)){if(!this._root){var K=J.first(this.nodes,function(M){return M.incoming.length===0;
});
if(K){return K;
}return J.first(this.nodes);
}else{return this._root;
}}else{this._root=L;
}},getConnectedComponents:function(){this.componentIndex=0;
this.setItemIndices();
var K=J.initArray(this.nodes.length,-1);
for(var O=0;
O<this.nodes.length;
O++){if(K[O]===-1){this._collectConnectedNodes(K,O);
this.componentIndex++;
}}var L=[],N;
for(N=0;
N<this.componentIndex;
++N){L[N]=new k();
}for(N=0;
N<K.length;
++N){var M=L[K[N]];
M.addNodeAndOutgoings(this.nodes[N]);
}L.sort(function(P,Q){return Q.nodes.length-P.nodes.length;
});
return L;
},_collectConnectedNodes:function(M,L){M[L]=this.componentIndex;
var K=this.nodes[L];
J.forEach(K.links,function(N){var O=N.getComplement(K);
var P=O.index;
if(M[P]===-1){this._collectConnectedNodes(M,P);
}},this);
},calcBounds:function(){if(this.isEmpty()){this.bounds=new E();
return this.bounds;
}var K=null;
for(var L=0,M=this.nodes.length;
L<M;
L++){var N=this.nodes[L];
if(!K){K=N.bounds();
}else{K=K.union(N.bounds());
}}this.bounds=K;
return this.bounds;
},getSpanningTree:function(T){var W=new k();
var O=new g(),U,V;
W.root=T.clone();
W.root.level=0;
W.root.id=T.id;
O.add(T,W.root);
T.level=0;
var Y=[];
var S=[];
W.nodes.push(W.root);
Y.push(T);
S.push(T);
var M=1;
while(S.length>0){var Q=S.pop();
for(var R=0;
R<Q.links.length;
R++){var N=Q.links[R];
var K=N.getComplement(Q);
if(c(Y,K)){continue;
}K.level=Q.level+1;
if(M<K.level+1){M=K.level+1;
}if(!c(S,K)){S.push(K);
}if(!c(Y,K)){Y.push(K);
}if(O.containsKey(Q)){U=O.get(Q);
}else{U=Q.clone();
U.level=Q.level;
U.id=Q.id;
O.add(Q,U);
}if(O.containsKey(K)){V=O.get(K);
}else{V=K.clone();
V.level=K.level;
V.id=K.id;
O.add(K,V);
}var P=new s(U,V);
W.addLink(P);
}}var X=[];
for(var L=0;
L<M;
L++){X.push([]);
}J.forEach(W.nodes,function(Z){X[Z.level].push(Z);
});
W.treeLevels=X;
W.cacheRelationships();
return W;
},takeRandomNode:function(K,L){if(J.isUndefined(K)){K=[];
}if(J.isUndefined(L)){L=4;
}if(this.nodes.length===0){return null;
}if(this.nodes.length===1){return c(K,this.nodes[0])?null:this.nodes[0];
}var M=a.grep(this.nodes,function(N){return !c(K,N)&&N.degree()<=L;
});
if(J.isEmpty(M)){return null;
}return M[J.randomInteger(0,M.length)];
},isEmpty:function(){return J.isEmpty(this.nodes);
},isHealthy:function(){return J.all(this.links,function(K){return c(this.nodes,K.source)&&c(this.nodes,K.target);
},this);
},getParents:function(K){if(!this.hasNode(K)){throw"The given node is not part of this graph.";
}return K.getParents();
},getChildren:function(K){if(!this.hasNode(K)){throw"The given node is not part of this graph.";
}return K.getChildren();
},addLink:function(O,P,N){if(J.isUndefined(O)){throw"The source of the link is not defined.";
}if(J.isUndefined(P)){if(J.isDefined(O.type)&&O.type==="Link"){this.addExistingLink(O);
return;
}else{throw"The target of the link is not defined.";
}}var K=this.getNode(O);
if(J.isUndefined(K)){K=this.addNode(O);
}var L=this.getNode(P);
if(J.isUndefined(L)){L=this.addNode(P);
}var M=new s(K,L);
if(J.isDefined(N)){M.owner=N;
}this.links.push(M);
return M;
},removeAllLinks:function(){while(this.links.length>0){var K=this.links[0];
this.removeLink(K);
}},addExistingLink:function(K){if(this.hasLink(K)){return;
}this.links.push(K);
if(this.hasNode(K.source.id)){var L=this.getNode(K.source.id);
K.changeSource(L);
}else{this.addNode(K.source);
}if(this.hasNode(K.target.id)){var M=this.getNode(K.target.id);
K.changeTarget(M);
}else{this.addNode(K.target);
}},hasLink:function(K){if(J.isString(K)){return J.any(this.links,function(L){return L.id===K;
});
}if(K.type==="Link"){return c(this.links,K);
}throw"The given object is neither an identifier nor a Link.";
},getNode:function(K){if(J.isUndefined(K)){throw"No identifier or Node specified.";
}if(J.isString(K)){return J.find(this.nodes,function(L){return L.id==K;
});
}else{if(this.hasNode(K)){return K;
}else{return null;
}}},hasNode:function(K){if(J.isString(K)){return J.any(this.nodes,function(L){return L.id===K;
});
}if(J.isObject(K)){return J.any(this.nodes,function(L){return L===K;
});
}throw"The identifier should be a Node or the Id (string) of a node.";
},removeNode:function(P){var O=P;
if(J.isString(P)){O=this.getNode(P);
}if(J.isDefined(O)){var N=O.links;
O.links=[];
for(var K=0,L=N.length;
K<L;
K++){var M=N[K];
this.removeLink(M);
}J.remove(this.nodes,O);
}else{throw"The identifier should be a Node or the Id (string) of a node.";
}},areConnected:function(K,L){return J.any(this.links,function(M){return M.source==K&&M.target==L||M.source==L&&M.target==K;
});
},removeLink:function(K){J.remove(this.links,K);
J.remove(K.source.outgoing,K);
J.remove(K.source.links,K);
J.remove(K.target.incoming,K);
J.remove(K.target.links,K);
},addNode:function(M,K,N){var L=null;
if(!J.isDefined(M)){throw"No Node or identifier for a new Node is given.";
}if(J.isString(M)){if(this.hasNode(M)){return this.getNode(M);
}L=new x(M);
}else{if(this.hasNode(M)){return this.getNode(M);
}L=M;
}if(J.isDefined(K)){L.bounds(K);
}if(J.isDefined(N)){L.owner=N;
}this.nodes.push(L);
return L;
},addNodeAndOutgoings:function(L){if(!c(this.nodes,L)){this.nodes.push(L);
}var K=L.outgoing;
L.outgoing=[];
J.forEach(K,function(M){this.addExistingLink(M);
},this);
},setItemIndices:function(){var K;
for(K=0;
K<this.nodes.length;
++K){this.nodes[K].index=K;
}for(K=0;
K<this.links.length;
++K){this.links[K].index=K;
}},clone:function(N){var K=new k();
var M=J.isDefined(N)&&N===true;
if(M){K.nodeMap=new g();
K.linkMap=new g();
}var L=new g();
J.forEach(this.nodes,function(P){var O=P.clone();
L.set(P,O);
K.nodes.push(O);
if(M){K.nodeMap.set(O,P);
}});
J.forEach(this.links,function(P){if(L.containsKey(P.source)&&L.containsKey(P.target)){var O=K.addLink(L.get(P.source),L.get(P.target));
if(M){K.linkMap.set(O,P);
}}});
return K;
},linearize:function(K){return k.Utils.linearize(this,K);
},depthFirstTraversal:function(M,K){if(J.isUndefined(M)){throw"You need to supply a starting node.";
}if(J.isUndefined(K)){throw"You need to supply an action.";
}if(!this.hasNode(M)){throw"The given start-node is not part of this graph";
}var L=this.getNode(M);
var N=[];
this._dftIterator(L,K,N);
},_dftIterator:function(P,K,Q){K(P);
Q.push(P);
var M=P.getChildren();
for(var N=0,O=M.length;
N<O;
N++){var L=M[N];
if(c(Q,L)){continue;
}this._dftIterator(L,K,Q);
}},breadthFirstTraversal:function(S,K){if(J.isUndefined(S)){throw"You need to supply a starting node.";
}if(J.isUndefined(K)){throw"You need to supply an action.";
}if(!this.hasNode(S)){throw"The given start-node is not part of this graph";
}var N=this.getNode(S);
var R=new C();
var T=[];
R.enqueue(N);
while(R.length>0){var Q=R.dequeue();
K(Q);
T.push(Q);
var M=Q.getChildren();
for(var O=0,P=M.length;
O<P;
O++){var L=M[O];
if(c(T,L)||c(R,L)){continue;
}R.enqueue(L);
}}},_stronglyConnectedComponents:function(N,U,Q,S,M,V,P){Q.add(U,P);
S.add(U,P);
P++;
V.push(U);
var K=U.getChildren(),T;
for(var O=0,R=K.length;
O<R;
O++){T=K[O];
if(!Q.containsKey(T)){this._stronglyConnectedComponents(N,T,Q,S,M,V,P);
S.add(U,Math.min(S.get(U),S.get(T)));
}else{if(c(V,T)){S.add(U,Math.min(S.get(U),Q.get(T)));
}}}if(S.get(U)===Q.get(U)){var L=[];
do{T=V.pop();
L.push(T);
}while(T!==U);
if(!N||(L.length>1)){M.push(L);
}}},findCycles:function(L){if(J.isUndefined(L)){L=true;
}var N=new g();
var P=new g();
var K=[];
var R=[];
for(var M=0,O=this.nodes.length;
M<O;
M++){var Q=this.nodes[M];
if(N.containsKey(Q)){continue;
}this._stronglyConnectedComponents(L,Q,N,P,K,R,0);
}return K;
},isAcyclic:function(){return J.isEmpty(this.findCycles());
},isSubGraph:function(K){var L=K.linearize();
var M=this.linearize();
return J.all(L,function(N){return c(M,N);
});
},makeAcyclic:function(){if(this.isEmpty()||this.nodes.length<=1||this.links.length<=1){return[];
}if(this.nodes.length==2){var aa=[];
if(this.links.length>1){var Y=this.links[0];
var Z=Y.source;
for(var O=0,T=this.links.length;
O<T;
O++){var V=this.links[O];
if(V.source==Z){continue;
}var ab=V.reverse();
aa.push(ab);
}}return aa;
}var L=this.clone(true);
var X=this.nodes.length;
var Q=new g();
var M=function(N){if(N.outgoing.length===0){return(2-X);
}else{if(N.incoming.length===0){return(X-2);
}else{return N.outgoing.length-N.incoming.length;
}}};
var K=function(at,ar){var N=M(at,X);
if(!ar.containsKey(N)){ar.set(N,[]);
}ar.get(N).push(at);
};
J.forEach(L.nodes,function(N){K(N,Q);
});
var aj=[];
var an=[];
while(L.nodes.length>0){var ag,ak,P;
if(Q.containsKey(2-X)){var am=Q.get(2-X);
while(am.length>0){ak=am.pop();
for(var U=0;
U<ak.links.length;
U++){var al=ak.links[U];
ag=al.getComplement(ak);
P=M(ag,X);
J.remove(Q.get(P),ag);
ag.removeLink(al);
K(ag,Q);
}J.remove(L.nodes,ak);
an.unshift(ak);
}}if(Q.containsKey(X-2)){var ai=Q.get(X-2);
while(ai.length>0){ag=ai.pop();
for(var af=0;
af<ag.links.length;
af++){var ah=ag.links[af];
ak=ah.getComplement(ag);
P=M(ak,X);
J.remove(Q.get(P),ak);
ak.removeLink(ah);
K(ak,Q);
}aj.push(ag);
J.remove(L.nodes,ag);
}}if(L.nodes.length>0){for(var R=X-3;
R>2-X;
R--){if(Q.containsKey(R)&&Q.get(R).length>0){var W=Q.get(R);
var ap=W.pop();
for(var ad=0;
ad<ap.links.length;
ad++){var ae=ap.links[ad];
var ao=ae.getComplement(ap);
P=M(ao,X);
J.remove(Q.get(P),ao);
ao.removeLink(ae);
K(ao,Q);
}aj.push(ap);
J.remove(L.nodes,ap);
break;
}}}}aj=aj.concat(an);
var aq=new g();
for(var S=0;
S<this.nodes.length;
S++){aq.set(L.nodeMap.get(aj[S]),S);
}var ac=[];
J.forEach(this.links,function(N){if(aq.get(N.source)>aq.get(N.target)){N.reverse();
ac.push(N);
}});
return ac;
}});
k.Predefined={EightGraph:function(){return k.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"]);
},Mindmap:function(){return k.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"]);
},ThreeGraph:function(){return k.Utils.parse(["1->2","2->3","3->1"]);
},BinaryTree:function(K){if(J.isUndefined(K)){K=5;
}return k.Utils.createBalancedTree(K,2);
},Linear:function(K){if(J.isUndefined(K)){K=10;
}return k.Utils.createBalancedTree(K,1);
},Tree:function(K,L){return k.Utils.createBalancedTree(K,L);
},Forest:function(K,L,M){return k.Utils.createBalancedForest(K,L,M);
},Workflow:function(){return k.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"]);
},Grid:function(P,O){var K=new f.Graph();
if(P<=0&&O<=0){return K;
}for(var L=0;
L<P+1;
L++){var R=null;
for(var M=0;
M<O+1;
M++){var Q=new x(L.toString()+"."+M.toString());
K.addNode(Q);
if(R){K.addLink(R,Q);
}if(L>0){var N=K.getNode((L-1).toString()+"."+M.toString());
K.addLink(N,Q);
}R=Q;
}}return K;
}};
k.Utils={parse:function(L){var R,K=new f.Graph(),Q=L.slice();
for(var M=0,N=Q.length;
M<N;
M++){var P=Q[M];
if(J.isString(P)){if(P.indexOf("->")<0){throw"The link should be specified as 'a->b'.";
}var O=P.split("->");
if(O.length!=2){throw"The link should be specified as 'a->b'.";
}R=new s(O[0],O[1]);
K.addLink(R);
}if(J.isObject(P)){if(!R){throw"Specification found before Link definition.";
}r.deepExtend(R,P);
}}return K;
},linearize:function(L,K){if(J.isUndefined(L)){throw"Expected an instance of a Graph object in slot one.";
}if(J.isUndefined(K)){K=false;
}var O=[];
for(var M=0,N=L.links.length;
M<N;
M++){var P=L.links[M];
O.push(P.source.id+"->"+P.target.id);
if(K){O.push({id:P.id});
}}return O;
},_addShape:function(L,M,K,N){if(J.isUndefined(M)){M=new f.Point(0,0);
}if(J.isUndefined(K)){K=D();
}N=r.deepExtend({width:20,height:20,id:K,radius:10,fill:"#778899",data:"circle",undoable:false,x:M.x,y:M.y},N);
return L.addShape(N);
},_addConnection:function(K,L,N,M){return K.connect(L,N,M);
},createDiagramFromGraph:function(L,O,M,Y){if(J.isUndefined(L)){throw"The diagram surface is undefined.";
}if(J.isUndefined(O)){throw"No graph specification defined.";
}if(J.isUndefined(M)){M=true;
}if(J.isUndefined(Y)){Y=false;
}var ad=L.element.clientWidth||200;
var P=L.element.clientHeight||200;
var U=[],V,Z;
for(var Q=0,S=O.nodes.length;
Q<S;
Q++){V=O.nodes[Q];
var X=V.position;
if(J.isUndefined(X)){if(J.isDefined(V.x)&&J.isDefined(V.y)){X=new A(V.x,V.y);
}else{X=new A(J.randomInteger(10,ad-20),J.randomInteger(10,P-20));
}}var W={};
if(V.id==="0"){}else{if(Y){r.deepExtend(W,{width:Math.random()*150+20,height:Math.random()*80+50,data:"rectangle",fill:{color:"#778899"}});
}}Z=this._addShape(L,X,V.id,W);
var K=Z.bounds();
if(J.isDefined(K)){V.x=K.x;
V.y=K.y;
V.width=K.width;
V.height=K.height;
}U[V.id]=Z;
}for(var N=0;
N<O.links.length;
N++){var T=O.links[N];
var ab=U[T.source.id];
if(J.isUndefined(ab)){continue;
}var ac=U[T.target.id];
if(J.isUndefined(ac)){continue;
}this._addConnection(L,ab,ac,{id:T.id});
}if(M){var R=new L.SpringLayout(L);
R.layoutGraph(O,{limitToView:false});
for(var aa=0;
aa<O.nodes.length;
aa++){V=O.nodes[aa];
Z=U[V.id];
Z.bounds(new E(V.x,V.y,V.width,V.height));
}}},createBalancedTree:function(R,V){if(J.isUndefined(R)){R=3;
}if(J.isUndefined(V)){V=3;
}var L=new f.Graph(),K=-1,Q=[],S;
if(R<=0||V<=0){return L;
}var U=new x((++K).toString());
L.addNode(U);
L.root=U;
Q.push(U);
for(var M=0;
M<R;
M++){S=[];
for(var O=0;
O<Q.length;
O++){var T=Q[O];
for(var P=0;
P<V;
P++){var N=new x((++K).toString());
L.addLink(T,N);
S.push(N);
}}Q=S;
}return L;
},createBalancedForest:function(R,V,X){if(J.isUndefined(R)){R=3;
}if(J.isUndefined(V)){V=3;
}if(J.isUndefined(X)){X=5;
}var L=new f.Graph(),K=-1,Q=[],S;
if(R<=0||V<=0||X<=0){return L;
}for(var W=0;
W<X;
W++){var U=new x((++K).toString());
L.addNode(U);
Q=[U];
for(var M=0;
M<R;
M++){S=[];
for(var O=0;
O<Q.length;
O++){var T=Q[O];
for(var P=0;
P<V;
P++){var N=new x((++K).toString());
L.addLink(T,N);
S.push(N);
}}Q=S;
}}return L;
},createRandomConnectedGraph:function(S,O,N){if(J.isUndefined(S)){S=40;
}if(J.isUndefined(O)){O=4;
}if(J.isUndefined(N)){N=false;
}var L=new f.Graph(),K=-1;
if(S<=0){return L;
}var W=new x((++K).toString());
L.addNode(W);
if(S===1){return L;
}if(S>1){for(var M=1;
M<S;
M++){var T=L.takeRandomNode([],O);
if(!T){break;
}var R=L.addNode(M.toString());
L.addLink(T,R);
}if(!N&&S>1){var U=J.randomInteger(1,S);
for(var V=0;
V<U;
V++){var P=L.takeRandomNode([],O);
var Q=L.takeRandomNode([],O);
if(P&&Q&&!L.areConnected(P,Q)){L.addLink(P,Q);
}}}return L;
}},randomDiagram:function(K,P,N,M,O){var L=r.dataviz.diagram.Graph.Utils.createRandomConnectedGraph(P,N,M);
k.Utils.createDiagramFromGraph(K,L,false,O);
}};
r.deepExtend(f,{init:function(K){r.init(K,f.ui);
},Point:A,Intersect:n,Geometry:j,Rect:E,Size:H,RectAlign:F,Matrix:u,MatrixVector:v,normalVariable:y,randomId:D,Dictionary:g,HashTable:l,Queue:C,Set:G,Node:x,Link:s,Graph:k,PathDefiner:z});
})(window.kendo.jQuery);
(function(a,ae){var F=window.kendo,O=F.Observable,r=F.dataviz.diagram,i=F.Class,n=F.deepExtend,m=F.dataviz,Q=r.Point,S=r.Rect,T=r.RectAlign,L=r.Matrix,af=r.Utils,E=af.isUndefined,C=af.isNumber,D=af.isString,M=r.MatrixVector,w=F.geometry,l=F.drawing,q=F.util.defined,B=a.inArray;
var ad="transparent",K={none:"none",arrowStart:"ArrowStart",filledCircle:"FilledCircle",arrowEnd:"ArrowEnd"},p=100,o=100,v=360,aa="start",u="end",ah="width",z="height",ai="x",aj="y";
r.Markers=K;
var W=i.extend({init:function(d,g){this.x=d;
this.y=g;
},toMatrix:function(){return L.scaling(this.x,this.y);
},toString:function(){return F.format("scale({0},{1})",this.x,this.y);
},invert:function(){return new W(1/this.x,1/this.y);
}});
var ac=i.extend({init:function(d,g){this.x=d;
this.y=g;
},toMatrixVector:function(){return new M(0,0,0,0,this.x,this.y);
},toMatrix:function(){return L.translation(this.x,this.y);
},toString:function(){return F.format("translate({0},{1})",this.x,this.y);
},plus:function(d){this.x+=d.x;
this.y+=d.y;
},times:function(d){this.x*=d;
this.y*=d;
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},normalize:function(){if(this.Length===0){return;
}this.times(1/this.length());
},invert:function(){return new ac(-this.x,-this.y);
}});
var V=i.extend({init:function(d,g,X){this.x=g||0;
this.y=X||0;
this.angle=d;
},toString:function(){if(this.x&&this.y){return F.format("rotate({0},{1},{2})",this.angle,this.x,this.y);
}else{return F.format("rotate({0})",this.angle);
}},toMatrix:function(){return L.rotation(this.angle,this.x,this.y);
},center:function(){return new Q(this.x,this.y);
},invert:function(){return new V(v-this.angle,this.x,this.y);
}});
V.create=function(d){return new V(d.angle,d.x,d.y);
};
V.parse=function(X){var Y=X.slice(1,X.length-1).split(","),d=Y[0],ak=Y[1],al=Y[2];
var g=new V(d,ak,al);
return g;
};
var j=i.extend({init:function(ak,al,X,Y,d,g){this.translate=new ac(ak,al);
if(X!==ae&&Y!==ae){this.scale=new W(X,Y);
}if(d!==ae){this.rotate=g?new V(d,g.x,g.y):new V(d);
}},toString:function(){var d=function(g){return g?g.toString():"";
};
return d(this.translate)+d(this.rotate)+d(this.scale);
},render:function(d){d._transform=this;
d._renderTransform();
},toMatrix:function(){var d=L.unit();
if(this.translate){d=d.times(this.translate.toMatrix());
}if(this.rotate){d=d.times(this.rotate.toMatrix());
}if(this.scale){d=d.times(this.scale.toMatrix());
}return d;
},invert:function(){var d=this.rotate?this.rotate.invert():ae,g=d?d.toMatrix():L.unit(),X=this.scale?this.scale.invert():ae,Y=X?X.toMatrix():L.unit();
var am=new Q(-this.translate.x,-this.translate.y);
am=g.times(Y).apply(am);
var al=new ac(am.x,am.y);
var ak=new j();
ak.translate=al;
ak.rotate=d;
ak.scale=X;
return ak;
}});
var c={_setScale:function(){var d=this.options;
var X=this._originWidth;
var g=this._originHeight;
var Y=d.width/X;
var ak=d.height/g;
if(!C(Y)){Y=1;
}if(!C(ak)){ak=1;
}this._transform.scale=new W(Y,ak);
},_setTranslate:function(){var d=this.options;
var g=d.x||0;
var X=d.y||0;
this._transform.translate=new ac(g,X);
},_initSize:function(){var d=this.options;
var g=false;
if(d.autoSize!==false&&(q(d.width)||q(d.height))){this._measure(true);
this._setScale();
g=true;
}if(q(d.x)||q(d.y)){this._setTranslate();
g=true;
}if(g){this._renderTransform();
}},_updateSize:function(d){var g=false;
if(this.options.autoSize!==false&&this._diffNumericOptions(d,[ah,z])){g=true;
this._measure(true);
this._setScale();
}if(this._diffNumericOptions(d,[ai,aj])){g=true;
this._setTranslate();
}if(g){this._renderTransform();
}return g;
}};
var t=i.extend({init:function(g){var d=this;
d.options=n({},d.options,g);
d.id=d.options.id;
d._originSize=S.empty();
d._transform=new j();
},visible:function(d){return this.drawingContainer().visible(d);
},redraw:function(d){if(d&&d.id){this.id=d.id;
}},position:function(g,X){var d=this.options;
if(!q(g)){return new Q(d.x,d.y);
}if(q(X)){d.x=g;
d.y=X;
}else{if(g instanceof Q){d.x=g.x;
d.y=g.y;
}}this._transform.translate=new ac(d.x,d.y);
this._renderTransform();
},rotate:function(d,g){if(q(d)){this._transform.rotate=new V(d,g.x,g.y);
this._renderTransform();
}return this._transform.rotate||new V(0);
},drawingContainer:function(){return this.drawingElement;
},_renderTransform:function(){var d=this._transform.toMatrix();
this.drawingContainer().transform(new w.Matrix(d.a,d.b,d.c,d.d,d.e,d.f));
},_hover:function(){},_diffNumericOptions:s,_measure:function(g){var X;
if(!this._measured||g){var d=this._boundingBox()||new w.Rect();
var Y=d.topLeft();
X=new S(Y.x,Y.y,d.width(),d.height());
this._originSize=X;
this._originWidth=X.width;
this._originHeight=X.height;
this._measured=true;
}else{X=this._originSize;
}return X;
},_boundingBox:function(){return this.drawingElement.rawBBox();
}});
var ag=t.extend({init:function(d){t.fn.init.call(this,d);
d=this.options;
d.fill=N(d.fill);
d.stroke=N(d.stroke);
},options:{stroke:{color:"gray",width:1},fill:{color:ad}},fill:function(d,g){this._fill({color:x(d),opacity:g});
},stroke:function(d,X,g){this._stroke({color:x(d),width:X,opacity:g});
},redraw:function(g){if(g){var X=g.stroke;
var d=g.fill;
if(X){this._stroke(N(X));
}if(d){this._fill(N(d));
}t.fn.redraw.call(this,g);
}},_hover:function(ak){var d=this.drawingElement;
var Y=this.options;
var X=Y.hover;
if(X&&X.fill){var g=ak?N(X.fill):Y.fill;
d.fill(g.color,g.opacity);
}},_stroke:function(X){var d=this.options;
n(d,{stroke:X});
X=d.stroke;
var g=null;
if(X.width>0){g={color:X.color,width:X.width,opacity:X.opacity,dashType:X.dashType};
}this.drawingElement.options.set("stroke",g);
},_fill:function(g){var X=this.options;
n(X,{fill:g});
var d=X.fill;
this.drawingElement.fill(d.color,d.opacity);
}});
var ab=ag.extend({init:function(d){this._textColor(d);
ag.fn.init.call(this,d);
this._font();
this._initText();
this._initSize();
},options:{fontSize:15,fontFamily:"sans-serif",stroke:{width:0},fill:{color:"black"},autoSize:true},_initText:function(){var d=this.options;
this.drawingElement=new l.Text(q(d.text)?d.text:"",new w.Point(),{fill:d.fill,font:d.font});
this._stroke();
},_textColor:function(d){if(d&&d.color){n(d,{fill:{color:d.color}});
}},_font:function(){var d=this.options;
if(d.fontFamily&&q(d.fontSize)){d.font=d.fontSize+"px "+d.fontFamily;
}else{delete d.font;
}},content:function(d){return this.drawingElement.content(d);
},redraw:function(d){if(d){var g=false;
var X=this.options;
this._textColor(d);
ag.fn.redraw.call(this,d);
if(d.fontFamily||q(d.fontSize)){n(X,{fontFamily:d.fontFamily,fontSize:d.fontSize});
this._font();
this.drawingElement.options.set("font",X.font);
g=true;
}if(d.text){this.content(d.text);
g=true;
}if(!this._updateSize(d)&&g){this._initSize();
}}}});
n(ab.fn,c);
var U=ag.extend({init:function(d){ag.fn.init.call(this,d);
this._initPath();
this._setPosition();
},_setPosition:function(){var d=this.options;
var g=d.x;
var X=d.y;
if(q(g)||q(X)){this.position(g||0,X||0);
}},redraw:function(d){if(d){ag.fn.redraw.call(this,d);
if(this._diffNumericOptions(d,[ah,z])){this._drawPath();
}if(this._diffNumericOptions(d,[ai,aj])){this._setPosition();
}}},_initPath:function(){var g=this.options;
var d=this.drawingElement=new l.Path({fill:g.fill,stroke:g.stroke,closed:true});
this._drawPath();
},_drawPath:function(){var d=this.drawingElement;
var X=Z(this.options);
var Y=X.width;
var g=X.height;
d.segments.elements([k(0,0),k(Y,0),k(Y,g),k(0,g)]);
}});
var I=ag.extend({init:function(g){ag.fn.init.call(this,g);
var d=this.options.anchor;
this.anchor=new w.Point(d.x,d.y);
this.createElement();
},options:{stroke:{color:ad,width:0},fill:{color:"black"}},_transformToPath:function(g,d){var X=d.transform();
if(g&&X){g=g.transformCopy(X);
}return g;
},redraw:function(d){if(d){if(d.position){this.options.position=d.position;
}ag.fn.redraw.call(this,d);
}}});
var h=I.extend({options:{radius:4,anchor:{x:0,y:0}},createElement:function(){var d=this.options;
this.drawingElement=new l.Circle(new w.Circle(this.anchor,d.radius),{fill:d.fill,stroke:d.stroke});
},positionMarker:function(g){var d=this.options;
var Y=d.position;
var ak=g.segments;
var al;
var X;
if(Y==aa){al=ak[0];
}else{al=ak[ak.length-1];
}if(al){X=this._transformToPath(al.anchor(),g);
this.drawingElement.transform(w.transform().translate(X.x,X.y));
}}});
var b=I.extend({options:{path:"M 0 0 L 10 5 L 0 10 L 3 5 z",anchor:{x:10,y:5}},createElement:function(){var d=this.options;
this.drawingElement=l.Path.parse(d.path,{fill:d.fill,stroke:d.stroke});
},positionMarker:function(X){var Y=this._linePoints(X);
var ak=Y.start;
var g=Y.end;
var al=w.transform();
if(ak){al.rotate(H(ak,g),g);
}if(g){var d=this.anchor;
var am=g.clone().translate(-d.x,-d.y);
al.translate(am.x,am.y);
}this.drawingElement.transform(al);
},_linePoints:function(Y){var X=this.options;
var al=Y.segments;
var am,d,an;
if(X.position==aa){an=al[0];
if(an){d=an.anchor();
am=an.controlOut();
var g=al[1];
if(!am&&g){am=g.anchor();
}}}else{an=al[al.length-1];
if(an){d=an.anchor();
am=an.controlIn();
var ak=al[al.length-2];
if(!am&&ak){am=ak.anchor();
}}}if(d){return{start:this._transformToPath(am,Y),end:this._transformToPath(d,Y)};
}}});
var J={_getPath:function(g){var d=this.drawingElement;
if(d instanceof l.MultiPath){if(g==aa){d=d.paths[0];
}else{d=d.paths[d.paths.length-1];
}}if(d&&d.segments.length){return d;
}},_normalizeMarkerOptions:function(g){var X=g.startCap;
var d=g.endCap;
if(D(X)){g.startCap={type:X};
}if(D(d)){g.endCap={type:d};
}},_removeMarker:function(g){var d=this._markers[g];
if(d){this.drawingContainer().remove(d.drawingElement);
delete this._markers[g];
}},_createMarkers:function(){var d=this.options;
this._normalizeMarkerOptions(d);
this._markers={};
this._markers[aa]=this._createMarker(d.startCap,aa);
this._markers[u]=this._createMarker(d.endCap,u);
},_createMarker:function(X,ak){var al=(X||{}).type;
var Y=this._getPath(ak);
var g,d;
if(!Y){this._removeMarker(ak);
return;
}if(al==K.filledCircle){g=h;
}else{if(al==K.arrowStart||al==K.arrowEnd){g=b;
}else{this._removeMarker(ak);
}}if(g){d=new g(n({},X,{position:ak}));
d.positionMarker(Y);
this.drawingContainer().append(d.drawingElement);
return d;
}},_positionMarker:function(X){var d=this._markers[X];
if(d){var g=this._getPath(X);
if(g){d.positionMarker(g);
}else{this._removeMarker(X);
}}},_capMap:{start:"startCap",end:"endCap"},_redrawMarker:function(al,an,X){this._normalizeMarkerOptions(X);
var am=this.options;
var d=this._capMap[an];
var ak=(am[d]||{}).type;
var Y=X[d];
var g=false;
if(Y){am[d]=n({},am[d],Y);
if(Y.type&&ak!=Y.type){this._removeMarker(an);
this._markers[an]=this._createMarker(am[d],an);
g=true;
}else{if(this._markers[an]){this._markers[an].redraw(Y);
}}}else{if(al&&!this._markers[an]&&am[d]){this._markers[an]=this._createMarker(am[d],an);
g=true;
}}return g;
},_redrawMarkers:function(g,d){if(!this._redrawMarker(g,aa,d)&&g){this._positionMarker(aa);
}if(!this._redrawMarker(g,u,d)&&g){this._positionMarker(u);
}}};
var P=ag.extend({init:function(d){ag.fn.init.call(this,d);
this.container=new l.Group();
this._createElements();
this._initSize();
},options:{autoSize:true},drawingContainer:function(){return this.container;
},data:function(g){var d=this.options;
if(g){if(d.data!=g){d.data=g;
this._setData(g);
this._initSize();
this._redrawMarkers(true,{});
}}else{return d.data;
}},redraw:function(g){if(g){ag.fn.redraw.call(this,g);
var X=this.options;
var d=g.data;
if(q(d)&&X.data!=d){X.data=d;
this._setData(d);
if(!this._updateSize(g)){this._initSize();
}this._redrawMarkers(true,g);
}else{this._updateSize(g);
this._redrawMarkers(false,g);
}}},_createElements:function(){var d=this.options;
this.drawingElement=l.Path.parse(d.data||"",{fill:d.fill,stroke:d.stroke});
this.container.append(this.drawingElement);
this._createMarkers();
},_setData:function(d){var g=this.drawingElement;
var X=l.Path.parse(d||"");
var Y=X.paths.slice(0);
X.paths.elements([]);
g.paths.elements(Y);
}});
n(P.fn,c);
n(P.fn,J);
var G=ag.extend({init:function(d){ag.fn.init.call(this,d);
this.container=new l.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},redraw:function(g){if(g){g=g||{};
var d=g.from;
var X=g.to;
if(d){this.options.from=d;
}if(X){this.options.to=X;
}if(d||X){this._drawPath();
this._redrawMarkers(true,g);
}else{this._redrawMarkers(false,g);
}ag.fn.redraw.call(this,g);
}},_initPath:function(){var g=this.options;
var d=this.drawingElement=new l.Path({fill:g.fill,stroke:g.stroke});
this._drawPath();
this.container.append(d);
},_drawPath:function(){var X=this.options;
var d=this.drawingElement;
var g=X.from||new Q();
var Y=X.to||new Q();
d.segments.elements([k(g.x,g.y),k(Y.x,Y.y)]);
}});
n(G.fn,J);
var R=ag.extend({init:function(d){ag.fn.init.call(this,d);
this.container=new l.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},points:function(g){var d=this.options;
if(g){d.points=g;
this._updatePath();
}else{return d.points;
}},redraw:function(d){if(d){var g=d.points;
ag.fn.redraw.call(this,d);
if(g&&this._pointsDiffer(g)){this.points(g);
this._redrawMarkers(true,d);
}else{this._redrawMarkers(false,d);
}}},_initPath:function(){var d=this.options;
this.drawingElement=new l.Path({fill:d.fill,stroke:d.stroke});
this.container.append(this.drawingElement);
if(d.points){this._updatePath();
}},_pointsDiffer:function(Y){var d=this.options.points;
var g=d.length!==Y.length;
if(!g){for(var X=0;
X<Y.length;
X++){if(d[X].x!==Y[X].x||d[X].y!==Y[X].y){g=true;
break;
}}}return g;
},_updatePath:function(){var d=this.drawingElement;
var X=this.options;
var ak=X.points;
var al=[];
var Y;
for(var g=0;
g<ak.length;
g++){Y=ak[g];
al.push(k(Y.x,Y.y));
}d.segments.elements(al);
},options:{points:[]}});
n(R.fn,J);
var A=t.extend({init:function(d){t.fn.init.call(this,d);
this._initImage();
},redraw:function(d){if(d){if(d.source){this.drawingElement.src(d.source);
}if(this._diffNumericOptions(d,[ah,z,ai,aj])){this.drawingElement.rect(this._rect());
}t.fn.redraw.call(this,d);
}},_initImage:function(){var d=this.options;
var g=this._rect();
this.drawingElement=new l.Image(d.source,g,{});
},_rect:function(){var X=Z(this.options);
var d=new w.Point(X.x,X.y);
var g=new w.Size(X.width,X.height);
return new w.Rect(d,g);
}});
var y=t.extend({init:function(d){this.children=[];
t.fn.init.call(this,d);
this.drawingElement=new l.Group();
this._initSize();
},options:{autoSize:false},append:function(d){this.drawingElement.append(d.drawingContainer());
this.children.push(d);
this._childrenChange=true;
},remove:function(d){if(this._remove(d)){this._childrenChange=true;
}},_remove:function(g){var d=B(g,this.children);
if(d>=0){this.drawingElement.removeAt(d);
this.children.splice(d,1);
return true;
}},clear:function(){this.drawingElement.clear();
this.children=[];
this._childrenChange=true;
},toFront:function(X){var g;
for(var d=0;
d<X.length;
d++){g=X[d];
if(this._remove(g)){this.append(g);
}}},toBack:function(d){this._reorderChildren(d,0);
},toIndex:function(g,d){this._reorderChildren(g,d);
},_reorderChildren:function(aq,an){var ak=this.drawingElement;
var g=ak.children.slice(0);
var d=this.children;
var Y=C(an);
var al,am,ao,X,ap;
for(al=0;
al<aq.length;
al++){ap=aq[al];
X=ap.drawingContainer();
am=B(ap,d);
if(am>=0){g.splice(am,1);
d.splice(am,1);
ao=Y?an:an[al];
g.splice(ao,0,X);
d.splice(ao,0,ap);
}}ak.clear();
ak.append.apply(ak,g);
},redraw:function(d){if(d){if(this._childrenChange){this._childrenChange=false;
if(!this._updateSize(d)){this._initSize();
}}else{this._updateSize(d);
}t.fn.redraw.call(this,d);
}},_boundingBox:function(){var X=this.children;
var d;
var ak,g;
for(var Y=0;
Y<X.length;
Y++){ak=X[Y];
if(ak.visible()&&ak._includeInBBox!==false){g=ak.drawingContainer().clippedBBox(null);
if(g){if(d){d=S.union(d,g);
}else{d=g;
}}}}return d;
}});
n(y.fn,c);
var f=ag.extend({init:function(d){ag.fn.init.call(this,d);
this._initCircle();
this._initSize();
},redraw:function(g){if(g){var d=this.options;
if(g.center){n(d,{center:g.center});
this._center.move(d.center.x,d.center.y);
}if(this._diffNumericOptions(g,["radius"])){this._circle.setRadius(d.radius);
}this._updateSize(g);
ag.fn.redraw.call(this,g);
}},_initCircle:function(){var X=this.options;
var ak=X.width;
var g=X.height;
var Y=X.radius;
if(!q(Y)){if(!q(ak)){ak=g;
}if(!q(g)){g=ak;
}X.radius=Y=Math.min(ak,g)/2;
}var d=X.center||{x:Y,y:Y};
this._center=new w.Point(d.x,d.y);
this._circle=new w.Circle(this._center,Y);
this.drawingElement=new l.Circle(this._circle,{fill:X.fill,stroke:X.stroke});
}});
n(f.fn,c);
var e=i.extend({init:function(d,g){g=g||{};
this.element=d;
this.surface=l.Surface.create(d,g);
if(F.isFunction(this.surface.translate)){this.translate=this._translate;
}this.drawingElement=new l.Group();
this._viewBox=new S(0,0,g.width,g.height);
this.size(this._viewBox);
},bounds:function(){var d=this.drawingElement.clippedBBox();
return new S(0,0,d.width(),d.height());
},size:function(d){var g=this._viewBox;
if(q(d)){g.width=d.width;
g.height=d.height;
this.surface.setSize(d);
}return{width:g.width,height:g.height};
},_translate:function(g,X){var d=this._viewBox;
if(q(g)&&q(X)){d.x=g;
d.y=X;
this.surface.translate({x:g,y:X});
}return{x:d.x,y:d.y};
},draw:function(){this.surface.draw(this.drawingElement);
},append:function(d){this.drawingElement.append(d.drawingContainer());
return this;
},remove:function(d){this.drawingElement.remove(d.drawingContainer());
},insertBefore:function(g,d){},clear:function(){this.drawingElement.clear();
},destroy:function(d){this.surface.destroy();
if(d){a(this.element).remove();
}}});
function Z(d){return{x:d.x||0,y:d.y||0,width:d.width||0,height:d.height||0};
}function N(g){if(g){var d=g;
if(D(d)){d={color:d};
}if(d.color){d.color=x(d.color);
}return d;
}}function x(g){var d;
if(g!=ad){d=new l.Color(g).toHex();
}else{d=g;
}return d;
}function H(g,X){var Y=X.x-g.x;
var ak=X.y-g.y;
var d=F.util.deg(Math.atan2(ak,Y));
return d;
}function s(al,X){var d=this.options;
var Y=false;
var am,g;
for(var ak=0;
ak<X.length;
ak++){g=X[ak];
am=al[g];
if(C(am)&&d[g]!==am){d[g]=am;
Y=true;
}}return Y;
}function k(d,g){return new l.Segment(new w.Point(d,g));
}F.deepExtend(r,{init:function(d){F.init(d,r.ui);
},diffNumericOptions:s,Element:t,Scale:W,Translation:ac,Rotation:V,Circle:f,Group:y,Rectangle:U,Canvas:e,Path:P,Line:G,MarkerBase:I,ArrowMarker:b,CircleMarker:h,Polyline:R,CompositeTransform:j,TextBlock:ab,Image:A,VisualBase:ag});
})(window.kendo.jQuery);
(function(a,aw){var K=window.kendo,u=K.dataviz,A=u.diagram,j=K.Class,E=A.Group,am=A.TextBlock,aa=A.Rect,ab=A.Rectangle,ay=A.Utils,H=ay.isUndefined,V=A.Point,i=A.Circle,U=A.Path,an=A.Ticker,v=K.deepExtend,Q=K.ui.Movable,g=K.support.browser,x=K.util.defined,Z=a.proxy;
var t={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer",south:"s-resize",east:"e-resize",west:"w-resize",north:"n-resize",rowresize:"row-resize",colresize:"col-resize"},F=10,e="Auto",ar="Top",ad="Right",M="Left",f="Bottom",w=[ar,ad,f,M,e],J="itemRotate",I="itemBoundsChange",O="mouseEnter",P="mouseLeave",aB="zoomStart",aA="zoomEnd",ag=-20000,af=20000,C=0.9,D=0.9300000000000001,az=5,au="transparent",S="pan";
A.Cursors=t;
function ak(aC,aD){if(aC.isSelected){if(aD.ctrlKey){aC.select(false);
}}else{aC.diagram.select(aC,{addToSelection:aD.ctrlKey});
}}var Y=K.Class.extend({init:function(aC){this.layoutState=aC;
this.diagram=aC.diagram;
},initState:function(){this.froms=[];
this.tos=[];
this.subjects=[];
function aC(aE,aD){var aF=this.diagram.getShapeById(aE);
if(aF){this.subjects.push(aF);
this.froms.push(aF.bounds().topLeft());
this.tos.push(aD.topLeft());
}}this.layoutState.nodeMap.forEach(aC,this);
},update:function(aD){if(this.subjects.length<=0){return;
}for(var aC=0;
aC<this.subjects.length;
aC++){this.subjects[aC].position(new V(this.froms[aC].x+(this.tos[aC].x-this.froms[aC].x)*aD,this.froms[aC].y+(this.tos[aC].y-this.froms[aC].y)*aD));
}}});
var L=j.extend({init:function(aE,aD,aC){if(H(aC)){this.animate=false;
}else{this.animate=aC;
}this._initialState=aE;
this._finalState=aD;
this.title="Diagram layout";
},undo:function(){this.setState(this._initialState);
},redo:function(){this.setState(this._finalState);
},setState:function(aD){var aC=aD.diagram;
if(this.animate){aD.linkMap.forEach(function(aG,aH){var aF=aC.getShapeById(aG);
aF.visible(false);
if(aF){aF.points(aH);
}});
var aE=new an();
aE.addAdapter(new Y(aD));
aE.onComplete(function(){aD.linkMap.forEach(function(aG){var aF=aC.getShapeById(aG);
aF.visible(true);
});
});
aE.play();
}else{aD.nodeMap.forEach(function(aG,aF){var aH=aC.getShapeById(aG);
if(aH){aH.position(aF.topLeft());
}});
aD.linkMap.forEach(function(aG,aH){var aF=aC.getShapeById(aG);
if(aF){aF.points(aH);
}});
}}});
var k=j.extend({init:function(aC){this.units=[];
this.title="Composite unit";
if(aC!==aw){this.units.push(aC);
}},add:function(aC){this.units.push(aC);
},undo:function(){for(var aC=0;
aC<this.units.length;
aC++){this.units[aC].undo();
}},redo:function(){for(var aC=0;
aC<this.units.length;
aC++){this.units[aC].redo();
}}});
var o=j.extend({init:function(aC,aD,aE){this.item=aC;
this._redoSource=aD;
this._redoTarget=aE;
if(x(aD)){this._undoSource=aC.source();
}if(x(aE)){this._undoTarget=aC.target();
}this.title="Connection Editing";
},undo:function(){if(this._undoSource!==aw){this.item._updateConnector(this._undoSource,"source");
}if(this._undoTarget!==aw){this.item._updateConnector(this._undoTarget,"target");
}this.item.updateModel();
},redo:function(){if(this._redoSource!==aw){this.item._updateConnector(this._redoSource,"source");
}if(this._redoTarget!==aw){this.item._updateConnector(this._redoTarget,"target");
}this.item.updateModel();
}});
var n=j.extend({init:function(aC,aD,aE){this.item=aC;
this._undoSource=aD;
this._undoTarget=aE;
this._redoSource=aC.source();
this._redoTarget=aC.target();
this.title="Connection Editing";
},undo:function(){this.item._updateConnector(this._undoSource,"source");
this.item._updateConnector(this._undoTarget,"target");
this.item.updateModel();
},redo:function(){this.item._updateConnector(this._redoSource,"source");
this.item._updateConnector(this._redoTarget,"target");
this.item.updateModel();
}});
var y=j.extend({init:function(aC){this.connection=aC;
this.diagram=aC.diagram;
this.targetConnector=aC.targetConnector;
this.title="Delete connection";
},undo:function(){this.diagram._addConnection(this.connection,false);
},redo:function(){this.diagram.remove(this.connection,false);
}});
var z=j.extend({init:function(aC){this.shape=aC;
this.diagram=aC.diagram;
this.title="Deletion";
},undo:function(){this.diagram._addShape(this.shape,false);
this.shape.select(false);
},redo:function(){this.shape.select(false);
this.diagram.remove(this.shape,false);
}});
var at=j.extend({init:function(aF,aG,aC){this.shapes=aF;
this.undoStates=aG;
this.title="Transformation";
this.redoStates=[];
this.adorner=aC;
for(var aD=0;
aD<this.shapes.length;
aD++){var aE=this.shapes[aD];
this.redoStates.push(aE.bounds());
}},undo:function(){for(var aC=0;
aC<this.shapes.length;
aC++){var aD=this.shapes[aC];
aD.bounds(this.undoStates[aC]);
if(aD.hasOwnProperty("layout")){aD.layout(aD,this.redoStates[aC],this.undoStates[aC]);
}aD.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}},redo:function(){for(var aC=0;
aC<this.shapes.length;
aC++){var aD=this.shapes[aC];
aD.bounds(this.redoStates[aC]);
if(aD.hasOwnProperty("layout")){aD.layout(aD,this.undoStates[aC],this.redoStates[aC]);
}aD.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}}});
var b=j.extend({init:function(aC,aD){this.connection=aC;
this.diagram=aD;
this.title="New connection";
},undo:function(){this.diagram.remove(this.connection,false);
},redo:function(){this.diagram._addConnection(this.connection,false);
}});
var c=j.extend({init:function(aD,aC){this.shape=aD;
this.diagram=aC;
this.title="New shape";
},undo:function(){this.diagram.deselect();
this.diagram.remove(this.shape,false);
},redo:function(){this.diagram._addShape(this.shape,false);
}});
var T=j.extend({init:function(aE,aD,aC){this.initial=aE;
this.finalPos=aD;
this.diagram=aC;
this.title="Pan Unit";
},undo:function(){this.diagram.pan(this.initial);
},redo:function(){this.diagram.pan(this.finalPos);
}});
var ae=j.extend({init:function(aC,aF,aG){this.shapes=aF;
this.undoRotates=aG;
this.title="Rotation";
this.redoRotates=[];
this.redoAngle=aC._angle;
this.adorner=aC;
this.center=aC._innerBounds.center();
for(var aD=0;
aD<this.shapes.length;
aD++){var aE=this.shapes[aD];
this.redoRotates.push(aE.rotate().angle);
}},undo:function(){var aC,aD;
for(aC=0;
aC<this.shapes.length;
aC++){aD=this.shapes[aC];
aD.rotate(this.undoRotates[aC],this.center,false);
if(aD.hasOwnProperty("layout")){aD.layout(aD);
}aD.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}},redo:function(){var aC,aD;
for(aC=0;
aC<this.shapes.length;
aC++){aD=this.shapes[aC];
aD.rotate(this.redoRotates[aC],this.center,false);
if(aD.hasOwnProperty("layout")){aD.layout(aD);
}aD.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}}});
var ap=j.extend({init:function(aC,aE,aD){this.diagram=aC;
this.indices=aD;
this.items=aE;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toFront(this.items,false);
}});
var ao=j.extend({init:function(aC,aE,aD){this.diagram=aC;
this.indices=aD;
this.items=aE;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toBack(this.items,false);
}});
var ax=K.Observable.extend({init:function(aC){K.Observable.fn.init.call(this,aC);
this.bind(this.events,aC);
this.stack=[];
this.index=0;
this.capacity=100;
},events:["undone","redone"],begin:function(){this.composite=new k();
},cancel:function(){this.composite=aw;
},commit:function(aC){if(this.composite.units.length>0){this._restart(this.composite,aC);
}this.composite=aw;
},addCompositeItem:function(aC){if(this.composite){this.composite.add(aC);
}else{this.add(aC);
}},add:function(aD,aC){this._restart(aD,aC);
},count:function(){return this.stack.length;
},undo:function(){if(this.index>0){this.index--;
this.stack[this.index].undo();
this.trigger("undone");
}},redo:function(){if(this.stack.length>0&&this.index<this.stack.length){this.stack[this.index].redo();
this.index++;
this.trigger("redone");
}},_restart:function(aC,aD){this.stack.splice(this.index,this.stack.length-this.index);
this.stack.push(aC);
if(aD!==false){this.redo();
}else{this.index++;
}if(this.stack.length>this.capacity){this.stack.splice(0,this.stack.length-this.capacity);
this.index=this.capacity;
}},clear:function(){this.stack=[];
this.index=0;
}});
var B=j.extend({init:function(aC){this.toolService=aC;
},start:function(){},move:function(){},end:function(){},tryActivate:function(aD,aC){return false;
},getCursor:function(){return t.arrow;
}});
function R(aC){return aC.ctrlKey===false&&aC.altKey===false&&aC.shiftKey===false;
}function av(aE,aD){var aC=aE!==false;
if(aE.key&&aE.key!="none"){aC=aD[aE.key+"Key"];
}return aC;
}var ah=B.extend({init:function(aH){var aG=this;
var aE=K.support.mobileOS?D:C;
B.fn.init.call(aG,aH);
var aD=aG.toolService.diagram,aC=aD.canvas;
var aF=aD.scroller=aG.scroller=a(aD.scrollable).kendoMobileScroller({friction:aE,velocityMultiplier:az,mousewheelScrolling:false,zoom:false,scroll:Z(aG._move,aG)}).data("kendoMobileScroller");
if(aC.translate){aG.movableCanvas=new Q(aC.element);
}var aI=function(aJ,aL,aK){aJ.makeVirtual();
aJ.virtualSize(aL||ag,aK||af);
};
aI(aF.dimensions.x);
aI(aF.dimensions.y);
aF.disable();
},tryActivate:function(aF,aD){var aG=this.toolService;
var aE=aG.diagram.options.pannable;
var aC=aD.ctrlKey;
if(x(aE.key)){if(!aE.key||aE.key=="none"){aC=R(aD);
}else{aC=aD[aE.key+"Key"]&&!(aD.ctrlKey&&x(aG.hoveredItem));
}}return aE!==false&&aC&&!x(aG.hoveredAdorner)&&!x(aG._hoveredConnector);
},start:function(){this.scroller.enable();
},move:function(){},_move:function(aC){var aG=this,aE=aG.toolService.diagram,aD=aE.canvas,aF=new V(aC.scrollLeft,aC.scrollTop);
if(aD.translate){aE._storePan(aF.times(-1));
aG.movableCanvas.moveTo(aF);
aD.translate(aF.x,aF.y);
}else{aF=aF.plus(aE._pan.times(-1));
}aE.trigger(S,{pan:aF});
},end:function(){this.scroller.disable();
},getCursor:function(){return t.move;
}});
var W=j.extend({init:function(aC){this.toolService=aC;
},tryActivate:function(aD,aC){return true;
},start:function(aF,aE){var aH=this.toolService,aC=aH.diagram,aD=aH.hoveredItem,aG=aC.options.selectable;
if(aD){if(av(aG,aE)){ak(aD,aE);
}if(aD.adorner){this.adorner=aD.adorner;
this.handle=this.adorner._hitTest(aF);
}}if(!this.handle){this.handle=aC._resizingAdorner._hitTest(aF);
if(this.handle){this.adorner=aC._resizingAdorner;
}}if(this.adorner){this.adorner.start(aF);
}},move:function(aC){var aD=this;
if(this.adorner){this.adorner.move(aD.handle,aC);
}},end:function(aE,aD){var aC=this.toolService.diagram,aF=this.toolService,aG;
if(this.adorner){aG=this.adorner.stop();
if(aG){aC.undoRedoService.add(aG,false);
}}if(aF.hoveredItem){this.toolService.triggerClick({item:aF.hoveredItem,point:aE,meta:aD});
}this.adorner=aw;
this.handle=aw;
},getCursor:function(aC){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(aC):t.arrow;
}});
var ai=j.extend({init:function(aC){this.toolService=aC;
},tryActivate:function(aE,aD){var aF=this.toolService;
var aC=av(aF.diagram.options.selectable,aD);
return aC&&!x(aF.hoveredItem)&&!x(aF.hoveredAdorner);
},start:function(aD){var aC=this.toolService.diagram;
aC.deselect();
aC.selector.start(aD);
},move:function(aD){var aC=this.toolService.diagram;
aC.selector.move(aD);
},end:function(aF,aE){var aC=this.toolService.diagram,aD=this.toolService.hoveredItem;
var aG=aC.selector.bounds();
if((!aD||!aD.isSelected)&&!aE.ctrlKey){aC.deselect();
}if(!aG.isEmpty()){aC.selectArea(aG);
}aC.selector.end();
},getCursor:function(){return t.arrow;
}});
var q=j.extend({init:function(aC){this.toolService=aC;
this.type="ConnectionTool";
},tryActivate:function(aD,aC){return this.toolService._hoveredConnector;
},start:function(aG,aF){var aE=this.toolService.diagram,aD=this.toolService._hoveredConnector,aC=aE._createConnection({},aD._c,aG);
if(aE._addConnection(aC)){this.toolService._connectionManipulation(aC,aD._c.shape,true);
this.toolService._removeHover();
ak(this.toolService.activeConnection,aF);
}else{aC.source(null);
this.toolService.end();
}},move:function(aC){this.toolService.activeConnection.target(aC);
return true;
},end:function(aF){var aC=this.toolService.activeConnection,aE=this.toolService.hoveredItem,aD=this.toolService._hoveredConnector,aG;
if(!aC){return;
}if(aD&&aD._c!=aC.sourceConnector){aG=aD._c;
}else{if(aE&&aE instanceof A.Shape){aG=aE.getConnector(e)||aE.getConnector(aF);
}else{aG=aF;
}}aC.target(aG);
aC.updateModel(true);
this.toolService._connectionManipulation();
},getCursor:function(){return t.arrow;
}});
var m=j.extend({init:function(aC){this.toolService=aC;
this.type="ConnectionTool";
},tryActivate:function(aG,aF){var aI=this.toolService,aC=aI.diagram,aH=aC.options.selectable,aE=aI.hoveredItem,aD=av(aH,aF)&&aE&&aE.path&&!(aE.isSelected&&aF.ctrlKey);
if(aD){this._c=aE;
}return aD;
},start:function(aE,aD){ak(this._c,aD);
var aC=this._c.adorner;
if(aC){this.handle=aC._hitTest(aE);
aC.start(aE);
}},move:function(aD){var aC=this._c.adorner;
if(aC){aC.move(this.handle,aD);
return true;
}},end:function(aE,aD){var aC=this._c.adorner;
if(aC){this.toolService.triggerClick({item:this._c,point:aE,meta:aD});
var aF=aC.stop(aE);
this.toolService.diagram.undoRedoService.add(aF,false);
}},getCursor:function(){return t.move;
}});
function al(aC,aD){return aD.charCodeAt(0)==aC||aD.toUpperCase().charCodeAt(0)==aC;
}var aq=j.extend({init:function(aC){this.diagram=aC;
this.tools=[new ah(this),new m(this),new q(this),new ai(this),new W(this)];
this.activeTool=aw;
},start:function(aD,aC){aC=v({},aC);
if(this.activeTool){this.activeTool.end(aD,aC);
}this._updateHoveredItem(aD);
this._activateTool(aD,aC);
this.activeTool.start(aD,aC);
this._updateCursor(aD);
this.diagram.focus();
this.startPoint=aD;
return true;
},move:function(aD,aC){aC=v({},aC);
var aE=true;
if(this.activeTool){aE=this.activeTool.move(aD,aC);
}if(aE){this._updateHoveredItem(aD);
}this._updateCursor(aD);
return true;
},end:function(aD,aC){aC=v({},aC);
if(this.activeTool){this.activeTool.end(aD,aC);
}this.activeTool=aw;
this._updateCursor(aD);
return true;
},keyDown:function(aD,aE){var aC=this.diagram;
aE=v({ctrlKey:false,metaKey:false,altKey:false},aE);
if((aE.ctrlKey||aE.metaKey)&&!aE.altKey){if(al(aD,"a")){aC.selectAll();
aC._destroyToolBar();
return true;
}else{if(al(aD,"z")){aC.undo();
aC._destroyToolBar();
return true;
}else{if(al(aD,"y")){aC.redo();
aC._destroyToolBar();
return true;
}else{if(al(aD,"c")){aC.copy();
aC._destroyToolBar();
}else{if(al(aD,"x")){aC.cut();
aC._destroyToolBar();
}else{if(al(aD,"v")){aC.paste();
aC._destroyToolBar();
}else{if(al(aD,"l")){aC.layout();
aC._destroyToolBar();
}else{if(al(aD,"d")){aC._destroyToolBar();
aC.copy();
aC.paste();
}}}}}}}}}else{if(aD===46||aD===8){var aF=this.diagram._triggerRemove(aC.select());
if(aF.length){this.diagram.remove(aF,true);
this.diagram._syncChanges();
this.diagram._destroyToolBar();
}return true;
}else{if(aD===27){this._discardNewConnection();
aC.deselect();
aC._destroyToolBar();
return true;
}}}},wheel:function(aG,aE){var aD=this.diagram,aC=aE.delta,aH=aD.zoom(),aF=aD.options,aJ=aF.zoomRate,aI={point:aG,meta:aE,zoom:aH};
if(aD.trigger(aB,aI)){return;
}if(aC<0){aH+=aJ;
}else{aH-=aJ;
}aH=K.dataviz.round(Math.max(aF.zoomMin,Math.min(aF.zoomMax,aH)),2);
aI.zoom=aH;
aD.zoom(aH,aI);
aD.trigger(aA,aI);
return true;
},setTool:function(aD,aC){aD.toolService=this;
this.tools[aC]=aD;
},triggerClick:function(aC){if(this.startPoint.equals(aC.point)){this.diagram.trigger("click",aC);
}},_discardNewConnection:function(){if(this.newConnection){this.diagram.remove(this.newConnection);
this.newConnection=aw;
}},_activateTool:function(aE,aD){for(var aC=0;
aC<this.tools.length;
aC++){var aF=this.tools[aC];
if(aF.tryActivate(aE,aD)){this.activeTool=aF;
break;
}}},_updateCursor:function(aE){var aD=this.diagram.element;
var aC=this.activeTool?this.activeTool.getCursor(aE):(this.hoveredAdorner?this.hoveredAdorner._getCursor(aE):(this.hoveredItem?this.hoveredItem._getCursor(aE):t.arrow));
aD.css({cursor:aC});
if(g.msie&&g.version==7){aD[0].style.cssText=aD[0].style.cssText;
}},_connectionManipulation:function(aC,aD,aE){this.activeConnection=aC;
this.disabledShape=aD;
if(aE){this.newConnection=this.activeConnection;
}else{this.newConnection=aw;
}},_updateHoveredItem:function(aE){var aD=this._hitTest(aE);
var aC=this.diagram;
if(aD!=this.hoveredItem&&(!this.disabledShape||aD!=this.disabledShape)){if(this.hoveredItem){aC.trigger(P,{item:this.hoveredItem});
this.hoveredItem._hover(false);
}if(aD&&aD.options.enable){aC.trigger(O,{item:aD});
this.hoveredItem=aD;
this.hoveredItem._hover(true);
}else{this.hoveredItem=aw;
}}},_removeHover:function(){if(this.hoveredItem){this.hoveredItem._hover(false);
this.hoveredItem=aw;
}},_hitTest:function(aG){var aD,aC=this.diagram,aF,aE;
if(this._hoveredConnector){this._hoveredConnector._hover(false);
this._hoveredConnector=aw;
}if(aC._connectorsAdorner._visible){aD=aC._connectorsAdorner._hitTest(aG);
if(aD){return aD;
}}aD=this.diagram._resizingAdorner._hitTest(aG);
if(aD){this.hoveredAdorner=aC._resizingAdorner;
if(aD.x!==0||aD.y!==0){return;
}aD=aw;
}else{this.hoveredAdorner=aw;
}if(!this.activeTool||this.activeTool.type!=="ConnectionTool"){var aH=[];
for(aE=0;
aE<aC._selectedItems.length;
aE++){aF=aC._selectedItems[aE];
if(aF instanceof A.Connection){aH.push(aF);
}}aD=this._hitTestItems(aH,aG);
}return aD||this._hitTestItems(aC.shapes,aG)||this._hitTestItems(aC.connections,aG);
},_hitTestItems:function(aC,aG){var aE,aF,aD;
for(aE=aC.length-1;
aE>=0;
aE--){aF=aC[aE];
aD=aF._hitTest(aG);
if(aD){return aD;
}}}});
var p=K.Class.extend({init:function(){}});
var N=p.extend({init:function(aC){var aD=this;
p.fn.init.call(aD);
this.connection=aC;
},hitTest:function(aC){var aD=this.getBounds().inflate(10);
if(!aD.contains(aC)){return false;
}return A.Geometry.distanceToPolyline(aC,this.connection.allPoints())<F;
},getBounds:function(){var aG=this.connection.allPoints(),aI=aG[0],aD=aG[aG.length-1],aH=Math.max(aI.x,aD.x),aF=Math.min(aI.x,aD.x),aJ=Math.min(aI.y,aD.y),aC=Math.max(aI.y,aD.y);
for(var aE=1;
aE<aG.length-1;
++aE){aH=Math.max(aH,aG[aE].x);
aF=Math.min(aF,aG[aE].x);
aJ=Math.min(aJ,aG[aE].y);
aC=Math.max(aC,aG[aE].y);
}return new aa(aF,aJ,aH-aF,aC-aJ);
}});
var X=N.extend({init:function(aC){var aD=this;
N.fn.init.call(aD);
this.connection=aC;
},route:function(){}});
var h=N.extend({init:function(aC){var aD=this;
N.fn.init.call(aD);
this.connection=aC;
},route:function(){var aH=this.connection;
var aM=this.connection.sourcePoint();
var aE=this.connection.targetPoint(),aI=[aM,aM,aE,aE],aC=aE.x-aM.x,aD=aE.y-aM.y,aG=aI.length,aJ,aK,aL=null,aO=null;
if(ay.isDefined(aH._resolvedSourceConnector)){aL=aH._resolvedSourceConnector.options.name;
}if(ay.isDefined(aH._resolvedTargetConnector)){aO=aH._resolvedTargetConnector.options.name;
}function aN(){if(aL!==null){if(aL===ad||aL===M){return true;
}if(aL===ar||aL===f){return false;
}}return Math.abs(aM.x-aE.x)>Math.abs(aM.y-aE.y);
}if(aL!==null&&aO!==null&&ay.contains(w,aL)&&ay.contains(w,aO)){if(aL===ar||aL==f){if(aO==ar||aO==f){this.connection.points([new V(aM.x,aM.y+aD/2),new V(aE.x,aM.y+aD/2)]);
}else{this.connection.points([new V(aM.x,aM.y+aD)]);
}}else{if(aO==M||aO==ad){this.connection.points([new V(aM.x+aC/2,aM.y),new V(aM.x+aC/2,aM.y+aD)]);
}else{this.connection.points([new V(aE.x,aM.y)]);
}}}else{this.connection.cascadeStartHorizontal=aN(this.connection);
for(var aF=1;
aF<aG-1;
++aF){if(aH.cascadeStartHorizontal){if(aF%2!==0){aJ=aC/(aG/2);
aK=0;
}else{aJ=0;
aK=aD/((aG-1)/2);
}}else{if(aF%2!==0){aJ=0;
aK=aD/(aG/2);
}else{aJ=aC/((aG-1)/2);
aK=0;
}}aI[aF]=new V(aI[aF-1].x+aJ,aI[aF-1].y+aK);
}aF--;
if((aH.cascadeStartHorizontal&&(aF%2!==0))||(!aH.cascadeStartHorizontal&&(aF%2===0))){aI[aG-2]=new V(aI[aG-1].x,aI[aG-2].y);
}else{aI[aG-2]=new V(aI[aG-2].x,aI[aG-1].y);
}this.connection.points([aI[1],aI[2]]);
}}});
var d=j.extend({init:function(aC,aD){var aE=this;
aE.diagram=aC;
aE.options=v({},aE.options,aD);
aE.visual=new E();
aE.diagram._adorners.push(aE);
},refresh:function(){}});
var l=d.extend({init:function(aC,aE){var aG=this,aD;
aG.connection=aC;
aD=aG.connection.diagram;
aG._ts=aD.toolService;
d.fn.init.call(aG,aD,aE);
var aF=aG.connection.sourcePoint();
var aH=aG.connection.targetPoint();
aG.spVisual=new i(v(aG.options.handles,{center:aF}));
aG.epVisual=new i(v(aG.options.handles,{center:aH}));
aG.visual.append(aG.spVisual);
aG.visual.append(aG.epVisual);
},options:{handles:{}},_getCursor:function(){return t.move;
},start:function(aC){this.handle=this._hitTest(aC);
this.startPoint=aC;
this._initialSource=this.connection.source();
this._initialTarget=this.connection.target();
switch(this.handle){case -1:if(this.connection.targetConnector){this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);
}break;
case 1:if(this.connection.sourceConnector){this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape);
}break;
}},move:function(aD,aE){switch(aD){case -1:this.connection.source(aE);
break;
case 1:this.connection.target(aE);
break;
default:var aC=aE.minus(this.startPoint);
this.startPoint=aE;
if(!this.connection.sourceConnector){this.connection.source(this.connection.sourcePoint().plus(aC));
}if(!this.connection.targetConnector){this.connection.target(this.connection.targetPoint().plus(aC));
}break;
}this.refresh();
return true;
},stop:function(aD){var aF=this.diagram.toolService,aC=aF.hoveredItem,aE;
if(aF._hoveredConnector){aE=aF._hoveredConnector._c;
}else{if(aC&&aC instanceof A.Shape){aE=aC.getConnector(e)||aC.getConnector(aD);
}else{aE=aD;
}}if(this.handle===-1){this.connection.source(aE);
}else{if(this.handle===1){this.connection.target(aE);
}}this.connection.updateModel(true);
this.handle=aw;
this._ts._connectionManipulation();
return new n(this.connection,this._initialSource,this._initialTarget);
},_hitTest:function(aC){var aG=this.connection.sourcePoint(),aI=this.connection.targetPoint(),aD=this.options.handles.width/2,aE=this.options.handles.height/2,aF=new aa(aG.x,aG.y).inflate(aD,aE),aH=new aa(aI.x,aI.y).inflate(aD,aE);
return aF.contains(aC)?-1:(aH.contains(aC)?1:0);
},refresh:function(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())});
this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())});
}});
var r=d.extend({init:function(aC,aD){var aE=this;
d.fn.init.call(aE,aC,aD);
aE._refreshHandler=function(aF){if(aF.item==aE.shape){aE.refresh();
}};
},show:function(aF){var aG=this,aE,aD,aC;
aG._visible=true;
aG.shape=aF;
aG.diagram.bind(I,aG._refreshHandler);
aE=aF.connectors.length;
aG.connectors=[];
aG.visual.clear();
for(aD=0;
aD<aE;
aD++){aC=new s(aF.connectors[aD]);
aG.connectors.push(aC);
aG.visual.append(aC.visual);
}aG.visual.visible(true);
aG.refresh();
},destroy:function(){var aC=this;
aC.diagram.unbind(I,aC._refreshHandler);
aC.shape=aw;
aC._visible=aw;
aC.visual.visible(false);
},_hitTest:function(aE){var aC,aD;
for(aD=0;
aD<this.connectors.length;
aD++){aC=this.connectors[aD];
if(aC._hitTest(aE)){aC._hover(true);
this.diagram.toolService._hoveredConnector=aC;
break;
}}},refresh:function(){if(this.shape){var aC=this.shape.bounds();
aC=this.diagram.modelToLayer(aC);
this.visual.position(aC.topLeft());
a.each(this.connectors,function(){this.refresh();
});
}}});
function G(aD,aC){var aE;
if(aD.x==-1&&aD.y==-1){aE=aC.bottomRight();
}else{if(aD.x==1&&aD.y==1){aE=aC.topLeft();
}else{if(aD.x==-1&&aD.y==1){aE=aC.topRight();
}else{if(aD.x==1&&aD.y==-1){aE=aC.bottomLeft();
}else{if(aD.x===0&&aD.y==-1){aE=aC.bottom();
}else{if(aD.x===0&&aD.y==1){aE=aC.top();
}else{if(aD.x==1&&aD.y===0){aE=aC.left();
}else{if(aD.x==-1&&aD.y===0){aE=aC.right();
}}}}}}}}return aE;
}var ac=d.extend({init:function(aC,aD){var aE=this;
d.fn.init.call(aE,aC,aD);
aE._manipulating=false;
aE.map=[];
aE.shapes=[];
aE._initSelection();
aE._createHandles();
aE.redraw();
aE.diagram.bind("select",function(aF){aE._initialize(aF.selected);
});
aE._refreshHandler=function(){if(!aE._internalChange){aE.refreshBounds();
aE.refresh();
}};
aE._rotatedHandler=function(){if(aE.shapes.length==1){aE._angle=aE.shapes[0].rotate().angle;
}aE._refreshHandler();
};
aE.diagram.bind(I,aE._refreshHandler).bind(J,aE._rotatedHandler);
aE.refreshBounds();
aE.refresh();
},options:{editable:{},selectable:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:au}},offset:10},_initSelection:function(){var aF=this;
var aC=aF.diagram;
var aE=aC.options.selectable;
var aD=v({},aF.options.selectable,aE);
aF.rect=new ab(aD);
aF.visual.append(aF.rect);
},_createHandles:function(){var aC=this.options.editable,aD,aF,aE,aH,aG;
if(aC&&aC.resize){aD=aC.resize.handles;
for(aG=-1;
aG<=1;
aG++){for(aH=-1;
aH<=1;
aH++){if((aG!==0)||(aH!==0)){aF=new ab(aD);
aF.drawingElement._hover=Z(this._hover,this);
this.map.push({x:aG,y:aH,visual:aF});
this.visual.append(aF);
}}}}},bounds:function(aC){if(aC){this._innerBounds=aC.clone();
this._bounds=this.diagram.modelToLayer(aC).inflate(this.options.offset,this.options.offset);
}else{return this._bounds;
}},_hitTest:function(aI){var aJ=this.diagram.modelToLayer(aI),aC=this.options.editable,aH,aG,aE,aF=this.map.length,aD;
if(this._angle){aJ=aJ.clone().rotate(this._bounds.center(),this._angle);
}if(aC&&aC.rotate&&this._rotationThumbBounds){if(this._rotationThumbBounds.contains(aJ)){return new V(-1,-2);
}}if(aC&&aC.resize){for(aH=0;
aH<aF;
aH++){aD=this.map[aH];
aG=new V(aD.x,aD.y);
aE=this._getHandleBounds(aG);
aE.offset(this._bounds.x,this._bounds.y);
if(aE.contains(aJ)){return aG;
}}}if(this._bounds.contains(aJ)){return new V(0,0);
}},_getHandleBounds:function(aF){var aC=this.options.editable;
if(aC&&aC.resize){var aE=aC.resize.handles||{},aH=aE.width,aD=aE.height,aG=new aa(0,0,aH,aD);
if(aF.x<0){aG.x=-aH/2;
}else{if(aF.x===0){aG.x=Math.floor(this._bounds.width/2)-aH/2;
}else{if(aF.x>0){aG.x=this._bounds.width+1-aH/2;
}}}if(aF.y<0){aG.y=-aD/2;
}else{if(aF.y===0){aG.y=Math.floor(this._bounds.height/2)-aD/2;
}else{if(aF.y>0){aG.y=this._bounds.height+1-aD/2;
}}}return aG;
}},_getCursor:function(aE){var aD=this._hitTest(aE);
if(aD&&(aD.x>=-1)&&(aD.x<=1)&&(aD.y>=-1)&&(aD.y<=1)&&this.options.editable&&this.options.editable.resize){var aC=this._angle;
if(aC){aC=360-aC;
aD.rotate(new V(0,0),aC);
aD=new V(Math.round(aD.x),Math.round(aD.y));
}if(aD.x==-1&&aD.y==-1){return"nw-resize";
}if(aD.x==1&&aD.y==1){return"se-resize";
}if(aD.x==-1&&aD.y==1){return"sw-resize";
}if(aD.x==1&&aD.y==-1){return"ne-resize";
}if(aD.x===0&&aD.y==-1){return"n-resize";
}if(aD.x===0&&aD.y==1){return"s-resize";
}if(aD.x==1&&aD.y===0){return"e-resize";
}if(aD.x==-1&&aD.y===0){return"w-resize";
}}return this._manipulating?t.move:t.select;
},_initialize:function(){var aF=this,aC,aD,aE=aF.diagram.select();
aF.shapes=[];
for(aC=0;
aC<aE.length;
aC++){aD=aE[aC];
if(aD instanceof A.Shape){aF.shapes.push(aD);
aD._rotationOffset=new V();
}}aF._angle=aF.shapes.length==1?aF.shapes[0].rotate().angle:0;
aF._startAngle=aF._angle;
aF._rotates();
aF._positions();
aF.refreshBounds();
aF.refresh();
aF.redraw();
},_rotates:function(){var aE=this,aC,aD;
aE.initialRotates=[];
for(aC=0;
aC<aE.shapes.length;
aC++){aD=aE.shapes[aC];
aE.initialRotates.push(aD.rotate().angle);
}},_positions:function(){var aE=this,aC,aD;
aE.initialStates=[];
for(aC=0;
aC<aE.shapes.length;
aC++){aD=aE.shapes[aC];
aE.initialStates.push(aD.bounds());
}},_hover:function(aI,aD){var aC=this.options.editable;
if(aC&&aC.resize){var aF=aC.resize.handles,aG=aF.hover,aH=aF.stroke,aE=aF.fill;
if(aI&&ay.isDefined(aG.stroke)){aH=v({},aH,aG.stroke);
}if(aI&&ay.isDefined(aG.fill)){aE=aG.fill;
}aD.stroke(aH.color,aH.width,aH.opacity);
aD.fill(aE.color,aE.opacity);
}},start:function(aD){this._sp=aD;
this._cp=aD;
this._lp=aD;
this._manipulating=true;
this._internalChange=true;
this.shapeStates=[];
for(var aC=0;
aC<this.shapes.length;
aC++){var aE=this.shapes[aC];
this.shapeStates.push(aE.bounds());
}},redraw:function(){var aH=this,aE,aD,aC=aH.options.editable,aF=aC.resize,aG=aC.rotate,aI=aC&&aF?true:false,aJ=aC&&aG?true:false;
for(aE=0;
aE<this.map.length;
aE++){aD=this.map[aE];
aD.visual.visible(aI);
}if(aH.rotationThumb){aH.rotationThumb.visible(aJ);
}},angle:function(aC){if(x(aC)){this._angle=aC;
}return this._angle;
},rotate:function(){var aC=this._innerBounds.center();
var aD=this.angle();
this._internalChange=true;
for(var aE=0;
aE<this.shapes.length;
aE++){var aF=this.shapes[aE];
aD=(aD+this.initialRotates[aE]-this._startAngle)%360;
aF.rotate(aD,aC);
}this.refresh();
},move:function(aK,aP){var aH,aI,aJ=new V(),aG=new V(),aD,aE,aS,aL,aC,aM,aF=0,aT,aQ,aR;
if(aK.y===-2&&aK.x===-1){aE=this._innerBounds.center();
this._angle=this._truncateAngle(ay.findAngle(aE,aP));
for(aL=0;
aL<this.shapes.length;
aL++){aS=this.shapes[aL];
aC=(this._angle+this.initialRotates[aL]-this._startAngle)%360;
aS.rotate(aC,aE);
if(aS.hasOwnProperty("layout")){aS.layout(aS);
}this._rotating=true;
}this.refresh();
}else{if(this.diagram.options.snap.enabled===true){var aU=this._truncateDistance(aP.minus(this._lp));
if(aU.x===0&&aU.y===0){this._cp=aP;
return;
}aH=aU;
this._lp=new V(this._lp.x+aU.x,this._lp.y+aU.y);
}else{aH=aP.minus(this._cp);
}if(aK.x===0&&aK.y===0){aG=aJ=aH;
aI=true;
}else{if(this._angle){aH.rotate(new V(0,0),this._angle);
}if(aK.x==-1){aJ.x=aH.x;
}else{if(aK.x==1){aG.x=aH.x;
}}if(aK.y==-1){aJ.y=aH.y;
}else{if(aK.y==1){aG.y=aH.y;
}}}if(!aI){aT=G(aK,this._innerBounds);
aQ=(this._innerBounds.width+aH.x*aK.x)/this._innerBounds.width;
aR=(this._innerBounds.height+aH.y*aK.y)/this._innerBounds.height;
}for(aL=0;
aL<this.shapes.length;
aL++){aS=this.shapes[aL];
aD=aS.bounds();
if(aI){aM=this._displaceBounds(aD,aJ,aG,aI);
}else{aM=aD.clone();
aM.scale(aQ,aR,aT,this._innerBounds.center(),aS.rotate().angle);
var aN=aM.center();
aN.rotate(aD.center(),-this._angle);
aM=new aa(aN.x-aM.width/2,aN.y-aM.height/2,aM.width,aM.height);
}if(aM.width>=aS.options.minWidth&&aM.height>=aS.options.minHeight){var aO=aD;
aS.bounds(aM);
if(aS.hasOwnProperty("layout")){aS.layout(aS,aO,aM);
}aS.rotate(aS.rotate().angle);
aF+=1;
}}if(aF==aL){aM=this._displaceBounds(this._innerBounds,aJ,aG,aI);
this.bounds(aM);
this.refresh();
}this._positions();
}this._cp=aP;
},_truncatePositionToGuides:function(aC){if(this.diagram.ruler){return this.diagram.ruler.truncatePositionToGuides(aC);
}return aC;
},_truncateSizeToGuides:function(aC){if(this.diagram.ruler){return this.diagram.ruler.truncateSizeToGuides(aC);
}return aC;
},_truncateAngle:function(aC){var aD=Math.max(this.diagram.options.snap.angle,5);
return this.diagram.options.snap.enabled===true?Math.floor((aC%360)/aD)*aD:(aC%360);
},_truncateDistance:function(aC){if(aC instanceof A.Point){return new A.Point(this._truncateDistance(aC.x),this._truncateDistance(aC.y));
}else{var aD=Math.max(this.diagram.options.snap.size,5);
return this.diagram.options.snap.enabled===true?Math.floor(aC/aD)*aD:aC;
}},_displaceBounds:function(aC,aG,aE,aF){var aJ=aC.topLeft().plus(aG),aD=aC.bottomRight().plus(aE),aH=aa.fromPoints(aJ,aD),aI;
if(!aF){aI=aH.center();
aI.rotate(aC.center(),-this._angle);
aH=new aa(aI.x-aH.width/2,aI.y-aH.height/2,aH.width,aH.height);
}return aH;
},stop:function(){var aF,aD,aE;
if(this._cp!=this._sp){if(this._rotating){aF=new ae(this,this.shapes,this.initialRotates);
this._rotating=false;
}else{if(this._diffStates()){if(this.diagram.ruler){for(aD=0;
aD<this.shapes.length;
aD++){aE=this.shapes[aD];
var aC=aE.bounds();
aC=this._truncateSizeToGuides(this._truncatePositionToGuides(aC));
aE.bounds(aC);
this.refreshBounds();
this.refresh();
}}for(aD=0;
aD<this.shapes.length;
aD++){aE=this.shapes[aD];
aE.updateModel();
}aF=new at(this.shapes,this.shapeStates,this);
this.diagram._syncShapeChanges();
}}}this._manipulating=aw;
this._internalChange=aw;
this._rotating=aw;
return aF;
},_diffStates:function(){var aE=this.shapes;
var aF=this.shapeStates;
var aC;
for(var aD=0;
aD<aE.length;
aD++){if(!aE[aD].bounds().equals(aF[aD])){return true;
}}return false;
},refreshBounds:function(){var aC=this.shapes.length==1?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,true);
this.bounds(aC);
},refresh:function(){var aF=this,aC,aD;
if(this.shapes.length>0){aD=this.bounds();
this.visual.visible(true);
this.visual.position(aD.topLeft());
a.each(this.map,function(){aC=aF._getHandleBounds(new V(this.x,this.y));
this.visual.position(aC.topLeft());
});
this.visual.position(aD.topLeft());
var aE=new V(aD.width/2,aD.height/2);
this.visual.rotate(this._angle,aE);
this.rect.redraw({width:aD.width,height:aD.height});
if(this.rotationThumb){var aG=this.options.editable.rotate.thumb;
this._rotationThumbBounds=new aa(aD.center().x,aD.y+aG.y,0,0).inflate(aG.width);
this.rotationThumb.redraw({x:aD.width/2-aG.width/2});
}}else{this.visual.visible(false);
}}});
var aj=j.extend({init:function(aC){var aD=aC.options.selectable;
this.options=v({},this.options,aD);
this.visual=new ab(this.options);
this.diagram=aC;
},options:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:au}},start:function(aC){this._sp=this._ep=aC;
this.refresh();
this.diagram._adorn(this,true);
},end:function(){this._sp=this._ep=aw;
this.diagram._adorn(this,false);
},bounds:function(aC){if(aC){this._bounds=aC;
}return this._bounds;
},move:function(aC){this._ep=aC;
this.refresh();
},refresh:function(){if(this._sp){var aC=aa.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));
this.bounds(aa.fromPoints(this._sp,this._ep));
this.visual.position(aC.topLeft());
this.visual.redraw({height:aC.height+1,width:aC.width+1});
}}});
var s=j.extend({init:function(aC){this.options=v({},aC.options);
this._c=aC;
this.visual=new i(this.options);
this.refresh();
},_hover:function(aG){var aE=this.options,aD=aE.hover,aF=aE.stroke,aC=aE.fill;
if(aG&&ay.isDefined(aD.stroke)){aF=v({},aF,aD.stroke);
}if(aG&&ay.isDefined(aD.fill)){aC=aD.fill;
}this.visual.redraw({stroke:aF,fill:aC});
},refresh:function(){var aC=this._c.shape.diagram.modelToView(this._c.position()),aD=aC.minus(this._c.shape.bounds("transformed").topLeft()),aE=new aa(aC.x,aC.y,0,0);
aE.inflate(this.options.width/2,this.options.height/2);
this._visualBounds=aE;
this.visual.redraw({center:new V(aD.x,aD.y)});
},_hitTest:function(aC){var aD=this._c.shape.diagram.modelToView(aC);
return this._visualBounds.contains(aD);
}});
v(A,{CompositeUnit:k,TransformUnit:at,PanUndoUnit:T,AddShapeUnit:c,AddConnectionUnit:b,DeleteShapeUnit:z,DeleteConnectionUnit:y,ConnectionEditAdorner:l,ConnectionTool:q,ConnectorVisual:s,UndoRedoService:ax,ResizingAdorner:ac,Selector:aj,ToolService:aq,ConnectorsAdorner:r,LayoutUndoUnit:L,ConnectionEditUnit:o,ToFrontUnit:ap,ToBackUnit:ao,ConnectionRouterBase:p,PolylineRouter:X,CascadingRouter:h,SelectionTool:ai,ScrollerTool:ah,PointerTool:W,ConnectionEditTool:m,RotateUnit:ae});
})(window.kendo.jQuery);
(function(a,y){var l=window.kendo,e=l.dataviz.diagram,i=e.Graph,q=e.Node,p=e.Link,c=l.deepExtend,u=e.Size,s=e.Rect,g=e.Dictionary,t=e.Set,k=e.Graph,z=e.Utils,r=e.Point,h=1e-06,d=Math.PI/180,b=z.contains,j=a.grep;
var n=l.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:false,limitToView:false,friction:0.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:false,ignoreContainers:true,layoutContainerChildren:false,ignoreInvisible:true,animateTransitions:false},init:function(){},gridLayoutComponents:function(C){if(!C){throw"No components supplied.";
}z.forEach(C,function(Q){Q.calcBounds();
});
C.sort(function(Q,R){return R.bounds.width-Q.bounds.width;
});
var H=this.options.grid.width,I=this.options.grid.componentSpacingX,J=this.options.grid.componentSpacingY,F=0,M=this.options.grid.offsetX,N=this.options.grid.offsetY,O=M,P=N,G,K=[],L=[];
while(C.length>0){if(O>=H){O=M;
P+=F+J;
F=0;
}var B=C.pop();
this.moveToOffset(B,new r(O,P));
for(G=0;
G<B.nodes.length;
G++){L.push(B.nodes[G]);
}for(G=0;
G<B.links.length;
G++){K.push(B.links[G]);
}var A=B.bounds;
var D=A.height;
if(D<=0||isNaN(D)){D=0;
}var E=A.width;
if(E<=0||isNaN(E)){E=0;
}if(D>=F){F=D;
}O+=E+I;
}return{nodes:L,links:K};
},moveToOffset:function(B,K){var E,F,A=B.bounds,C=K.x-A.x,D=K.y-A.y;
for(E=0;
E<B.nodes.length;
E++){var I=B.nodes[E];
var J=I.bounds();
if(J.width===0&&J.height===0&&J.x===0&&J.y===0){J=new s(0,0,0,0);
}J.x+=C;
J.y+=D;
I.bounds(J);
}for(E=0;
E<B.links.length;
E++){var G=B.links[E];
if(G.points){var H=[];
var L=G.points;
for(F=0;
F<L.length;
F++){var M=L[F];
M.x+=C;
M.y+=D;
H.push(M);
}G.points=H;
}}this.currentHorizontalOffset+=A.width+this.options.grid.offsetX;
return new r(C,D);
},transferOptions:function(A){this.options=l.deepExtend({},this.defaultOptions);
if(z.isUndefined(A)){return;
}this.options=l.deepExtend(this.options,A||{});
}});
var f=l.Class.extend({init:function(A){this.nodeMap=new g();
this.shapeMap=new g();
this.nodes=[];
this.edges=[];
this.edgeMap=new g();
this.finalNodes=[];
this.finalLinks=[];
this.ignoredConnections=[];
this.ignoredShapes=[];
this.hyperMap=new g();
this.hyperTree=new i();
this.finalGraph=null;
this.diagram=A;
},convert:function(A){if(z.isUndefined(this.diagram)){throw"No diagram to convert.";
}this.options=l.deepExtend({ignoreInvisible:true,ignoreContainers:true,layoutContainerChildren:false},A||{});
this.clear();
this._renormalizeShapes();
this._renormalizeConnections();
this.finalNodes=new g(this.nodes);
this.finalLinks=new g(this.edges);
this.finalGraph=new i();
this.finalNodes.forEach(function(B){this.finalGraph.addNode(B);
},this);
this.finalLinks.forEach(function(B){this.finalGraph.addExistingLink(B);
},this);
return this.finalGraph;
},mapConnection:function(A){return this.edgeMap.first(function(B){return b(this.edgeMap.get(B),A);
});
},mapShape:function(E){var C=this.nodeMap.keys();
for(var A=0,D=C.length;
A<D;
A++){var B=C[A];
if(b(this.nodeMap.get(B),E)){return B;
}}},getEdge:function(A,B){return z.first(A.links,function(C){return C.getComplement(A)===B;
});
},clear:function(){this.finalGraph=null;
this.hyperTree=(!this.options.ignoreContainers&&this.options.layoutContainerChildren)?new k():null;
this.hyperMap=(!this.options.ignoreContainers&&this.options.layoutContainerChildren)?new g():null;
this.nodeMap=new g();
this.shapeMap=new g();
this.nodes=[];
this.edges=[];
this.edgeMap=new g();
this.ignoredConnections=[];
this.ignoredShapes=[];
this.finalNodes=[];
this.finalLinks=[];
},listToRoot:function(A){var B=[];
var C=A.container;
if(!C){return B;
}B.push(C);
while(C.parentContainer){C=C.parentContainer;
B.push(C);
}B.reverse();
return B;
},firstNonIgnorableContainer:function(A){if(A.isContainer&&!this._isIgnorableItem(A)){return A;
}return !A.parentContainer?null:this.firstNonIgnorableContainer(A.parentContainer);
},isContainerConnection:function(A,B){if(A.isContainer&&this.isDescendantOf(A,B)){return true;
}return B.isContainer&&this.isDescendantOf(B,A);
},isDescendantOf:function(F,A){if(!F.isContainer){throw"Expecting a container.";
}if(F===A){return false;
}if(b(F.children,A)){return true;
}var C=[];
for(var D=0,E=F.children.length;
D<E;
D++){var B=F.children[D];
if(B.isContainer&&this.isDescendantOf(B,A)){C.push(B);
}}return C.length>0;
},isIgnorableItem:function(A){if(this.options.ignoreInvisible){if(A.isCollapsed&&this._isVisible(A)){return false;
}if(!A.isCollapsed&&this._isVisible(A)){return false;
}return true;
}else{return A.isCollapsed&&!this._isTop(A);
}},isShapeMapped:function(A){return A.isCollapsed&&!this._isVisible(A)&&!this._isTop(A);
},leastCommonAncestor:function(A,C){if(!A){throw"Parameter should not be null.";
}if(!C){throw"Parameter should not be null.";
}if(!this.hyperTree){throw"No hypertree available.";
}var B=this.listToRoot(A);
var D=this.listToRoot(C);
var E=null;
if(z.isEmpty(B)||z.isEmpty(D)){return this.hyperTree.root.data;
}var G=B[0];
var H=D[0];
var F=0;
while(G===H){E=B[F];
F++;
if(F>=B.length||F>=D.length){break;
}G=B[F];
H=D[F];
}if(!E){return this.hyperTree.root.data;
}else{return j(this.hyperTree.nodes,function(I){return I.data.container===E;
});
}},_isTop:function(A){return !A.parentContainer;
},_isVisible:function(A){if(!A.visible()){return false;
}return !A.parentContainer?A.visible():this._isVisible(A.parentContainer);
},_isCollapsed:function(A){if(A.isContainer&&A.isCollapsed){return true;
}return A.parentContainer&&this._isCollapsed(A.parentContainer);
},_renormalizeShapes:function(){if(this.options.ignoreContainers){for(var A=0,B=this.diagram.shapes.length;
A<B;
A++){var D=this.diagram.shapes[A];
if((this.options.ignoreInvisible&&!this._isVisible(D))||D.isContainer){this.ignoredShapes.push(D);
continue;
}var C=new q(D.id,D);
C.isVirtual=false;
this.nodeMap.add(C,[D]);
this.nodes.push(C);
}}else{throw"Containers are not supported yet, but stay tuned.";
}},_renormalizeConnections:function(){if(this.diagram.connections.length===0){return;
}for(var B=0,C=this.diagram.connections.length;
B<C;
B++){var A=this.diagram.connections[B];
if(this.isIgnorableItem(A)){this.ignoredConnections.push(A);
continue;
}var G=!A.sourceConnector?null:A.sourceConnector.shape;
var E=!A.targetConnector?null:A.targetConnector.shape;
if(!G||!E){this.ignoredConnections.push(A);
continue;
}if(b(this.ignoredShapes,G)&&!this.shapeMap.containsKey(G)){this.ignoredConnections.push(A);
continue;
}if(b(this.ignoredShapes,E)&&!this.shapeMap.containsKey(E)){this.ignoredConnections.push(A);
continue;
}if(this.shapeMap.containsKey(G)){G=this.shapeMap[G];
}if(this.shapeMap.containsKey(E)){E=this.shapeMap[E];
}var H=this.mapShape(G);
var F=this.mapShape(E);
if((H===F)||this.areConnectedAlready(H,F)){this.ignoredConnections.push(A);
continue;
}if(H===null||F===null){throw"A shape was not mapped to a node.";
}if(this.options.ignoreContainers){if(H.isVirtual||F.isVirtual){this.ignoredConnections.push(A);
continue;
}var D=new p(H,F,A.id,A);
this.edgeMap.add(D,[A]);
this.edges.push(D);
}else{throw"Containers are not supported yet, but stay tuned.";
}}},areConnectedAlready:function(B,A){return z.any(this.edges,function(C){return C.source===B&&C.target===A||C.source===A&&C.target===B;
});
}});
var v=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"Diagram is not specified.";
}this.diagram=A;
},layout:function(G){this.transferOptions(G);
var A=new f(this.diagram);
var E=A.convert(G);
if(E.isEmpty()){return;
}var C=E.getConnectedComponents();
if(z.isEmpty(C)){return;
}for(var F=0;
F<C.length;
F++){var B=C[F];
this.layoutGraph(B,G);
}var D=this.gridLayoutComponents(C);
return new e.LayoutState(this.diagram,D);
},layoutGraph:function(A,D){if(z.isDefined(D)){this.transferOptions(D);
}this.graph=A;
var C=this.options.nodeDistance*9;
this.temperature=C;
var B=this._expectedBounds();
this.width=B.width;
this.height=B.height;
for(var E=0;
E<this.options.iterations;
E++){this.refineStage=E>=this.options.iterations*5/6;
this.tick();
this.temperature=this.refineStage?C/30:C*(1-E/(2*this.options.iterations));
}},tick:function(){var A;
for(A=0;
A<this.graph.nodes.length;
A++){this._repulsion(this.graph.nodes[A]);
}for(A=0;
A<this.graph.links.length;
A++){this._attraction(this.graph.links[A]);
}for(A=0;
A<this.graph.nodes.length;
A++){var B=this.graph.nodes[A];
var C=Math.sqrt(B.dx*B.dx+B.dy*B.dy);
if(C===0){return;
}B.x+=Math.min(C,this.temperature)*B.dx/C;
B.y+=Math.min(C,this.temperature)*B.dy/C;
if(this.options.limitToView){B.x=Math.min(this.width,Math.max(B.width/2,B.x));
B.y=Math.min(this.height,Math.max(B.height/2,B.y));
}}},_shake:function(B){var C=Math.random()*this.options.nodeDistance/4;
var A=Math.random()*2*Math.PI;
B.x+=C*Math.cos(A);
B.y-=C*Math.sin(A);
},_InverseSquareForce:function(A,H,G){var D;
if(!this.refineStage){D=Math.pow(A,2)/Math.pow(this.options.nodeDistance,2);
}else{var B=H.x-G.x;
var C=H.y-G.y;
var J=H.width/2;
var F=H.height/2;
var I=G.width/2;
var E=G.height/2;
D=(Math.pow(B,2)/Math.pow(J+I+this.options.nodeDistance,2))+(Math.pow(C,2)/Math.pow(F+E+this.options.nodeDistance,2));
}return D*4/3;
},_SquareForce:function(A,C,B){return 1/this._InverseSquareForce(A,C,B);
},_repulsion:function(A){A.dx=0;
A.dy=0;
z.forEach(this.graph.nodes,function(C){if(C===A){return;
}while(A.x===C.x&&A.y===C.y){this._shake(C);
}var E=A.x-C.x;
var F=A.y-C.y;
var B=Math.sqrt(E*E+F*F);
var D=this._SquareForce(B,A,C)*2;
A.dx+=(E/B)*D;
A.dy+=(F/B)*D;
},this);
},_attraction:function(E){var G=E.target;
var F=E.source;
if(F===G){return;
}while(F.x===G.x&&F.y===G.y){this._shake(G);
}var H=F.x-G.x;
var I=F.y-G.y;
var B=Math.sqrt(H*H+I*I);
var A=this._InverseSquareForce(B,F,G)*5;
var C=(H/B)*A;
var D=(I/B)*A;
G.dx+=C;
G.dy+=D;
F.dx-=C;
F.dy-=D;
},_expectedBounds:function(){var F,D=this.graph.nodes.length,E=1.5,C=4;
if(D===0){return F;
}F=z.fold(this.graph.nodes,function(K,J){var I=J.width*J.height;
if(I>0){K+=Math.sqrt(I);
return K;
}return 0;
},0,this);
var A=F/D;
var G=A*Math.ceil(Math.sqrt(D));
var H=G*Math.sqrt(E);
var B=G/Math.sqrt(E);
return{width:H*C,height:B*C};
}});
var x=l.Class.extend({init:function(A){this.center=null;
this.options=A;
},layout:function(B,A){this.graph=B;
if(!this.graph.nodes||this.graph.nodes.length===0){return;
}if(!b(this.graph.nodes,A)){throw"The given root is not in the graph.";
}this.center=A;
this.graph.cacheRelationships();
this.layoutSwitch();
},layoutLeft:function(C){this.setChildrenDirection(this.center,"Left",false);
this.setChildrenLayout(this.center,"Default",false);
var A=0,G=0,I,B,D;
for(B=0;
B<C.length;
B++){D=C[B];
D.TreeDirection="Left";
var F=this.measure(D,u.Empty);
G=Math.max(G,F.Width);
A+=F.height+this.options.verticalSeparation;
}A-=this.options.verticalSeparation;
var H=this.center.x-this.options.horizontalSeparation;
I=this.center.y+((this.center.height-A)/2);
for(B=0;
B<C.length;
B++){D=C[B];
var E=new r(H-D.Size.width,I);
this.arrange(D,E);
I+=D.Size.height+this.options.verticalSeparation;
}},layoutRight:function(E){this.setChildrenDirection(this.center,"Right",false);
this.setChildrenLayout(this.center,"Default",false);
var A=0,G=0,I,B,C;
for(B=0;
B<E.length;
B++){C=E[B];
C.TreeDirection="Right";
var F=this.measure(C,u.Empty);
G=Math.max(G,F.Width);
A+=F.height+this.options.verticalSeparation;
}A-=this.options.verticalSeparation;
var H=this.center.x+this.options.horizontalSeparation+this.center.width;
I=this.center.y+((this.center.height-A)/2);
for(B=0;
B<E.length;
B++){C=E[B];
var D=new r(H,I);
this.arrange(C,D);
I+=C.Size.height+this.options.verticalSeparation;
}},layoutUp:function(E){this.setChildrenDirection(this.center,"Up",false);
this.setChildrenLayout(this.center,"Default",false);
var F=0,H,B,A;
for(A=0;
A<E.length;
A++){B=E[A];
B.TreeDirection="Up";
var D=this.measure(B,u.Empty);
F+=D.width+this.options.horizontalSeparation;
}F-=this.options.horizontalSeparation;
var G=this.center.x+(this.center.width/2)-(F/2);
for(A=0;
A<E.length;
A++){B=E[A];
H=this.center.y-this.options.verticalSeparation-B.Size.height;
var C=new r(G,H);
this.arrange(B,C);
G+=B.Size.width+this.options.horizontalSeparation;
}},layoutDown:function(A){var C,B;
this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
var F=0,H;
for(B=0;
B<A.length;
B++){C=A[B];
C.treeDirection="Down";
var E=this.measure(C,u.Empty);
F+=E.width+this.options.horizontalSeparation;
}F-=this.options.horizontalSeparation;
var G=this.center.x+(this.center.width/2)-(F/2);
H=this.center.y+this.options.verticalSeparation+this.center.height;
for(B=0;
B<A.length;
B++){C=A[B];
var D=new r(G,H);
this.arrange(C,D);
G+=C.Size.width+this.options.horizontalSeparation;
}},layoutRadialTree:function(){this.setChildrenDirection(this.center,"Radial",false);
this.setChildrenLayout(this.center,"Default",false);
this.previousRoot=null;
var B=this.options.startRadialAngle*d;
var A=this.options.endRadialAngle*d;
if(A<=B){throw"Final angle should not be less than the start angle.";
}this.maxDepth=0;
this.origin=new r(this.center.x,this.center.y);
this.calculateAngularWidth(this.center,0);
if(this.maxDepth>0){this.radialLayout(this.center,this.options.radialFirstLevelSeparation,B,A);
}this.center.Angle=A-B;
},tipOverTree:function(A,F){if(z.isUndefined(F)){F=0;
}this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
this.setChildrenLayout(this.center,"Underneath",false,F);
var G=0,I,C,B;
for(B=0;
B<A.length;
B++){C=A[B];
C.TreeDirection="Down";
var E=this.measure(C,u.Empty);
G+=E.width+this.options.horizontalSeparation;
}G-=this.options.horizontalSeparation;
G-=A[A.length-1].width;
G+=A[A.length-1].associatedShape.bounds().width;
var H=this.center.x+(this.center.width/2)-(G/2);
I=this.center.y+this.options.verticalSeparation+this.center.height;
for(B=0;
B<A.length;
B++){C=A[B];
var D=new r(H,I);
this.arrange(C,D);
H+=C.Size.width+this.options.horizontalSeparation;
}},calculateAngularWidth:function(H,C){if(C>this.maxDepth){this.maxDepth=C;
}var A=0,I=1000,E=1000,D=C===0?0:Math.sqrt((I*I)+(E*E))/C;
if(H.children.length>0){for(var F=0,G=H.children.length;
F<G;
F++){var B=H.children[F];
A+=this.calculateAngularWidth(B,C+1);
}A=Math.max(D,A);
}else{A=D;
}H.sectorAngle=A;
return A;
},sortChildren:function(J){var B=0,G;
if(J.parents.length>1){throw"Node is not part of a tree.";
}var L=J.parents[0];
if(L){var M=new r(L.x,L.y);
var K=new r(J.x,J.y);
B=this.normalizeAngle(Math.atan2(M.y-K.y,M.x-K.x));
}var F=J.children.length;
if(F===0){return null;
}var A=[];
var H=[];
for(G=0;
G<F;
++G){var C=J.children[G];
var I=new r(C.x,C.y);
H[G]=G;
A[G]=this.normalizeAngle(-B+Math.atan2(I.y-I.y,I.x-I.x));
}z.bisort(A,H);
var E=[];
var D=J.children;
for(G=0;
G<F;
++G){E.push(D[H[G]]);
}return E;
},normalizeAngle:function(A){while(A>Math.PI*2){A-=2*Math.PI;
}while(A<0){A+=Math.PI*2;
}return A;
},radialLayout:function(J,L,N,F){var D=F-N;
var E=D/2;
var K=J.sectorAngle;
var G=0;
var M=this.sortChildren(J);
for(var H=0,I=M.length;
H<I;
H++){var B=M[H];
var C=B;
var A=C.sectorAngle/K;
if(B.children.length>0){this.radialLayout(B,L+this.options.radialSeparation,N+(G*D),N+((G+A)*D));
}this.setPolarLocation(B,L,N+(G*D)+(A*E));
C.angle=A*D;
G+=A;
}},setPolarLocation:function(B,C,A){B.x=this.origin.x+(C*Math.cos(A));
B.y=this.origin.y+(C*Math.sin(A));
B.BoundingRectangle=new s(B.x,B.y,B.width,B.height);
},setChildrenDirection:function(C,A,B){var D=C.treeDirection;
this.graph.depthFirstTraversal(C,function(E){E.treeDirection=A;
});
if(!B){C.treeDirection=D;
}},setChildrenLayout:function(C,B,A,E){if(z.isUndefined(E)){E=0;
}var D=C.childrenLayout;
if(E>0){this.graph.assignLevels(C);
this.graph.depthFirstTraversal(C,function(F){if(F.level>=E+1){F.childrenLayout=B;
}});
}else{this.graph.depthFirstTraversal(C,function(F){F.childrenLayout=B;
});
if(!A){C.childrenLayout=D;
}}},measure:function(F,C){var L=0,D=0,I;
var H=new u(0,0);
if(!F){throw"";
}var A=F.associatedShape.bounds();
var K=A.width;
var J=A.height;
if(F.parents.length!==1){throw"Node not in a spanning tree.";
}var G=F.parents[0];
if(F.treeDirection==="Undefined"){F.treeDirection=G.treeDirection;
}if(z.isEmpty(F.children)){H=new u(Math.abs(K)<h?50:K,Math.abs(J)<h?25:J);
}else{if(F.children.length===1){switch(F.treeDirection){case"Radial":I=this.measure(F.children[0],C);
L=K+(this.options.radialSeparation*Math.cos(F.AngleToParent))+I.width;
D=J+Math.abs(this.options.radialSeparation*Math.sin(F.AngleToParent))+I.height;
break;
case"Left":case"Right":switch(F.childrenLayout){case"TopAlignedWithParent":break;
case"BottomAlignedWithParent":break;
case"Underneath":I=this.measure(F.children[0],C);
L=K+I.width+this.options.underneathHorizontalOffset;
D=J+this.options.underneathVerticalTopOffset+I.height;
break;
case"Default":I=this.measure(F.children[0],C);
L=K+this.options.horizontalSeparation+I.width;
D=Math.max(J,I.height);
break;
default:throw"Unhandled TreeDirection in the Radial layout measuring.";
}break;
case"Up":case"Down":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=this.measure(F.children[0],C);
L=Math.max(K,I.width+this.options.underneathHorizontalOffset);
D=J+this.options.underneathVerticalTopOffset+I.height;
break;
case"Default":I=this.measure(F.children[0],C);
D=J+this.options.verticalSeparation+I.height;
L=Math.max(K,I.width);
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}H=new u(L,D);
}else{var E,B;
switch(F.treeDirection){case"Left":case"Right":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":L=K;
D=J+this.options.underneathVerticalTopOffset;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,I.width+this.options.underneathHorizontalOffset);
D+=I.height+this.options.underneathVerticalSeparation;
}D-=this.options.underneathVerticalSeparation;
break;
case"Default":L=K;
D=0;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,K+this.options.horizontalSeparation+I.width);
D+=I.height+this.options.verticalSeparation;
}D-=this.options.verticalSeparation;
break;
default:throw"Unhandled TreeDirection in the Right layout measuring.";
}break;
case"Up":case"Down":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":L=K;
D=J+this.options.underneathVerticalTopOffset;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,I.width+this.options.underneathHorizontalOffset);
D+=I.height+this.options.underneathVerticalSeparation;
}D-=this.options.underneathVerticalSeparation;
break;
case"Default":L=0;
D=0;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L+=I.width+this.options.horizontalSeparation;
D=Math.max(D,I.height+this.options.verticalSeparation+J);
}L-=this.options.horizontalSeparation;
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}H=new u(L,D);
}}F.SectorAngle=Math.sqrt((L*L/4)+(D*D/4));
F.Size=H;
return H;
},arrange:function(E,G){var D,H,B,F,C,A=E.associatedShape.bounds();
var K=A.width;
var J=A.height;
if(z.isEmpty(E.children)){E.x=G.x;
E.y=G.y;
E.BoundingRectangle=new s(G.x,G.y,K,J);
}else{var L,M;
var I;
switch(E.treeDirection){case"Left":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<F.children.length;
D++){F=F.children[D];
L=I.x-F.associatedShape.width-this.options.underneathHorizontalOffset;
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x+E.Size.width-K,G.y+((E.Size.height-J)/2));
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=I.x-this.options.horizontalSeparation;
M=G.y;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L-F.Size.width,M);
this.arrange(F,H);
M+=F.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Right":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+K+this.options.underneathHorizontalOffset;
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x,G.y+((E.Size.height-J)/2));
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+K+this.options.horizontalSeparation;
M=G.y;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Up":I=new r(G.x+((E.Size.width-K)/2),G.y+E.Size.height-J);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
if(Math.abs(I.x-G.x)<h){C=0;
for(D=0;
D<E.children.length;
D++){B=E.children[D];
C+=B.Size.width+this.options.horizontalSeparation;
}C-=this.options.horizontalSeparation;
L=G.x+((K-C)/2);
}else{L=G.x;
}for(D=0;
D<E.children.length;
D++){F=E.children[D];
M=I.y-this.options.verticalSeparation-F.Size.height;
H=new r(L,M);
this.arrange(F,H);
L+=F.Size.width+this.options.horizontalSeparation;
}break;
case"Down":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+this.options.underneathHorizontalOffset;
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x+((E.Size.width-K)/2),G.y);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
if(Math.abs(I.x-G.x)<h){C=0;
for(D=0;
D<E.children.length;
D++){B=E.children[D];
C+=B.Size.width+this.options.horizontalSeparation;
}C-=this.options.horizontalSeparation;
L=G.x+((K-C)/2);
}else{L=G.x;
}for(D=0;
D<E.children.length;
D++){F=E.children[D];
M=I.y+this.options.verticalSeparation+J;
H=new r(L,M);
this.arrange(F,H);
L+=F.Size.width+this.options.horizontalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"None":break;
default:throw"Unsupported TreeDirection";
}}},layoutSwitch:function(){if(!this.center){return;
}if(z.isEmpty(this.center.children)){return;
}var F=this.options.subtype;
if(z.isUndefined(F)){F="Down";
}var E,D,B,C;
var A=this.center.children;
switch(F.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();
break;
case"mindmaphorizontal":case"mindmap":E=this.center.children;
if(this.center.children.length===1){this.layoutRight(E);
}else{C=A.length/2;
D=j(this.center.children,function(G){return z.indexOf(A,G)<C;
});
B=j(this.center.children,function(G){return z.indexOf(A,G)>=C;
});
this.layoutLeft(D);
this.layoutRight(B);
}break;
case"mindmapvertical":E=this.center.children;
if(this.center.children.length===1){this.layoutDown(E);
}else{C=A.length/2;
D=j(this.center.children,function(G){return z.indexOf(A,G)<C;
});
B=j(this.center.children,function(G){return z.indexOf(A,G)>=C;
});
this.layoutUp(D);
this.layoutDown(B);
}break;
case"right":this.layoutRight(this.center.children);
break;
case"left":this.layoutLeft(this.center.children);
break;
case"up":case"bottom":this.layoutUp(this.center.children);
break;
case"down":case"top":this.layoutDown(this.center.children);
break;
case"tipover":case"tipovertree":if(this.options.tipOverTreeStartLevel<0){throw"The tip-over level should be a positive integer.";
}this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel);
break;
case"undefined":case"none":break;
}}});
var w=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"No diagram specified.";
}this.diagram=A;
},layout:function(C){this.transferOptions(C);
var A=new f(this.diagram);
this.graph=A.convert();
var B=this.layoutComponents();
return new e.LayoutState(this.diagram,B);
},layoutComponents:function(){if(this.graph.isEmpty()){return;
}var B=this.graph.getConnectedComponents();
if(z.isEmpty(B)){return;
}var D=new x(this.options);
var H=[];
for(var C=0;
C<B.length;
C++){var A=B[C];
var G=this.getTree(A);
if(!G){throw"Failed to find a spanning tree for the component.";
}var E=G.root;
var F=G.tree;
D.layout(F,E);
H.push(F);
}return this.gridLayoutComponents(H);
},getTree:function(B){var G=null;
if(this.options.roots&&this.options.roots.length>0){for(var C=0,E=B.nodes.length;
C<E;
C++){var F=B.nodes[C];
for(var D=0;
D<this.options.roots.length;
D++){var A=this.options.roots[D];
if(A===F.associatedShape){G=F;
break;
}}}}if(!G){G=B.root();
if(!G){throw"Unable to find a root for the tree.";
}}return this.getTreeForRoot(B,G);
},getTreeForRoot:function(A,B){var C=A.getSpanningTree(B);
if(z.isUndefined(C)||C.isEmpty()){return null;
}return{tree:C,root:C.root};
}});
var m=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"Diagram is not specified.";
}this.diagram=A;
},layout:function(G){this.transferOptions(G);
var A=new f(this.diagram);
var E=A.convert(G);
if(E.isEmpty()){return;
}var C=E.getConnectedComponents();
if(z.isEmpty(C)){return;
}for(var F=0;
F<C.length;
F++){var B=C[F];
this.layoutGraph(B,G);
}var D=this.gridLayoutComponents(C);
return new e.LayoutState(this.diagram,D);
},_initRuntimeProperties:function(){for(var A=0;
A<this.graph.nodes.length;
A++){var B=this.graph.nodes[A];
B.layer=-1;
B.downstreamLinkCount=0;
B.upstreamLinkCount=0;
B.isVirtual=false;
B.uBaryCenter=0;
B.dBaryCenter=0;
B.upstreamPriority=0;
B.downstreamPriority=0;
B.gridPosition=0;
}},_prepare:function(B){var A=[],C,D,H;
for(D=0;
D<B.links.length;
D++){B.links[D].depthOfDumminess=0;
}var G=new g();
z.forEach(B.nodes,function(O){if(O.incoming.length===0){G.set(O,0);
A.push(O);
}});
while(A.length>0){var K=A.shift();
for(C=0;
C<K.outgoing.length;
C++){H=K.outgoing[C];
var N=H.target;
if(G.containsKey(N)){G.set(N,Math.max(G.get(K)+1,G.get(N)));
}else{G.set(N,G.get(K)+1);
}if(!b(A,N)){A.push(N);
}}}var F=0;
G.forEachValue(function(O){F=Math.max(F,O);
});
var M=[];
z.addRange(M,G.keys());
M.sort(function(O,Q){var P=G.get(O);
var R=G.get(Q);
return z.sign(R-P);
});
for(var J=0;
J<M.length;
++J){var L=M[J];
var I=Number.MAX_VALUE;
if(L.outgoing.length===0){continue;
}for(D=0;
D<L.outgoing.length;
++D){H=L.outgoing[D];
I=Math.min(I,G.get(H.target));
}if(I>1){G.set(L,I-1);
}}this.layers=[];
for(C=0;
C<F+1;
C++){this.layers.push([]);
}G.forEach(function(P,O){P.layer=O;
this.layers[O].push(P);
},this);
for(D=0;
D<this.layers.length;
D++){var E=this.layers[D];
for(C=0;
C<E.length;
C++){E[C].gridPosition=C;
}}},layoutGraph:function(A,B){if(z.isUndefined(A)){throw"No graph given or graph analysis of the diagram failed.";
}if(z.isDefined(B)){this.transferOptions(B);
}this.graph=A;
A.setItemIndices();
var C=A.makeAcyclic();
this._initRuntimeProperties();
this._prepare(A,B);
this._dummify();
this._optimizeCrossings();
this._swapPairs();
this.arrangeNodes();
this._moveThingsAround();
this._dedummify();
z.forEach(C,function(D){if(D.points){D.points.reverse();
}});
},setMinDist:function(C,E,D){var B=C.layer;
var A=C.layerIndex;
this.minDistances[B][A]=D;
},getMinDist:function(F,I){var A=0,B=F.layerIndex,C=I.layerIndex,E=F.layer,H=Math.min(B,C),G=Math.max(B,C);
for(var D=H;
D<G;
++D){A+=this.minDistances[E][D];
}return A;
},placeLeftToRight:function(G){var H=new g(),I,L;
for(var A=0;
A<this.layers.length;
++A){var B=G[A];
if(!B){continue;
}for(I=0;
I<B.length;
I++){L=B[I];
if(!H.containsKey(L)){this.placeLeft(L,H,A);
}}var C=Number.POSITIVE_INFINITY;
for(I=0;
I<B.length;
I++){L=B[I];
var M=this.rightSibling(L);
if(M&&this.nodeLeftClass.get(M)!==A){C=Math.min(C,H.get(M)-H.get(L)-this.getMinDist(L,M));
}}if(C===Number.POSITIVE_INFINITY){var E=[];
for(I=0;
I<B.length;
I++){L=B[I];
var K=[];
z.addRange(K,this.upNodes.get(L));
z.addRange(K,this.downNodes.get(L));
for(var F=0;
F<K.length;
F++){var J=K[F];
if(this.nodeLeftClass.get(J)<A){E.push(H.get(J)-H.get(L));
}}}E.sort();
if(E.length===0){C=0;
}else{if(E.length%2===1){C=E[this.intDiv(E.length,2)];
}else{C=(E[this.intDiv(E.length,2)-1]+E[this.intDiv(E.length,2)])/2;
}}}for(I=0;
I<B.length;
I++){L=B[I];
H.set(L,H.get(L)+C);
}}return H;
},placeRightToLeft:function(L){var M=new g(),H,K;
for(var A=0;
A<this.layers.length;
++A){var B=L[A];
if(!B){continue;
}for(H=0;
H<B.length;
H++){K=B[H];
if(!M.containsKey(K)){this.placeRight(K,M,A);
}}var C=Number.NEGATIVE_INFINITY;
for(H=0;
H<B.length;
H++){K=B[H];
var G=this.leftSibling(K);
if(G&&this.nodeRightClass.get(G)!==A){C=Math.max(C,M.get(G)-M.get(K)+this.getMinDist(G,K));
}}if(C===Number.NEGATIVE_INFINITY){var E=[];
for(H=0;
H<B.length;
H++){K=B[H];
var J=[];
z.addRange(J,this.upNodes.get(K));
z.addRange(J,this.downNodes.get(K));
for(var F=0;
F<J.length;
F++){var I=J[F];
if(this.nodeRightClass.get(I)<A){E.push(M.get(K)-M.get(I));
}}}E.sort();
if(E.length===0){C=0;
}else{if(E.length%2===1){C=E[this.intDiv(E.length,2)];
}else{C=(E[this.intDiv(E.length,2)-1]+E[this.intDiv(E.length,2)])/2;
}}}for(H=0;
H<B.length;
H++){K=B[H];
M.set(K,M.get(K)+C);
}}return M;
},_getLeftWing:function(){var A={value:null};
var B=this.computeClasses(A,1);
this.nodeLeftClass=A.value;
return B;
},_getRightWing:function(){var B={value:null};
var A=this.computeClasses(B,-1);
this.nodeRightClass=B.value;
return A;
},computeClasses:function(L,B){var A=0,K=L.value=new g();
for(var E=0;
E<this.layers.length;
++E){A=E;
var F=this.layers[E];
for(var G=B===1?0:F.length-1;
0<=G&&G<F.length;
G+=B){var I=F[G];
if(!K.containsKey(I)){K.set(I,A);
if(I.isVirtual){var H=this._nodesInLink(I);
for(var D=0;
D<H.length;
D++){var J=H[D];
K.set(J,A);
}}}else{A=K.get(I);
}}}var M=[];
for(var C=0;
C<this.layers.length;
C++){M.push(null);
}K.forEach(function(O,N){if(M[N]===null){M[N]=[];
}M[N].push(O);
});
return M;
},_isVerticalLayout:function(){return this.options.subtype.toLowerCase()==="up"||this.options.subtype.toLowerCase()==="down"||this.options.subtype.toLowerCase()==="vertical";
},_isHorizontalLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="left"||this.options.subtype.toLowerCase()==="horizontal";
},_isIncreasingLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="down";
},_moveThingsAround:function(){var G,J,Q,K,P,aa;
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
K.sort(this._gridPositionComparer);
}this.minDistances=[];
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
this.minDistances[J]=[];
for(P=0;
P<K.length;
++P){Q=K[P];
Q.layerIndex=P;
this.minDistances[J][P]=this.options.nodeDistance;
if(P<K.length-1){if(this._isVerticalLayout()){this.minDistances[J][P]+=(Q.width+K[P+1].width)/2;
}else{this.minDistances[J][P]+=(Q.height+K[P+1].height)/2;
}}}}this.downNodes=new g();
this.upNodes=new g();
z.forEach(this.graph.nodes,function(ac){this.downNodes.set(ac,[]);
this.upNodes.set(ac,[]);
},this);
z.forEach(this.graph.links,function(ae){var af=ae.source;
var ac=ae.target;
var ad=null,ag=null;
if(af.layer>ac.layer){ad=ae.source;
ag=ae.target;
}else{ag=ae.source;
ad=ae.target;
}this.downNodes.get(ag).push(ad);
this.upNodes.get(ad).push(ag);
},this);
this.downNodes.forEachValue(function(ac){ac.sort(this._gridPositionComparer);
},this);
this.upNodes.forEachValue(function(ac){ac.sort(this._gridPositionComparer);
},this);
for(J=0;
J<this.layers.length-1;
++J){K=this.layers[J];
for(aa=0;
aa<K.length-1;
aa++){var B=K[aa];
if(!B.isVirtual){continue;
}var A=this.downNodes.get(B)[0];
if(!A.isVirtual){continue;
}for(P=aa+1;
P<K.length;
++P){Q=K[P];
if(!Q.isVirtual){continue;
}var D=this.downNodes.get(Q)[0];
if(!D.isVirtual){continue;
}if(A.gridPosition>D.gridPosition){var U=A.gridPosition;
A.gridPosition=D.gridPosition;
D.gridPosition=U;
var H=A.layerIndex;
var I=D.layerIndex;
this.layers[J+1][H]=D;
this.layers[J+1][I]=A;
A.layerIndex=I;
D.layerIndex=H;
}}}}var M=this._getLeftWing();
var W=this._getRightWing();
var N=this.placeLeftToRight(M);
var X=this.placeRightToLeft(W);
var ab=new g();
z.forEach(this.graph.nodes,function(ac){ab.set(ac,(N.get(ac)+X.get(ac))/2);
});
var S=new g();
var T=new g();
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
var Z=-1,Y=-1;
for(P=0;
P<K.length;
++P){Q=K[P];
S.set(Q,0);
T.set(Q,false);
if(Q.isVirtual){if(Z===-1){Z=P;
}else{if(Z===P-1){Z=P;
}else{Y=P;
S.set(K[Z],0);
if(ab.get(Q)-ab.get(K[Z])===this.getMinDist(K[Z],Q)){T.set(K[Z],true);
}else{T.set(K[Z],false);
}Z=P;
}}}}}var C=[1,-1];
z.forEach(C,function(ac){var ag=ac===1?0:this.layers.length-1;
for(var ad=ag;
0<=ad&&ad<this.layers.length;
ad+=ac){var ae=this.layers[ad];
var ak=this._firstVirtualNode(ae);
var aj=null;
var af=null;
if(ak!==-1){aj=ae[ak];
af=[];
for(G=0;
G<ak;
G++){af.push(ae[G]);
}}else{aj=null;
af=ae;
}if(af.length>0){this._sequencer(ab,null,aj,ac,af);
for(G=0;
G<af.length-1;
++G){this.setMinDist(af[G],af[G+1],ab.get(af[G+1])-ab.get(af[G]));
}if(aj){this.setMinDist(af[af.length-1],aj,ab.get(aj)-ab.get(af[af.length-1]));
}}while(aj){var ah=this.nextVirtualNode(ae,aj);
if(!ah){ak=aj.layerIndex;
af=[];
for(G=ak+1;
G<ae.length;
G++){af.push(ae[G]);
}if(af.length>0){this._sequencer(ab,aj,null,ac,af);
for(G=0;
G<af.length-1;
++G){this.setMinDist(af[G],af[G+1],ab.get(af[G+1])-ab.get(af[G]));
}this.setMinDist(aj,af[0],ab.get(af[0])-ab.get(aj));
}}else{if(S.get(aj)===ac){ak=aj.layerIndex;
var ai=ah.layerIndex;
af=[];
for(G=ak+1;
G<ai;
G++){af.push(ae[G]);
}if(af.length>0){this._sequencer(ab,aj,ah,ac,af);
}T.set(aj,true);
}}aj=ah;
}this.adjustDirections(ad,ac,S,T);
}},this);
var E=this._isIncreasingLayout()?0:this.layers.length-1;
var V=function(ad,ac){if(ac._isIncreasingLayout()){return ad<ac.layers.length;
}else{return ad>=0;
}};
var L=this._isIncreasingLayout()?+1:-1,R=0;
function O(ae,ac){var ad=Number.MIN_VALUE;
for(var af=0;
af<ae.length;
++af){var ag=ae[af];
if(ac._isVerticalLayout()){ad=Math.max(ad,ag.height);
}else{ad=Math.max(ad,ag.width);
}}return ad;
}for(G=E;
V(G,this);
G+=L){K=this.layers[G];
var F=O(K,this);
for(P=0;
P<K.length;
++P){Q=K[P];
if(this._isVerticalLayout()){Q.x=ab.get(Q);
Q.y=R+F/2;
}else{Q.x=R+F/2;
Q.y=ab.get(Q);
}}R+=this.options.layerSeparation+F;
}},adjustDirections:function(I,B,N,P){if(I+B<0||I+B>=this.layers.length){return;
}var Q=null,R=null;
var J=this.layers[I+B];
for(var K=0;
K<J.length;
++K){var L=J[K];
if(L.isVirtual){var M=this.getNeighborOnLayer(L,I);
if(M.isVirtual){if(Q){var O=P.get(R);
var A=this.layers[I];
var D=R.layerIndex;
var E=M.layerIndex;
for(var C=D+1;
C<E;
++C){if(A[C].isVirtual){O=O&&P.get(A[C]);
}}if(O){N.set(Q,B);
var G=Q.layerIndex;
var H=L.layerIndex;
for(var F=G+1;
F<H;
++F){if(J[F].isVirtual){N.set(J[F],B);
}}}}Q=L;
R=M;
}}}},getNeighborOnLayer:function(C,A){var B=this.upNodes.get(C)[0];
if(B.layer===A){return B;
}B=this.downNodes.get(C)[0];
if(B.layer===A){return B;
}return null;
},_sequencer:function(G,F,E,A,C){if(C.length===1){this._sequenceSingle(G,F,E,A,C[0]);
}if(C.length>1){var B=C.length,D=this.intDiv(B,2);
this._sequencer(G,F,E,A,C.slice(0,D));
this._sequencer(G,F,E,A,C.slice(D));
this.combineSequences(G,F,E,A,C);
}},_sequenceSingle:function(G,F,E,A,D){var C=A===-1?this.downNodes.get(D):this.upNodes.get(D);
var B=C.length;
if(B!==0){if(B%2===1){G.set(D,G.get(C[this.intDiv(B,2)]));
}else{G.set(D,(G.get(C[this.intDiv(B,2)-1])+G.get(C[this.intDiv(B,2)]))/2);
}if(F){G.set(D,Math.max(G.get(D),G.get(F)+this.getMinDist(F,D)));
}if(E){G.set(D,Math.min(G.get(D),G.get(E)-this.getMinDist(D,E)));
}}},combineSequences:function(R,Q,P,B,N){var K=N.length,O=this.intDiv(K,2);
var D=[],C,A,G,I,H,J;
for(C=0;
C<O;
++C){A=0;
I=B===-1?this.downNodes.get(N[C]):this.upNodes.get(N[C]);
for(G=0;
G<I.length;
++G){H=I[G];
if(R.get(H)>=R.get(N[C])){A++;
}else{A--;
D.push({k:R.get(H)+this.getMinDist(N[C],N[O-1]),v:2});
}}D.push({k:R.get(N[C])+this.getMinDist(N[C],N[O-1]),v:A});
}if(Q){D.push({k:R.get(Q)+this.getMinDist(Q,N[O-1]),v:Number.MAX_VALUE});
}D.sort(this._positionDescendingComparer);
var L=[];
for(C=O;
C<K;
++C){A=0;
I=B===-1?this.downNodes.get(N[C]):this.upNodes.get(N[C]);
for(G=0;
G<I.length;
++G){H=I[G];
if(R.get(H)<=R.get(N[C])){A++;
}else{A--;
L.push({k:R.get(H)-this.getMinDist(N[C],N[O]),v:2});
}}L.push({k:R.get(N[C])-this.getMinDist(N[C],N[O]),v:A});
}if(P){L.push({k:R.get(P)-this.getMinDist(P,N[O]),v:Number.MAX_VALUE});
}L.sort(this._positionAscendingComparer);
var E=0,M=0;
var F=this.getMinDist(N[O-1],N[O]);
while(R.get(N[O])-R.get(N[O-1])<F){if(E<M){if(D.length===0){R.set(N[O-1],R.get(N[O])-F);
break;
}else{J=D.shift();
E=E+J.v;
R.set(N[O-1],J.k);
R.set(N[O-1],Math.max(R.get(N[O-1]),R.get(N[O])-F));
}}else{if(L.length===0){R.set(N[O],R.get(N[O-1])+F);
break;
}else{J=L.shift();
M=M+J.v;
R.set(N[O],J.k);
R.set(N[O],Math.min(R.get(N[O]),R.get(N[O-1])+F));
}}}for(C=O-2;
C>=0;
C--){R.set(N[C],Math.min(R.get(N[C]),R.get(N[O-1])-this.getMinDist(N[C],N[O-1])));
}for(C=O+1;
C<K;
C++){R.set(N[C],Math.max(R.get(N[C]),R.get(N[O])+this.getMinDist(N[C],N[O])));
}},placeLeft:function(C,B,A){var D=Number.NEGATIVE_INFINITY;
z.forEach(this._getComposite(C),function(F){var E=this.leftSibling(F);
if(E&&this.nodeLeftClass.get(E)===this.nodeLeftClass.get(F)){if(!B.containsKey(E)){this.placeLeft(E,B,A);
}D=Math.max(D,B.get(E)+this.getMinDist(E,F));
}},this);
if(D===Number.NEGATIVE_INFINITY){D=0;
}z.forEach(this._getComposite(C),function(E){B.set(E,D);
});
},placeRight:function(A,D,C){var B=Number.POSITIVE_INFINITY;
z.forEach(this._getComposite(A),function(F){var E=this.rightSibling(F);
if(E&&this.nodeRightClass.get(E)===this.nodeRightClass.get(F)){if(!D.containsKey(E)){this.placeRight(E,D,C);
}B=Math.min(B,D.get(E)-this.getMinDist(F,E));
}},this);
if(B===Number.POSITIVE_INFINITY){B=0;
}z.forEach(this._getComposite(A),function(E){D.set(E,B);
});
},leftSibling:function(C){var A=this.layers[C.layer],B=C.layerIndex;
return B===0?null:A[B-1];
},rightSibling:function(C){var A=this.layers[C.layer];
var B=C.layerIndex;
return B===A.length-1?null:A[B+1];
},_getComposite:function(A){return A.isVirtual?this._nodesInLink(A):[A];
},arrangeNodes:function(){var B,D,G,E,H;
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
H.upstreamPriority=H.upstreamLinkCount;
H.downstreamPriority=H.downstreamLinkCount;
}}var F=2;
for(var C=0;
C<F;
C++){for(B=this.layers.length-1;
B>=1;
B--){this.layoutLayer(false,B);
}for(B=0;
B<this.layers.length-1;
B++){this.layoutLayer(true,B);
}}var A=Number.MAX_VALUE;
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
A=Math.min(A,H.gridPosition);
}}if(A<0){for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
H.gridPosition=H.gridPosition-A;
}}}},layoutLayer:function(B,D){var C;
var A;
if(B){A=this.layers[C=D+1];
}else{A=this.layers[C=D-1];
}var F=[];
for(var E=0;
E<A.length;
E++){F.push(A[E]);
}F.sort(function(G,I){var H=(G.upstreamPriority+G.downstreamPriority)/2;
var J=(I.upstreamPriority+I.downstreamPriority)/2;
if(Math.abs(H-J)<0.0001){return 0;
}if(H<J){return 1;
}return -1;
});
z.forEach(F,function(G){var I=G.gridPosition;
var H=this.calcBaryCenter(G);
var J=(G.upstreamPriority+G.downstreamPriority)/2;
if(Math.abs(I-H)<0.0001){return;
}if(Math.abs(I-H)<0.25+0.0001){return;
}if(I<H){while(I<H){if(!this.moveRight(G,A,J)){break;
}I=G.gridPosition;
}}else{while(I>H){if(!this.moveLeft(G,A,J)){break;
}I=G.gridPosition;
}}},this);
if(C>0){this.calcDownData(C-1);
}if(C<this.layers.length-1){this.calcUpData(C+1);
}},moveRight:function(C,B,D){var A=z.indexOf(B,C);
if(A===B.length-1){C.gridPosition=C.gridPosition+0.5;
return true;
}var E=B[A+1];
var F=(E.upstreamPriority+E.downstreamPriority)/2;
if(E.gridPosition>C.gridPosition+1){C.gridPosition=C.gridPosition+0.5;
return true;
}if(F>D||Math.abs(F-D)<0.0001){return false;
}if(this.moveRight(E,B,D)){C.gridPosition=C.gridPosition+0.5;
return true;
}return false;
},moveLeft:function(E,B,F){var A=z.indexOf(B,E);
if(A===0){E.gridPosition=E.gridPosition-0.5;
return true;
}var C=B[A-1];
var D=(C.upstreamPriority+C.downstreamPriority)/2;
if(C.gridPosition<E.gridPosition-1){E.gridPosition=E.gridPosition-0.5;
return true;
}if(D>F||Math.abs(D-F)<0.0001){return false;
}if(this.moveLeft(C,B,F)){E.gridPosition=E.gridPosition-0.5;
return true;
}return false;
},mapVirtualNode:function(B,A){this.nodeToLinkMap.set(B,A);
if(!this.linkToNodeMap.containsKey(A)){this.linkToNodeMap.set(A,[]);
}this.linkToNodeMap.get(A).push(B);
},_nodesInLink:function(A){return this.linkToNodeMap.get(this.nodeToLinkMap.get(A));
},_dummify:function(){this.linkToNodeMap=new g();
this.nodeToLinkMap=new g();
var F,P,J,K,Q,I,D,E,H=this.graph.links.slice(0);
for(E=0;
E<H.length;
E++){var G=H[E];
var L=G.source;
var A=G.target;
var M=L.layer;
var B=A.layer;
var N=L.gridPosition;
var C=A.gridPosition;
var R=(C-N)/Math.abs(B-M);
var O=L;
if(M-B>1){for(D=M-1;
D>B;
D--){J=new q();
J.x=L.x;
J.y=L.y;
J.width=L.width/100;
J.height=L.height/100;
F=this.layers[D];
P=(D-B)*R+N;
if(P>F.length){P=F.length;
}if(N>=this.layers[M].length-1&&C>=this.layers[B].length-1){P=F.length;
}else{if(N===0&&C===0){P=0;
}}J.layer=D;
J.uBaryCenter=0;
J.dBaryCenter=0;
J.upstreamLinkCount=0;
J.downstreamLinkCount=0;
J.gridPosition=P;
J.isVirtual=true;
z.insert(F,J,P);
for(Q=P+1;
Q<F.length;
Q++){K=F[Q];
K.gridPosition=K.gridPosition+1;
}I=new p(O,J);
I.depthOfDumminess=0;
O=J;
this.graph.nodes.push(J);
this.graph.addLink(I);
J.index=this.graph.nodes.length-1;
this.mapVirtualNode(J,G);
}G.changeSource(O);
G.depthOfDumminess=M-B-1;
}if(M-B<-1){for(D=M+1;
D<B;
D++){J=new q();
J.x=L.x;
J.y=L.y;
J.width=L.width/100;
J.height=L.height/100;
F=this.layers[D];
P=(D-M)*R+N;
if(P>F.length){P=F.length;
}if(N>=this.layers[M].length-1&&C>=this.layers[B].length-1){P=F.length;
}else{if(N===0&&C===0){P=0;
}}J.layer=D;
J.uBaryCenter=0;
J.dBaryCenter=0;
J.upstreamLinkCount=0;
J.downstreamLinkCount=0;
J.gridPosition=P;
J.isVirtual=true;
P&=P;
z.insert(F,J,P);
for(Q=P+1;
Q<F.length;
Q++){K=F[Q];
K.gridPosition=K.gridPosition+1;
}I=new p(O,J);
I.depthOfDumminess=0;
O=J;
this.graph.nodes.push(J);
this.graph.addLink(I);
J.index=this.graph.nodes.length-1;
this.mapVirtualNode(J,G);
}G.changeSource(O);
G.depthOfDumminess=B-M-1;
}}},_dedummify:function(){var B=true;
while(B){B=false;
for(var D=0;
D<this.graph.links.length;
D++){var E=this.graph.links[D];
if(E.depthOfDumminess===0){continue;
}var G=[];
G.unshift({x:E.target.x,y:E.target.y});
G.unshift({x:E.source.x,y:E.source.y});
var I=E;
var C=E.depthOfDumminess;
for(var A=0;
A<C;
A++){var F=I.source;
var H=F.incoming[0];
G.unshift({x:H.source.x,y:H.source.y});
I=H;
}E.changeSource(I.source);
E.depthOfDumminess=0;
if(G.length>2){G.splice(0,1);
G.splice(G.length-1);
E.points=G;
}else{E.points=[];
}B=true;
break;
}}},_optimizeCrossings:function(){var D=-1,A;
var C=3;
var B=0;
while(D!==0){if(B++>C){break;
}D=0;
for(A=this.layers.length-1;
A>=1;
A--){D+=this.optimizeLayerCrossings(false,A);
}for(A=0;
A<this.layers.length-1;
A++){D+=this.optimizeLayerCrossings(true,A);
}}},calcUpData:function(D){if(D===0){return;
}var A=this.layers[D],B,C,E;
var J=new t();
var H=this.layers[D-1];
for(B=0;
B<H.length;
B++){J.add(H[B]);
}for(B=0;
B<A.length;
B++){var F=A[B];
var G=0;
var I=0;
for(C=0;
C<F.incoming.length;
C++){E=F.incoming[C];
if(J.contains(E.source)){I++;
G+=E.source.gridPosition;
}}for(C=0;
C<F.outgoing.length;
C++){E=F.outgoing[C];
if(J.contains(E.target)){I++;
G+=E.target.gridPosition;
}}if(I>0){F.uBaryCenter=G/I;
F.upstreamLinkCount=I;
}else{F.uBaryCenter=B;
F.upstreamLinkCount=0;
}}},calcDownData:function(E){if(E===this.layers.length-1){return;
}var A=this.layers[E],C,D,F;
var B=new t();
var I=this.layers[E+1];
for(C=0;
C<I.length;
C++){B.add(I[C]);
}for(C=0;
C<A.length;
C++){var G=A[C];
var H=0;
var J=0;
for(D=0;
D<G.incoming.length;
D++){F=G.incoming[D];
if(B.contains(F.source)){J++;
H+=F.source.gridPosition;
}}for(D=0;
D<G.outgoing.length;
D++){F=G.outgoing[D];
if(B.contains(F.target)){J++;
H+=F.target.gridPosition;
}}if(J>0){G.dBaryCenter=H/J;
G.downstreamLinkCount=J;
}else{G.dBaryCenter=C;
G.downstreamLinkCount=0;
}}},optimizeLayerCrossings:function(B,F){var D;
var A;
if(B){A=this.layers[D=F+1];
}else{A=this.layers[D=F-1];
}var I=A.slice(0);
if(B){this.calcUpData(D);
}else{this.calcDownData(D);
}var J=this;
A.sort(function(L,N){var M=J.calcBaryCenter(L),O=J.calcBaryCenter(N);
if(Math.abs(M-O)<0.0001){if(L.degree()===N.degree()){return J.compareByIndex(L,N);
}else{if(L.degree()<N.degree()){return 1;
}}return -1;
}var K=(O-M)*1000;
if(K>0){return -1;
}else{if(K<0){return 1;
}}return J.compareByIndex(L,N);
});
var C,G=0;
for(C=0;
C<A.length;
C++){if(A[C]!==I[C]){G++;
}}if(G>0){var E=0;
for(C=0;
C<A.length;
C++){var H=A[C];
H.gridPosition=E++;
}}return G;
},_swapPairs:function(){var J=this.options.layeredIterations;
var G=0;
while(true){if(G++>J){break;
}var E=(G%4<=1);
var R=(G%4===1);
for(var H=(E?0:this.layers.length-1);
E?H<=this.layers.length-1:H>=0;
H+=(E?1:-1)){var I=this.layers[H];
var F=false;
var A=true;
var K=0;
for(var L=0;
L<I.length-1;
L++){var S=0;
var D=0;
var C=0;
if(A){if(H!==0){S=this.countLinksCrossingBetweenTwoLayers(H-1,H);
}if(H!==this.layers.length-1){D=this.countLinksCrossingBetweenTwoLayers(H,H+1);
}if(E){S*=2;
}else{D*=2;
}C=S+D;
}else{C=K;
}if(C===0){continue;
}var M=I[L];
var O=I[L+1];
var N=M.gridPosition;
var P=O.gridPosition;
I[L]=O;
I[L+1]=M;
M.gridPosition=P;
O.gridPosition=N;
S=0;
if(H!==0){S=this.countLinksCrossingBetweenTwoLayers(H-1,H);
}D=0;
if(H!==this.layers.length-1){D=this.countLinksCrossingBetweenTwoLayers(H,H+1);
}if(E){S*=2;
}else{D*=2;
}var B=S+D;
var Q=false;
if(R){Q=B>=C;
}else{Q=B>C;
}if(Q){M=I[L];
O=I[L+1];
N=M.gridPosition;
P=O.gridPosition;
I[L]=O;
I[L+1]=M;
M.gridPosition=P;
O.gridPosition=N;
K=C;
A=false;
}else{F=true;
A=true;
}}if(F){if(H!==this.layers.length-1){this.calcUpData(H+1);
}if(H!==0){this.calcDownData(H-1);
}}}}},countLinksCrossingBetweenTwoLayers:function(X,B){var D,A=0;
var Y=new t();
var U=this.layers[X];
for(D=0;
D<U.length;
D++){Y.add(U[D]);
}var K=new t();
var V=this.layers[B];
for(D=0;
D<V.length;
D++){K.add(V[D]);
}var C=new t();
var J=[];
var T=[];
Y.forEach(function(Z){z.addRange(T,Z.incoming);
z.addRange(T,Z.outgoing);
});
for(var W=0;
W<T.length;
W++){var G=T[W];
if(Y.contains(G.source)&&K.contains(G.target)){C.add(G);
J.push(G);
}else{if(K.contains(G.source)&&Y.contains(G.target)){J.push(G);
}}}for(var E=0;
E<J.length;
E++){var H=J[E];
for(var F=0;
F<J.length;
F++){if(E===F){continue;
}var I=J[F];
var L,N;
var P,R;
if(C.contains(H)){L=H.source;
N=H.target;
}else{L=H.target;
N=H.source;
}if(C.contains(I)){P=I.source;
R=I.target;
}else{P=I.target;
R=I.source;
}var M=L.gridPosition;
var O=N.gridPosition;
var Q=P.gridPosition;
var S=R.gridPosition;
if((M-Q)*(O-S)<0){A++;
}}}return A/2;
},calcBaryCenter:function(C){var E=C.upstreamLinkCount;
var B=C.downstreamLinkCount;
var D=C.uBaryCenter;
var A=C.dBaryCenter;
if(E>0&&B>0){return(D+A)/2;
}if(E>0){return D;
}if(B>0){return A;
}return 0;
},_gridPositionComparer:function(A,B){if(A.gridPosition<B.gridPosition){return -1;
}if(A.gridPosition>B.gridPosition){return 1;
}return 0;
},_positionAscendingComparer:function(A,B){return A.k<B.k?-1:A.k>B.k?1:0;
},_positionDescendingComparer:function(A,B){return A.k<B.k?1:A.k>B.k?-1:0;
},_firstVirtualNode:function(B){for(var A=0;
A<B.length;
A++){if(B[A].isVirtual){return A;
}}return -1;
},compareByIndex:function(C,D){var A=C.index;
var B=D.index;
if(A<B){return 1;
}if(A>B){return -1;
}return 0;
},intDiv:function(B,A){return(B-B%A)/A;
},nextVirtualNode:function(B,C){var D=C.layerIndex;
for(var A=D+1;
A<B.length;
++A){if(B[A].isVirtual){return B[A];
}}return null;
}});
var o=l.Class.extend({init:function(A,B){if(z.isUndefined(A)){throw"No diagram given";
}this.diagram=A;
this.nodeMap=new g();
this.linkMap=new g();
this.capture(B?B:A);
},capture:function(C){var G,H,I,D,A,E,F;
if(C instanceof e.Graph){for(D=0;
D<C.nodes.length;
D++){G=C.nodes[D];
I=G.associatedShape;
this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}for(D=0;
D<C.links.length;
D++){E=C.links[D];
A=E.associatedConnection;
this.linkMap.set(A.visual.id,E.points());
}}else{if(C instanceof Array){H=C;
for(D=0;
D<H.length;
D++){G=H[D];
I=G.associatedShape;
if(I){this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}}}else{if(C.hasOwnProperty("links")&&C.hasOwnProperty("nodes")){H=C.nodes;
F=C.links;
for(D=0;
D<H.length;
D++){G=H[D];
I=G.associatedShape;
if(I){this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}}for(D=0;
D<F.length;
D++){E=F[D];
A=E.associatedConnection;
if(A){this.linkMap.set(A.visual.id,E.points);
}}}else{var J=this.diagram.shapes;
var B=this.diagram.connections;
for(D=0;
D<J.length;
D++){I=J[D];
this.nodeMap.set(I.visual.id,I.bounds());
}for(D=0;
D<B.length;
D++){A=B[D];
this.linkMap.set(A.visual.id,A.points());
}}}}}});
c(e,{init:function(A){l.init(A,e.ui);
},SpringLayout:v,TreeLayout:w,GraphAdapter:f,LayeredLayout:m,LayoutBase:n,LayoutState:o});
})(window.kendo.jQuery);
(function(a,bf){var y=kendo.dataviz,W=kendo.drawing,ae=kendo.geometry,R=y.diagram,bj=kendo.ui.Widget,l=kendo.Class,aT=a.proxy,z=kendo.deepExtend,ab=a.extend,ah=kendo.data.HierarchicalDataSource,g=R.Canvas,af=R.Group,bi=R.Visual,aV=R.Rectangle,k=R.Circle,p=R.CompositeTransform,aU=R.Rect,aO=R.Path,P=R.DeleteShapeUnit,O=R.DeleteConnectionUnit,a6=R.TextBlock,ai=R.Image,aP=R.Point,am=R.Intersect,s=R.ConnectionEditAdorner,bg=R.UndoRedoService,ba=R.ToolService,a1=R.Selector,aW=R.ResizingAdorner,v=R.ConnectorsAdorner,x=R.Cursors,bh=R.Utils,aM=kendo.Observable,a7=R.Ticker,a8=R.ToBackUnit,a9=R.ToFrontUnit,V=R.Dictionary,aR=R.PolylineRouter,i=R.CascadingRouter,av=bh.isUndefined,ap=bh.isDefined,N=kendo.util.defined,an=a.isArray,aq=kendo.isFunction,au=bh.isString,at=a.isPlainObject,az=Math;
var aL=".kendoDiagram",h="cascading",aQ="polyline",aw="itemBoundsChange",j="change",m="click",aF="mouseEnter",aG="mouseLeave",aa="error",d="Auto",bb="Top",aY="Right",ay="Left",e="Bottom",aB=9007199254740992,a0="select",ax="itemRotate",aN="pan",bo="zoomStart",bn="zoomEnd",r="k-connection",a3="k-shape",a4="single",aK="none",aI="multiple",B=600,A=600,K="rectangle",L=100,G=100,I=20,H=20,J=0,F="SteelBlue",C="Yellow",D=8,E="#70CAFF",aA=Number.MAX_VALUE,aC=-Number.MAX_VALUE,c="all",b="absolute",bc="transformed",aZ="rotated",be="transparent",bk="width",ag="height",bl="x",bm="y",aH="DOMMouseScroll"+aL+" mousewheel"+aL,aE=0.05,aD=5,f='<a class="k-button k-button-icontext #=className#" href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>';
R.DefaultConnectors=[{name:bb,description:"Top Connector"},{name:aY,description:"Right Connector"},{name:e,description:"Bottom Connector"},{name:ay,Description:"Left Connector"},{name:d,Description:"Auto Connector",position:function(X){return X.getPosition("center");
}}];
var M={cancel:{text:"Cancel",imageClass:"k-cancel",className:"k-diagram-cancel",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-update",className:"k-diagram-update",iconClass:"k-icon"}};
R.shapeDefaults=function(Y){var X={type:K,path:"",autoSize:true,visual:null,x:J,y:J,minWidth:I,minHeight:H,width:L,height:G,hover:{},editable:{connect:true,tools:[]},connectors:R.DefaultConnectors,rotation:{angle:0}};
bh.simpleExtend(X,Y);
return X;
};
function aJ(Y){var bp=Y.originalEvent,X=0;
if(bp.wheelDelta){X=-bp.wheelDelta/40;
X=X>0?az.ceil(X):az.floor(X);
}else{if(bp.detail){X=bp.detail;
}}return X;
}function ao(X){return X.options.name.toLowerCase()===d.toLowerCase();
}function aX(bp){var bv=aB,bz,bB,bx=bp.source(),bA=bp.target(),X,Y,by,bw=[0,2,3,1,4],bu;
if(bx instanceof aP){bz=bx;
}else{if(bx instanceof u){if(ao(bx)){X=bx.shape;
}else{bp._resolvedSourceConnector=bx;
bz=bx.position();
}}}if(bA instanceof aP){bB=bA;
}else{if(bA instanceof u){if(ao(bA)){Y=bA.shape;
}else{bp._resolvedTargetConnector=bA;
bB=bA.position();
}}}if(bz){if(Y){bp._resolvedTargetConnector=o(bz,Y);
}}else{if(X){if(bB){bp._resolvedSourceConnector=o(bB,X);
}else{if(Y){for(var bt=0;
bt<X.connectors.length;
bt++){if(X.connectors.length==5){bu=bw[bt];
}else{bu=bt;
}by=X.connectors[bu];
if(!ao(by)){var bq=by.position(),br=o(bq,Y);
var bs=az.round(br.position().distanceTo(bq));
if(bs<bv){bv=bs;
bp._resolvedSourceConnector=by;
bp._resolvedTargetConnector=br;
}}}}}}}}function o(bs,bu){var br=aB,bt,Y=bu.connectors;
for(var bq=0;
bq<Y.length;
bq++){var X=Y[bq];
if(!ao(X)){var bp=bs.distanceTo(X.position());
if(bp<br){br=bp;
bt=X;
}}}return bt;
}function al(Y,bu){var bp,bq=[],bt;
var X=Y.drawingContainer().children;
var bs=X.length;
for(bp=0;
bp<bu.length;
bp++){bt=bu[bp];
for(var br=0;
br<bs;
br++){if(X[br]==bt.drawingContainer()){bq.push(br);
break;
}}}return bq;
}function Q(Y,bq){var bp=aP.parse(bq),X;
if(bp){return bp;
}X=u.parse(Y,bq);
if(X){return X;
}}var T=aM.extend({init:function(X){var Y=this;
Y.dataItem=(X||{}).dataItem;
aM.fn.init.call(Y);
Y.options=z({id:R.randomId()},Y.options,X);
Y.isSelected=false;
Y.visual=new af({id:Y.options.id,autoSize:Y.options.autoSize});
Y._template();
},options:{hover:{},cursor:x.grip,content:{align:"center middle"},selectable:true,serializable:true,enable:true},_getCursor:function(X){if(this.adorner){return this.adorner._getCursor(X);
}return this.options.cursor;
},visible:function(X){if(av(X)){return this.visual.visible();
}else{this.visual.visible(X);
}},bounds:function(){},refresh:function(){this.visual.redraw();
},position:function(X){this.options.x=X.x;
this.options.y=X.y;
this.visual.position(X);
},toString:function(){return this.options.id;
},serialize:function(){var X=z({},{options:this.options});
if(this.dataItem){X.dataItem=this.dataItem.toString();
}return X;
},_content:function(Y){if(Y!==bf){var br=this.options;
var X=this.bounds();
if(R.Utils.isString(Y)){br.content.text=Y;
}else{z(br.content,Y);
}var bp=br.content;
var bq=this._contentVisual;
if(!bq&&bp.text){this._contentVisual=new a6(bp);
this._contentVisual._includeInBBox=false;
this.visual.append(this._contentVisual);
}else{if(bq){bq.redraw(bp);
}}}return this.options.content.text;
},_hitTest:function(Y){var X=this.bounds();
return this.visible()&&X.contains(Y)&&this.options.enable;
},_template:function(){var bp=this;
if(bp.options.content.template){var X=bp.dataItem||{},Y=kendo.template(bp.options.content.template,{paramName:"dataItem"});
bp.options.content.text=Y(X);
}},_canSelect:function(){return this.options.selectable!==false;
},toJSON:function(){return{id:this.options.id};
}});
var u=l.extend({init:function(Y,X){this.options=z({},this.options,X);
this.connections=[];
this.shape=Y;
},options:{width:7,height:7,fill:{color:C},hover:{}},position:function(){if(this.options.position){return this.options.position(this.shape);
}else{return this.shape.getPosition(this.options.name);
}},toJSON:function(){return{shapeId:this.shape.toString(),connector:this.options.name};
}});
u.parse=function(X,bs){var bt=bs.split(":"),bp=bt[0],bq=bt[1]||d;
for(var Y=0;
Y<X.shapes.length;
Y++){var br=X.shapes[Y];
if(br.options.id==bp){return br.getConnector(bq.trim());
}}};
var a2=T.extend({init:function(Y,X){var bp=this;
T.fn.init.call(bp,Y);
this.diagram=X;
this.updateOptionsFromModel();
Y=bp.options;
bp.connectors=[];
bp.type=Y.type;
bp.shapeVisual=a2.createShapeVisual(bp.options);
bp.visual.append(this.shapeVisual);
bp.updateBounds();
bp.content(bp.content());
bp._createConnectors();
bp.parentContainer=null;
bp.isContainer=false;
bp.isCollapsed=false;
bp.id=bp.visual.id;
if(Y.hasOwnProperty("layout")&&Y.layout!==bf){bp.layout=Y.layout.bind(Y);
}},options:R.shapeDefaults(),_setOptionsFromModel:function(X){var Y=ad(X||this.dataItem);
this.options=z({},this.options,Y);
this.redrawVisual();
if(this.options.content){this._template();
this.content(this.options.content);
}},updateOptionsFromModel:function(bp,Y){if(this.diagram&&this.diagram._isEditable){var bq=ad(bp||this.dataItem);
if(bp&&Y){if(!y.inArray(Y,["x","y","width","height"])){if(this.options.visual){this.redrawVisual();
}else{if(bq.type){this.options=z({},this.options,bq);
this.redrawVisual();
}}if(this.options.content){this._template();
this.content(this.options.content);
}}else{var X=this.bounds();
X[Y]=bp[Y];
this.bounds(X);
}}else{this.options=z({},this.options,bq);
}}},redrawVisual:function(){this.visual.clear();
this._contentVisual=null;
this.options.dataItem=this.dataItem;
this.shapeVisual=a2.createShapeVisual(this.options);
this.visual.append(this.shapeVisual);
this.updateBounds();
},updateModel:function(bq){var Y=this.diagram;
if(Y&&Y._isEditable){var X=this._bounds;
var bp=this.dataItem;
if(bp){Y._suspendModelRefresh();
if(N(bp.x)&&X.x!==bp.x){bp.set("x",X.x);
}if(N(bp.y)&&X.y!==bp.y){bp.set("y",X.y);
}if(N(bp.width)&&X.width!==bp.width){bp.set("width",X.width);
}if(N(bp.height)&&X.height!==bp.height){bp.set("height",X.height);
}this.dataItem=bp;
Y._resumeModelRefresh();
if(bq){Y._syncShapeChanges();
}}}},updateBounds:function(){var X=this.visual._measure(true);
var Y=this.options;
this.bounds(new aU(Y.x,Y.y,X.width,X.height));
this._rotate();
this._alignContent();
},content:function(X){var Y=this._content(X);
this._alignContent();
return Y;
},_alignContent:function(){var br=this.options.content||{};
var bt=this._contentVisual;
if(bt&&br.align){var bp=this.visual._measure();
var Y=new R.RectAlign(bp);
var bq=bt.drawingElement.bbox(null);
var bs=new aU(0,0,bq.width(),bq.height());
var X=Y.align(bs,br.align);
bt.position(X.topLeft());
}},_createConnectors:function(){var br=this.options,bq=br.connectors.length,Y=br.connectorDefaults,X,bp;
for(bp=0;
bp<bq;
bp++){X=new u(this,z({},Y,br.connectors[bp]));
this.connectors.push(X);
}},bounds:function(bp){var X;
if(bp){if(au(bp)){switch(bp){case bc:X=this._transformedBounds();
break;
case b:X=this._transformedBounds();
var Y=this.diagram._pan;
X.x+=Y.x;
X.y+=Y.y;
break;
case aZ:X=this._rotatedBounds();
break;
default:X=this._bounds;
}}else{this._setBounds(bp);
this.refreshConnections();
this._triggerBoundsChange();
}}else{X=this._bounds;
}return X;
},_setBounds:function(bp){var Y=this.options;
var bq=bp.topLeft();
var bs=Y.x=bq.x;
var bt=Y.y=bq.y;
var br=Y.width=az.max(bp.width,Y.minWidth);
var X=Y.height=az.max(bp.height,Y.minHeight);
this._bounds=new aU(bs,bt,br,X);
this.visual.redraw({x:bs,y:bt,width:br,height:X});
},position:function(X){if(X){this.bounds(new aU(X.x,X.y,this._bounds.width,this._bounds.height));
}else{return this._bounds.topLeft();
}},clone:function(){var X=this.serialize();
X.options.id=R.randomId();
if(this.diagram&&this.diagram._isEditable&&N(this.dataItem)){X.options.dataItem=n(this.dataItem);
}return new a2(X.options);
},select:function(bq){var Y=this.diagram,bp,X;
if(av(bq)){bq=true;
}if(this._canSelect()){if(this.isSelected!=bq){bp=[];
X=[];
this.isSelected=bq;
if(this.isSelected){Y._selectedItems.push(this);
bp.push(this);
}else{bh.remove(Y._selectedItems,this);
X.push(this);
}if(!Y._internalSelection){Y._selectionChanged(bp,X);
}return true;
}}},rotate:function(X,bp,bu){var bs=this.visual.rotate();
if(X!==bf){if(bu!==false&&this.diagram&&this.diagram.undoRedoService&&X!==bs.angle){this.diagram.undoRedoService.add(new R.RotateUnit(this.diagram._resizingAdorner,[this],[bs.angle]),false);
}var Y=this.bounds(),bt=new aP(Y.width/2,Y.height/2),bq,br;
if(bp){bq=X-bs.angle;
br=Y.center().rotate(bp,360-bq).minus(bt);
this._rotationOffset=this._rotationOffset.plus(br.minus(Y.topLeft()));
this.position(br);
}this.visual.rotate(X,bt);
this.options.rotation.angle=X;
if(this.diagram&&this.diagram._connectorsAdorner){this.diagram._connectorsAdorner.refresh();
}this.refreshConnections();
if(this.diagram){this.diagram.trigger(ax,{item:this});
}}return bs;
},connections:function(bv){var bs=[],bq,br,X,Y,bp;
for(bq=0;
bq<this.connectors.length;
bq++){bp=this.connectors[bq];
Y=bp.connections;
for(br=0,Y;
br<Y.length;
br++){X=Y[br];
if(bv=="out"){var bt=X.source();
if(bt.shape&&bt.shape==this){bs.push(X);
}}else{if(bv=="in"){var bu=X.target();
if(bu.shape&&bu.shape==this){bs.push(X);
}}else{bs.push(X);
}}}}return bs;
},refreshConnections:function(){a.each(this.connections(),function(){this.refresh();
});
},getConnector:function(bp){var Y,X;
if(au(bp)){bp=bp.toLocaleLowerCase();
for(Y=0;
Y<this.connectors.length;
Y++){X=this.connectors[Y];
if(X.options.name.toLocaleLowerCase()==bp){return X;
}}}else{if(bp instanceof aP){return o(bp,this);
}else{return this.connectors.length?this.connectors[0]:null;
}}},getPosition:function(bp){var X=this.bounds(),Y=bp.charAt(0).toLowerCase()+bp.slice(1);
if(aq(X[Y])){return this._transformPoint(X[Y]());
}return X.center();
},redraw:function(Y){if(Y){var bp=this.options;
var X;
this.shapeVisual.redraw(this._visualOptions(Y));
if(this._diffNumericOptions(Y,[bk,ag,bl,bm])){this.bounds(new aU(bp.x,bp.y,bp.width,bp.height));
X=true;
}if(Y.connectors){bp.connectors=Y.connectors;
this._updateConnectors();
}bp=z(bp,Y);
if(Y.rotation||X){this._rotate();
}if(bp.content){this.content(bp.content);
}}},_updateConnectors:function(){var Y=this.connections();
this.connectors=[];
this._createConnectors();
var X;
var bq;
var br;
for(var bp=0;
bp<Y.length;
bp++){X=Y[bp];
bq=X.source();
br=X.target();
if(bq.shape&&bq.shape===this){X.source(this.getConnector(bq.options.name)||null);
}else{if(br.shape&&br.shape===this){X.target(this.getConnector(br.options.name)||null);
}}X.updateModel();
}},_diffNumericOptions:R.diffNumericOptions,_visualOptions:function(X){return{data:X.path,source:X.source,hover:X.hover,fill:X.fill,stroke:X.stroke,startCap:X.startCap,endCap:X.endCap};
},_triggerBoundsChange:function(){if(this.diagram){this.diagram.trigger(aw,{item:this,bounds:this._bounds.clone()});
}},_transformPoint:function(Y){var bp=this.rotate(),X=this.bounds(),bq=X.topLeft();
if(bp.angle){Y.rotate(bp.center().plus(bq),360-bp.angle);
}return Y;
},_transformedBounds:function(){var X=this.bounds(),bp=X.topLeft(),Y=X.bottomRight();
return aU.fromPoints(this.diagram.modelToView(bp),this.diagram.modelToView(Y));
},_rotatedBounds:function(){var X=this.bounds().rotatedBounds(this.rotate().angle),bp=X.topLeft(),Y=X.bottomRight();
return aU.fromPoints(bp,Y);
},_rotate:function(){var X=this.options.rotation;
if(X&&X.angle){this.rotate(X.angle);
}this._rotationOffset=new aP();
},_hover:function(br){var bp=this.options,Y=bp.hover,bq=bp.stroke,X=bp.fill;
if(br&&ap(Y.stroke)){bq=z({},bq,Y.stroke);
}if(br&&ap(Y.fill)){X=Y.fill;
}this.shapeVisual.redraw({stroke:bq,fill:X});
if(bp.editable&&bp.editable.connect){this.diagram._showConnectors(this,br);
}},_hitTest:function(bq){if(this.visible()){var Y=this.bounds(),bp,X=this.rotate().angle;
if(bq.isEmpty&&!bq.isEmpty()){return am.rects(bq,Y,X?X:0);
}else{bp=bq.clone().rotate(Y.center(),X);
if(Y.contains(bp)){return this;
}}}},toJSON:function(){return{shapeId:this.options.id};
}});
a2.createShapeVisual=function(Y){var X=Y.diagram;
delete Y.diagram;
var bp=z({},Y,{x:0,y:0});
var bs=bp.visual;
var br=(bp.type+"").toLocaleLowerCase();
var bq;
if(aq(bs)){bq=bs.call(this,bp);
}else{if(bp.path){bp.data=bp.path;
bq=new aO(bp);
bd(bq);
}else{if(br=="rectangle"){bq=new aV(bp);
}else{if(br=="circle"){bq=new k(bp);
}else{if(br=="text"){bq=new a6(bp);
}else{if(br=="image"){bq=new ai(bp);
}else{bq=new aO(bp);
}}}}}}return bq;
};
function bd(Y){var X=Y.drawingContainer().clippedBBox(null);
if(X.origin.x!==0||X.origin.y!==0){Y.position(-X.origin.x,-X.origin.y);
}}var q=T.extend({init:function(X,bq,Y){var bp=this;
T.fn.init.call(bp,Y);
this.updateOptionsFromModel();
this._initRouter();
bp.path=new R.Polyline(bp.options);
bp.path.fill(be);
bp.visual.append(bp.path);
bp._sourcePoint=bp._targetPoint=new aP();
bp.source(X);
bp.target(bq);
bp.content(bp.options.content);
bp.definers=[];
if(N(Y)&&Y.points){bp.points(Y.points);
}bp.refresh();
},options:{hover:{stroke:{}},startCap:aK,endCap:aK,points:[],selectable:true},_setOptionsFromModel:function(X){this.updateOptionsFromModel(X||this.dataItem);
},updateOptionsFromModel:function(Y){if(this.diagram&&this.diagram._isEditable){var X=this.diagram._dataMap;
var bp=ac(Y||this.dataItem);
if(Y){if(N(bp.from)){this.source(X[bp.from]);
}else{if(N(bp.fromX)&&N(bp.fromY)){this.source(new aP(bp.fromX,bp.fromY));
}}if(N(bp.to)){this.target(X[bp.to]);
}else{if(N(bp.toX)&&N(bp.toY)){this.target(new aP(bp.toX,bp.toY));
}}this.dataItem=Y;
this._template();
this.redraw(this.options);
}else{this.options=z({},bp,this.options);
}}},updateModel:function(Y){if(this.diagram&&this.diagram._isEditable){if(this.diagram.connectionsDataSource){var X=this.diagram.connectionsDataSource.getByUid(this.dataItem.uid);
if(X){this.diagram._suspendModelRefresh();
if(N(this.options.fromX)&&this.options.fromX!==null){X.set("from",null);
X.set("fromX",this.options.fromX);
X.set("fromY",this.options.fromY);
}else{X.set("from",this.options.from);
X.set("fromX",null);
X.set("fromY",null);
}if(N(this.options.toX)&&this.options.toX!==null){X.set("to",null);
X.set("toX",this.options.toX);
X.set("toY",this.options.toY);
}else{X.set("to",this.options.to);
X.set("toX",null);
X.set("toY",null);
}this.dataItem=X;
this.diagram._resumeModelRefresh();
if(Y){this.diagram._syncConnectionChanges();
}}}}},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint;
},source:function(bp,bq){var X;
if(ap(bp)){var Y=bp instanceof a2;
if(Y&&!bp.getConnector(d)){return;
}if(bq&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new R.ConnectionEditUnit(this,bp));
}if(bp!==bf){this.from=bp;
}if(bp===null){if(this.sourceConnector){this._sourcePoint=this._resolvedSourceConnector.position();
this._clearSourceConnector();
this._setFromOptions(null,this._sourcePoint);
}}else{if(bp instanceof u){X=bp.shape.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bp;
this.sourceConnector.connections.push(this);
}else{if(bp instanceof aP){this._setFromOptions(null,bp);
this._sourcePoint=bp;
if(this.sourceConnector){this._clearSourceConnector();
}}else{if(Y){X=bp.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bp.getConnector(d);
this.sourceConnector.connections.push(this);
}}}}this.refresh();
}return this.sourceConnector?this.sourceConnector:this._sourcePoint;
},_setFromOptions:function(X,Y){this.options.from=X;
if(Y){this.options.fromX=Y.x;
this.options.fromY=Y.y;
}else{this.options.fromX=null;
this.options.fromY=null;
}},sourceDefiner:function(X){if(X){if(X instanceof R.PathDefiner){X.left=null;
this._sourceDefiner=X;
this.source(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._sourceDefiner){this._sourceDefiner=new R.PathDefiner(this.sourcePoint(),null,null);
}return this._sourceDefiner;
}},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint;
},target:function(bp,bq){var X;
if(ap(bp)){var Y=bp instanceof a2;
if(Y&&!bp.getConnector(d)){return;
}if(bq&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new R.ConnectionEditUnit(this,bf,bp));
}if(bp!==bf){this.to=bp;
}if(bp===null){if(this.targetConnector){this._targetPoint=this._resolvedTargetConnector.position();
this._clearTargetConnector();
this._setToOptions(null,this._targetPoint);
}}else{if(bp instanceof u){X=bp.shape.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bp;
this.targetConnector.connections.push(this);
}else{if(bp instanceof aP){this._setToOptions(null,bp);
this._targetPoint=bp;
if(this.targetConnector){this._clearTargetConnector();
}}else{if(Y){X=bp.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bp.getConnector(d);
this.targetConnector.connections.push(this);
}}}}this.refresh();
}return this.targetConnector?this.targetConnector:this._targetPoint;
},_setToOptions:function(X,Y){this.options.to=X;
if(Y){this.options.toX=Y.x;
this.options.toY=Y.y;
}else{this.options.toX=null;
this.options.toY=null;
}},targetDefiner:function(X){if(X){if(X instanceof R.PathDefiner){X.right=null;
this._targetDefiner=X;
this.target(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._targetDefiner){this._targetDefiner=new R.PathDefiner(this.targetPoint(),null,null);
}return this._targetDefiner;
}},_updateConnectors:function(){this._updateConnector(this.source(),"source");
this._updateConnector(this.target(),"target");
},_updateConnector:function(br,bs){var bu=this;
var bp=bu.diagram;
if(br instanceof u&&!bp.getShapeById(br.shape.id)){var Y=br.shape.dataItem;
var X=br.options.name;
var bt=function(){var bv=bp._dataMap[Y.id];
br=bv.getConnector(X);
bu[bs](br,false);
bu.updateModel();
};
if(bp._dataMap[Y.id]){bt();
}else{var bq=bp._inactiveShapeItems.getByUid(Y.uid);
if(bq){bp._deferredConnectionUpdates.push(bq.onActivate(bt));
}}}else{bu[bs](br,false);
}},content:function(X){return this._content(X);
},select:function(bq){var Y=this.diagram,bp,X;
if(this._canSelect()){if(this.isSelected!==bq){this.isSelected=bq;
bp=[];
X=[];
if(this.isSelected){this.adorner=new s(this,this.options.selection);
Y._adorn(this.adorner,true);
Y._selectedItems.push(this);
bp.push(this);
}else{if(this.adorner){Y._adorn(this.adorner,false);
bh.remove(Y._selectedItems,this);
this.adorner=bf;
X.push(this);
}}this.refresh();
if(!Y._internalSelection){Y._selectionChanged(bp,X);
}return true;
}}},bounds:function(X){if(X&&!au(X)){this._bounds=X;
}else{return this._bounds;
}},type:function(Y){var X=this.options;
if(Y){if(Y!==X.type){X.type=Y;
this._initRouter();
this.refresh();
}}else{return X.type;
}},_initRouter:function(){var X=(this.options.type||"").toLowerCase();
if(X==h){this._router=new i(this);
}else{this._router=new aR(this);
}},points:function(br){if(br){this.definers=[];
for(var Y=0;
Y<br.length;
Y++){var X=br[Y];
if(X instanceof R.Point){this.definers.push(new R.PathDefiner(X));
}else{if(X.hasOwnProperty("x")&&X.hasOwnProperty("y")){this.definers.push(new R.PathDefiner(new aP(X.x,X.y)));
}else{throw"A Connection point needs to be a Point or an object with x and y properties.";
}}}}else{var bq=[];
if(ap(this.definers)){for(var bp=0;
bp<this.definers.length;
bp++){bq.push(this.definers[bp].point);
}}return bq;
}},allPoints:function(){var Y=[this.sourcePoint()];
if(this.definers){for(var X=0;
X<this.definers.length;
X++){Y.push(this.definers[X].point);
}}Y.push(this.targetPoint());
return Y;
},refresh:function(){aX(this);
var bp=this.sourcePoint(),Y=this.targetPoint(),X,br,bq,bs;
this._refreshPath();
X=this._bounds.topLeft();
br=bp.minus(X);
bq=Y.minus(X);
if(this._contentVisual){bs=aP.fn.middleOf(br,bq);
this._contentVisual.position(new aP(bs.x+X.x,bs.y+X.y));
}if(this.adorner){this.adorner.refresh();
}},redraw:function(X){if(X){this.options=z({},this.options,X);
var Y=this.options.points;
if((X&&X.content)||X.text){this.content(X.content);
}if(N(Y)&&Y.length>0){this.points(Y);
this._refreshPath();
}this.path.redraw({fill:X.fill,stroke:X.stroke,startCap:X.startCap,endCap:X.endCap});
}},clone:function(){var X=this.serialize();
if(this.diagram&&this.diagram._isEditable&&N(this.dataItem)){X.options.dataItem=n(this.dataItem);
}return new q(this.from,this.to,X.options);
},serialize:function(){var X=this.from.toJSON?this.from.toJSON:this.from.toString(),bp=this.to.toJSON?this.to.toJSON:this.to.toString();
var Y=z({},{options:this.options,from:X,to:bp});
if(N(this.dataItem)){Y.dataItem=this.dataItem.toString();
}Y.options.points=this.points();
return Y;
},_hitTest:function(bq){if(this.visible()){var Y=new aP(bq.x,bq.y),X=this.sourcePoint(),bp=this.targetPoint();
if(bq.isEmpty&&!bq.isEmpty()&&bq.contains(X)&&bq.contains(bp)){return this;
}if(this._router.hitTest(Y)){return this;
}}},_hover:function(Y){var X=(this.options.stroke||{}).color;
if(Y&&ap(this.options.hover.stroke.color)){X=this.options.hover.stroke.color;
}this.path.redraw({stroke:{color:X}});
},_refreshPath:function(){if(!N(this.path)){return;
}this._drawPath();
this.bounds(this._router.getBounds());
},_drawPath:function(){if(this._router){this._router.route();
}var Y=this.sourcePoint();
var bp=this.targetPoint();
var X=this.points();
this.path.redraw({points:[Y].concat(X,[bp])});
},_clearSourceConnector:function(){bh.remove(this.sourceConnector.connections,this);
this.sourceConnector=bf;
this._resolvedSourceConnector=bf;
},_clearTargetConnector:function(){bh.remove(this.targetConnector.connections,this);
this.targetConnector=bf;
this._resolvedTargetConnector=bf;
}});
var S=bj.extend({init:function(X,bp){var Y=this;
kendo.destroy(X);
bj.fn.init.call(Y,X,bp);
Y._initTheme();
Y._initElements();
Y._extendLayoutOptions(Y.options);
Y._initDefaults(bp);
Y._initCanvas();
Y.mainLayer=new af({id:"main-layer"});
Y.canvas.append(Y.mainLayer);
Y._pan=new aP();
Y._adorners=[];
Y.adornerLayer=new af({id:"adorner-layer"});
Y.canvas.append(Y.adornerLayer);
Y._createHandlers();
Y._initialize();
Y._fetchFreshData();
Y._createGlobalToolBar();
Y._resizingAdorner=new aW(Y,{editable:Y.options.editable});
Y._connectorsAdorner=new v(Y);
Y._adorn(Y._resizingAdorner,true);
Y._adorn(Y._connectorsAdorner,true);
Y.selector=new a1(Y);
Y._clipboard=[];
Y.pauseMouseHandlers=false;
Y._createShapes();
Y._createConnections();
if(Y.options.layout){Y.layout(Y.options.layout);
}Y.zoom(Y.options.zoom);
Y.canvas.draw();
},options:{name:"Diagram",theme:"default",layout:"",zoomRate:0.1,zoom:1,zoomMin:0,zoomMax:2,dataSource:{},draggable:true,template:"",autoBind:true,editable:{rotate:{},resize:{},text:true,tools:[]},pannable:{key:"ctrl"},selectable:{key:"none"},tooltip:{enabled:true,format:"{0}"},copy:{enabled:true,offsetX:20,offsetY:20},snap:{enabled:true,size:10,angle:10},shapeDefaults:R.shapeDefaults({undoable:true}),connectionDefaults:{editable:{tools:[]}},shapes:[],connections:[]},events:[bn,bo,aN,a0,ax,aw,j,m,aF,aG,"toolBarClick","save","cancel","edit","remove","add","dataBound"],_createGlobalToolBar:function(){var X=this.options.editable;
if(X){var Y=X.tools;
if(this._isEditable&&Y.length===0){Y=["createShape","undo","redo","rotateClockwise","rotateAnticlockwise"];
}if(Y&&Y.length){this.toolBar=new U(this,{tools:Y||{},click:aT(this._toolBarClick,this),modal:false});
this.toolBar.element.css({position:"absolute",top:0,left:0,width:this.element.width(),textAlign:"left"});
this.element.append(this.toolBar.element);
}}},createShape:function(){if((this.editor&&this.editor.end())||!this.editor){var X=this.dataSource;
var bs=X.view()||[];
var bp=bs.length;
var bq=w(X,{});
var br=this._createShape(bq,{});
if(!this.trigger("add",{shape:br})){X.insert(bp,bq);
var Y=this._inactiveShapeItems.getByUid(bq.uid);
Y.element=br;
this.edit(br);
}}},_createShape:function(X,Y){Y=z({},this.options.shapeDefaults,Y);
Y.dataItem=X;
var bp=new a2(Y,this);
return bp;
},createConnection:function(){if(((this.editor&&this.editor.end())||!this.editor)){var Y=this.connectionsDataSource;
var br=Y.view()||[];
var bp=br.length;
var bq=w(Y,{});
var X=this._createConnection(bq);
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bq.uid]=X;
Y.insert(bp,bq);
this.addConnection(X,false);
this.edit(X);
}}},_createConnection:function(Y,bq,br){var bp=z({},this.options.connectionDefaults);
bp.dataItem=Y;
var X=new q(bq||new aP(),br||new aP(),bp);
return X;
},editModel:function(Y,br){this.cancelEdit();
var bq,bs;
var bp=this.options.editable;
if(br=="shape"){bq=bp.shapeEditors;
bs=bp.shapeTemplate;
}else{if(br=="connection"){var X=aT(t,this);
bq=z({},{from:X,to:X},bp.connectionEditors);
bs=bp.connectionTemplate;
}else{return;
}}this.editor=new aS(this.element,{update:aT(this._update,this),cancel:aT(this._cancel,this),model:Y,type:br,target:this,editors:bq,template:bs});
this.trigger("edit",this._editArgs());
},edit:function(Y){if(Y.dataItem){var X=Y instanceof a2?"shape":"connection";
this.editModel(Y.dataItem,X);
}},cancelEdit:function(){if(this.editor){this._getEditDataSource().cancelChanges(this.editor.model);
this._destroyEditor();
}},saveEdit:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
}},_update:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
this._destroyEditor();
}},_cancel:function(){if(this.editor&&!this.trigger("cancel",this._editArgs())){var Y=this.editor.model;
this._getEditDataSource().cancelChanges(Y);
var X=this._connectionsDataMap[Y.uid]||this._dataMap[Y.id];
if(X){X._setOptionsFromModel(Y);
}this._destroyEditor();
}},_getEditDataSource:function(){return this.editor.options.type==="shape"?this.dataSource:this.connectionsDataSource;
},_editArgs:function(){var X={container:this.editor.element};
X[this.editor.options.type]=this.editor.model;
return X;
},_destroyEditor:function(){if(this.editor){this.editor.close();
this.editor=null;
}},_initElements:function(){this.wrapper=this.element.empty().css("position","relative").attr("tabindex",0).addClass("k-widget k-diagram");
this.scrollable=a("<div />").appendTo(this.element);
},_initDefaults:function(Y){var X=this.options;
var bp=(Y||{}).shapeDefaults;
if(X.editable===false){X.shapeDefaults.editable=false;
X.connectionDefaults.editable=false;
}if(bp&&bp.connectors){X.shapeDefaults.connectors=bp.connectors;
}},_initCanvas:function(){var X=a("<div class='k-layer'></div>").appendTo(this.scrollable)[0];
var Y=this.viewport();
this.canvas=new g(X,{width:Y.width||B,height:Y.height||A});
},_createHandlers:function(){var Y=this;
var X=Y.element;
X.on(aH,aT(Y._wheel,Y));
if(!kendo.support.touch&&!kendo.support.mobileOS){Y.toolService=new ba(Y);
this.scroller.wrapper.on("mousemove"+aL,aT(Y._mouseMove,Y)).on("mouseup"+aL,aT(Y._mouseUp,Y)).on("mousedown"+aL,aT(Y._mouseDown,Y)).on("mouseover"+aL,aT(Y._mouseover,Y)).on("mouseout"+aL,aT(Y._mouseout,Y));
X.on("keydown"+aL,aT(Y._keydown,Y));
}else{Y._userEvents=new kendo.UserEvents(X,{multiTouch:true,tap:aT(Y._tap,Y)});
Y._userEvents.bind(["gesturestart","gesturechange","gestureend"],{gesturestart:aT(Y._gestureStart,Y),gesturechange:aT(Y._gestureChange,Y),gestureend:aT(Y._gestureEnd,Y)});
Y.toolService=new ba(Y);
if(Y.options.pannable!==false){Y.scroller.enable();
}}this._syncHandler=aT(Y._syncChanges,Y);
Y._resizeHandler=aT(Y.resize,Y);
kendo.onResize(Y._resizeHandler);
this.bind(bo,aT(Y._destroyToolBar,Y));
this.bind(aN,aT(Y._destroyToolBar,Y));
},_tap:function(X){var bq=this.toolService;
var bp=this._caculateMobilePosition(X);
bq._updateHoveredItem(bp);
if(bq.hoveredItem){var Y=bq.hoveredItem;
if(this.options.selectable!==false){this._destroyToolBar();
if(Y.isSelected){Y.select(false);
}else{this.select(Y,{addToSelection:true});
}this._createToolBar();
}this.trigger("click",{item:Y,point:bp});
}},_caculateMobilePosition:function(X){return this.documentToModel(aP(X.x.location,X.y.location));
},_gestureStart:function(X){this._destroyToolBar();
this.scroller.disable();
var bp=this.documentToModel(new aP(X.center.x,X.center.y));
var Y={point:bp,zoom:this.zoom()};
if(this.trigger(bo,Y)){return;
}this._gesture=X;
this._initialCenter=bp;
},_gestureChange:function(Y){var br=this._gesture;
var bp=this._initialCenter;
var X=this.documentToView(new aP(Y.center.x,Y.center.y));
var bs=Y.distance/br.distance;
var bu=this._zoom;
var bt=false;
if(az.abs(bs-1)>=aE){this._zoom=bu=this._getValidZoom(bu*bs);
this.options.zoom=bu;
this._gesture=Y;
bt=true;
}var bv=bp.times(bu);
var bq=X.minus(bv);
if(bt||this._pan.distanceTo(bq)>=aD){this._panTransform(bq);
this._updateAdorners();
}Y.preventDefault();
},_gestureEnd:function(){if(this.options.pannable!==false){this.scroller.enable();
}this.trigger(bn,{point:this._initialCenter,zoom:this.zoom()});
},_resize:function(X){if(this.canvas){this.canvas.size(X);
}if(this.toolBar){this.toolBar._toolBar.element.width(this.element.width());
}},_mouseover:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(true,Y.srcElement);
}},_mouseout:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(false,Y.srcElement);
}},_initTheme:function(){var X=this,bq=y.ui.themes||{},Y=((X.options||{}).theme||"").toLowerCase(),bp=(bq[Y]||{}).diagram;
X.options=z({},bp,X.options);
},_createShapes:function(){var br=this,Y=br.options,bq=Y.shapes,bp,X;
for(X=0;
X<bq.length;
X++){bp=bq[X];
br.addShape(bp);
}},_createConnections:function(){var bq=this,bs=bq.options,bp=bs.connectionDefaults,Y=bs.connections,X,bt,bu,br;
for(br=0;
br<Y.length;
br++){X=Y[br];
bt=bq._findConnectionShape(X.from);
bu=bq._findConnectionShape(X.to);
bq.connect(bt,bu,z({},bp,X));
}},_findConnectionShape:function(Y){var X=this,bq=au(Y)?Y:Y.shapeId;
var bp=X.getShapeById(bq);
return bp.getConnector(Y.connector||d);
},destroy:function(){var X=this;
bj.fn.destroy.call(X);
if(this._userEvents){this._userEvents.destroy();
}kendo.unbindResize(X._resizeHandler);
X.clear();
X.element.off(aL);
X.scroller.wrapper.off(aL);
X.canvas.destroy(true);
X.canvas=bf;
X._destroyEditor();
X.destroyScroller();
X._destroyGlobalToolBar();
X._destroyToolBar();
},destroyScroller:function(){var X=this.scroller;
if(!X){return;
}X.destroy();
X.element.remove();
this.scroller=null;
},save:function(){var bq={},bp;
bq.shapes=[];
bq.connections=[];
for(bp=0;
bp<this.shapes.length;
bp++){var br=this.shapes[bp];
if(br.options.serializable){bq.shapes.push(br.options);
}}for(bp=0;
bp<this.connections.length;
bp++){var X=this.connections[bp];
var Y=z({},X.options,{from:X.from.toJSON(),to:X.to.toJSON()});
bq.connections.push(Y);
}return bq;
},focus:function(){if(!this.element.is(kendo._activeElement())){var bp=this.element,bs=bp[0],X=[],br=[],Y=document.documentElement,bq;
do{bs=bs.parentNode;
if(bs.scrollHeight>bs.clientHeight){X.push(bs);
br.push(bs.scrollTop);
}}while(bs!=Y);
bp.focus();
for(bq=0;
bq<X.length;
bq++){X[bq].scrollTop=br[bq];
}}},load:function(X){this.clear();
this.setOptions(X);
this._createShapes();
this._createConnections();
},setOptions:function(X){z(this.options,X);
},clear:function(){var X=this;
X.select(false);
X.mainLayer.clear();
X._initialize();
},connect:function(bq,br,bp){var X;
if(this.connectionsDataSource&&this._isEditable){var Y=this.connectionsDataSource.add({});
X=this._connectionsDataMap[Y.uid];
X.source(bq);
X.target(br);
X.redraw(bp);
X.updateModel();
}else{X=new q(bq,br,z({},this.options.connectionDefaults,bp));
this.addConnection(X);
}return X;
},connected:function(bp,bq){for(var Y=0;
Y<this.connections.length;
Y++){var X=this.connections[Y];
if(X.from==bp&&X.to==bq){return true;
}}return false;
},addConnection:function(X,Y){if(Y!==false){this.undoRedoService.add(new R.AddConnectionUnit(X,this),false);
}X.diagram=this;
this.mainLayer.append(X.visual);
this.connections.push(X);
X.updateOptionsFromModel();
return X;
},_addConnection:function(X,bq){var Y=this.connectionsDataSource;
var bp;
if(Y&&this._isEditable){bp=w(Y,n(X.dataItem));
X.dataItem=bp;
X.updateModel();
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bp.uid]=X;
Y.add(bp);
this.addConnection(X,bq);
X._updateConnectors();
return X;
}}else{if(!this.trigger("add",{connection:X})){this.addConnection(X,bq);
X._updateConnectors();
return X;
}}},addShape:function(X,Y){var bp,bq=this.options.shapeDefaults;
if(X instanceof a2){bq=z({},bq,Y);
X.redraw(Y);
bp=X;
}else{if(!(X instanceof kendo.Class)){bq=z({},bq,X||{});
bp=new a2(bq);
}else{return;
}}if(bq.undoable){this.undoRedoService.add(new R.AddShapeUnit(bp,this),false);
}this.shapes.push(bp);
bp.diagram=this;
this.mainLayer.append(bp.visual);
this.trigger(j,{added:[bp],removed:[]});
if(bp.hasOwnProperty("layout")){bp.layout(bp);
}return bp;
},_addShape:function(bq,bs){var br=this;
var Y=br.dataSource;
var X;
if(Y&&this._isEditable){X=w(Y,n(bq.dataItem));
bq.dataItem=X;
bq.updateModel();
if(!this.trigger("add",{shape:bq})){this.dataSource.add(X);
var bp=this._inactiveShapeItems.getByUid(X.uid);
bp.element=bq;
bp.undoable=bs;
return bq;
}}else{if(!this.trigger("add",{shape:bq})){return this.addShape(bq,{undoable:bs});
}}},remove:function(bq,bs){bq=an(bq)?bq.slice(0):[bq];
var Y=a5(bq);
var br=Y.shapes;
var X=Y.connections;
var bp;
if(!N(bs)){bs=true;
}if(bs){this.undoRedoService.begin();
}this._suspendModelRefresh();
for(bp=br.length-1;
bp>=0;
bp--){this._removeItem(br[bp],bs,X);
}for(bp=X.length-1;
bp>=0;
bp--){this._removeItem(X[bp],bs);
}this._resumeModelRefresh();
if(bs){this.undoRedoService.commit(false);
}this.trigger(j,{added:[],removed:bq});
},_removeShapeDataItem:function(X){if(this._isEditable){this.dataSource.remove(X.dataItem);
delete this._dataMap[X.dataItem.id];
}},_removeConnectionDataItem:function(X){if(this._isEditable){this.connectionsDataSource.remove(X.dataItem);
delete this._connectionsDataMap[X.dataItem.uid];
}},_triggerRemove:function(bq){var br=[];
var bp,X;
for(var Y=0;
Y<bq.length;
Y++){bp=bq[Y];
if(bp instanceof a2){X={shape:bp};
}else{X={connection:bp};
}if(!this.trigger("remove",X)){br.push(bp);
}}return br;
},undo:function(){this.undoRedoService.undo();
},redo:function(){this.undoRedoService.redo();
},select:function(bq,bs){if(ap(bq)){bs=z({addToSelection:false},bs);
var X=bs.addToSelection,br=[],bt=[],bp,Y;
if(!X){this.deselect();
}this._internalSelection=true;
if(bq instanceof Array){br=bq;
}else{if(bq instanceof T){br=[bq];
}}for(bp=0;
bp<br.length;
bp++){Y=br[bp];
if(Y.select(true)){bt.push(Y);
}}this._selectionChanged(bt,[]);
this._internalSelection=false;
}else{return this._selectedItems;
}},selectAll:function(){this.select(this.shapes.concat(this.connections));
},selectArea:function(bq){var X,bp,Y;
this._internalSelection=true;
var br=[];
if(bq instanceof aU){bp=this.shapes.concat(this.connections);
for(X=0;
X<bp.length;
X++){Y=bp[X];
if((!bq||Y._hitTest(bq))&&Y.options.enable){if(Y.select(true)){br.push(Y);
}}}}this._selectionChanged(br,[]);
this._internalSelection=false;
},deselect:function(bq){this._internalSelection=true;
var X=[],br=[],Y,bp;
if(bq instanceof Array){br=bq;
}else{if(bq instanceof T){br.push(bq);
}else{if(!ap(bq)){br=this._selectedItems.slice(0);
}}}for(bp=0;
bp<br.length;
bp++){Y=br[bp];
if(Y.select(false)){X.push(Y);
}}this._selectionChanged([],X);
this._internalSelection=false;
},toFront:function(Y,bq){if(!Y){Y=this._selectedItems.slice();
}var bp=this._getDiagramItems(Y),X;
if(!N(bq)||bq){X=al(this.mainLayer,bp.visuals);
var br=new a9(this,Y,X);
this.undoRedoService.add(br);
}else{this.mainLayer.toFront(bp.visuals);
this._fixOrdering(bp,true);
}},toBack:function(Y,bq){if(!Y){Y=this._selectedItems.slice();
}var bp=this._getDiagramItems(Y),X;
if(!N(bq)||bq){X=al(this.mainLayer,bp.visuals);
var br=new a8(this,Y,X);
this.undoRedoService.add(br);
}else{this.mainLayer.toBack(bp.visuals);
this._fixOrdering(bp,false);
}},bringIntoView:function(bp,br){var bu=this.viewport();
var X=new R.RectAlign(bu);
var Y,bt,bs,bq;
if(bu.width===0||bu.height===0){return;
}br=z({animate:false,align:"center middle"},br);
if(br.align=="none"){br.align="center middle";
}if(bp instanceof T){bt=bp.bounds(bc);
}else{if(an(bp)){bt=this.boundingBox(bp);
}else{if(bp instanceof aU){bt=bp.clone();
}}}bs=bt.clone();
bt.zoom(this._zoom);
this._storePan(new aP());
if(bt.width>bu.width||bt.height>bu.height){this._zoom=this._getValidZoom(az.min(bu.width/bs.width,bu.height/bs.height));
bt=bs.clone().zoom(this._zoom);
}this._zoomMainLayer();
Y=bt.clone();
X.align(bt,br.align);
bq=bt.topLeft().minus(Y.topLeft());
this.pan(bq.times(-1),br.animate);
},alignShapes:function(X){if(av(X)){X="Left";
}var bq=this.select(),bu,bp,Y;
if(bq.length===0){return;
}switch(X.toLowerCase()){case"left":case"top":bu=aA;
break;
case"right":case"bottom":bu=aC;
break;
}for(Y=0;
Y<bq.length;
Y++){bp=bq[Y];
if(bp instanceof a2){switch(X.toLowerCase()){case"left":bu=az.min(bu,bp.options.x);
break;
case"top":bu=az.min(bu,bp.options.y);
break;
case"right":bu=az.max(bu,bp.options.x);
break;
case"bottom":bu=az.max(bu,bp.options.y);
break;
}}}var bs=[];
var br=[];
for(Y=0;
Y<bq.length;
Y++){bp=bq[Y];
if(bp instanceof a2){br.push(bp);
bs.push(bp.bounds());
switch(X.toLowerCase()){case"left":case"right":bp.position(new aP(bu,bp.options.y));
break;
case"top":case"bottom":bp.position(new aP(bp.options.x,bu));
break;
}}}var bt=new R.TransformUnit(br,bs);
this.undoRedoService.add(bt,false);
},zoom:function(br,X){if(br){var bp=X?X.point:new R.Point(0,0);
br=this._zoom=this._getValidZoom(br);
if(!av(bp)){bp=new R.Point(az.round(bp.x),az.round(bp.y));
var bs=bp.times(br);
var bq=this.modelToView(bp);
var Y=bq.minus(bs);
this._storePan(new R.Point(az.round(Y.x),az.round(Y.y)));
}if(X){X.zoom=br;
}this._panTransform();
this._updateAdorners();
}return this._zoom;
},_getPan:function(Y){var X=this.canvas;
if(!X.translate){Y=Y.plus(this._pan);
}return Y;
},pan:function(Y,X){if(Y instanceof aP){var bq=this;
var bp=bq.scroller;
Y=bq._getPan(Y);
Y=Y.times(-1);
if(X){bp.animatedScrollTo(Y.x,Y.y,function(){bq._updateAdorners();
});
}else{bp.scrollTo(Y.x,Y.y);
bq._updateAdorners();
}}},viewport:function(){var X=this.element;
return new aU(0,0,X.width(),X.height());
},copy:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=1;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}}},cut:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=0;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}this.remove(this._clipboard,true);
}},paste:function(){if(this._clipboard.length>0){var br,Y,bq;
var bs={};
var bp=a5(this._clipboard);
var X=bp.connections;
var bu=bp.shapes;
var bt={x:this._copyOffset*this.options.copy.offsetX,y:this._copyOffset*this.options.copy.offsetY};
this.deselect();
for(bq=0;
bq<bu.length;
bq++){br=bu[bq];
Y=br.clone();
bs[br.id]=Y;
Y.position(new aP(br.options.x+bt.x,br.options.y+bt.y));
Y.diagram=this;
Y=this._addShape(Y);
if(Y){Y.select();
}}for(bq=0;
bq<X.length;
bq++){br=X[bq];
Y=this._addConnection(br.clone());
if(Y){this._updateCopiedConnection(Y,br,"source",bs,bt);
this._updateCopiedConnection(Y,br,"target",bs,bt);
Y.select(true);
Y.updateModel();
}}this._syncChanges();
this._copyOffset+=1;
}},_updateCopiedConnection:function(X,bu,Y,br,bs){var bt,bq,bw;
var bv=bu[Y]();
var bp=this;
if(bv instanceof u&&br[bv.shape.id]){bw=br[bv.shape.id];
if(bp.getShapeById(bw.id)){X[Y](bw.getConnector(bv.options.name));
}else{bq=bp._inactiveShapeItems.getByUid(bw.dataItem.uid);
if(bq){bt=function(bx){bw=bp._dataMap[bx.id];
X[Y](bw.getConnector(bv.options.name));
X.updateModel();
};
bp._deferredConnectionUpdates.push(bq.onActivate(bt));
}}}else{X[Y](new aP(bu[Y+"Point"]().x+bs.x,bu[Y+"Point"]().y+bs.y));
}},boundingBox:function(bq,br){var bs=aU.empty(),bt,X=ap(bq)?this._getDiagramItems(bq):{shapes:this.shapes};
if(X.shapes.length>0){var bp=X.shapes[0];
bs=bp.bounds(aZ);
for(var Y=1;
Y<X.shapes.length;
Y++){bp=X.shapes[Y];
bt=bp.bounds(aZ);
if(br===true){bt.x-=bp._rotationOffset.x;
bt.y-=bp._rotationOffset.y;
}bs=bs.union(bt);
}}return bs;
},documentToView:function(Y){var X=this.element.offset();
return new aP(Y.x-X.left,Y.y-X.top);
},viewToDocument:function(Y){var X=this.element.offset();
return new aP(Y.x+X.left,Y.y+X.top);
},viewToModel:function(X){return this._transformWithMatrix(X,this._matrixInvert);
},modelToView:function(X){return this._transformWithMatrix(X,this._matrix);
},modelToLayer:function(X){return this._transformWithMatrix(X,this._layerMatrix);
},layerToModel:function(X){return this._transformWithMatrix(X,this._layerMatrixInvert);
},documentToModel:function(X){var Y=this.documentToView(X);
if(!this.canvas.translate){Y.x=Y.x+this.scroller.scrollLeft;
Y.y=Y.y+this.scroller.scrollTop;
}return this.viewToModel(Y);
},modelToDocument:function(X){return this.viewToDocument(this.modelToView(X));
},_transformWithMatrix:function(bp,Y){var bq=bp;
if(bp instanceof aP){if(Y){bq=Y.apply(bp);
}}else{var br=this._transformWithMatrix(bp.topLeft(),Y),X=this._transformWithMatrix(bp.bottomRight(),Y);
bq=aU.fromPoints(br,X);
}return bq;
},setDataSource:function(X){this.options.dataSource=X;
this._dataSource();
if(this.options.autoBind){this.dataSource.fetch();
}},setConnectionsDataSource:function(X){this.options.connectionsDataSource=X;
this._connectionDataSource();
if(this.options.autoBind){this.connectionsDataSource.fetch();
}},layout:function(bq){this.isLayouting=true;
var br;
if(av(bq)){bq=this.options.layout;
}if(av(bq)||av(bq.type)){br="Tree";
}else{br=bq.type;
}var bp;
switch(br.toLowerCase()){case"tree":bp=new R.TreeLayout(this);
break;
case"layered":bp=new R.LayeredLayout(this);
break;
case"forcedirected":case"force":case"spring":case"springembedder":bp=new R.SpringLayout(this);
break;
default:throw"Layout algorithm '"+br+"' is not supported.";
}var Y=new R.LayoutState(this);
var X=bp.layout(bq);
if(X){var bs=new R.LayoutUndoUnit(Y,X,bq?bq.animate:null);
this.undoRedoService.add(bs);
}this.isLayouting=false;
},getShapeById:function(Y){var X;
X=bh.first(this.shapes,function(bp){return bp.visual.id===Y;
});
if(X){return X;
}X=bh.first(this.connections,function(bp){return bp.visual.id===Y;
});
return X;
},_extendLayoutOptions:function(X){if(X.layout){X.layout=z(R.LayoutBase.fn.defaultOptions||{},X.layout);
}},_selectionChanged:function(Y,X){if(Y.length||X.length){this.trigger(a0,{selected:Y,deselected:X});
}},_getValidZoom:function(X){return az.min(az.max(X,this.options.zoomMin),this.options.zoomMax);
},_panTransform:function(bp){var X=this,Y=bp||X._pan;
if(X.canvas.translate){X.scroller.scrollTo(Y.x,Y.y);
X._zoomMainLayer();
}else{X._storePan(Y);
X._transformMainLayer();
}},_finishPan:function(){this.trigger(aN,{total:this._pan,delta:Number.NaN});
},_storePan:function(X){this._pan=X;
this._storeViewMatrix();
},_zoomMainLayer:function(){var Y=this._zoom;
var X=new p(0,0,Y,Y);
X.render(this.mainLayer);
this._storeLayerMatrix(X);
this._storeViewMatrix();
},_transformMainLayer:function(){var X=this._pan,bp=this._zoom;
var Y=new p(X.x,X.y,bp,bp);
Y.render(this.mainLayer);
this._storeLayerMatrix(Y);
this._storeViewMatrix();
},_storeLayerMatrix:function(X){this._layerMatrix=X.toMatrix();
this._layerMatrixInvert=X.invert().toMatrix();
},_storeViewMatrix:function(){var X=this._pan,bp=this._zoom;
var Y=new p(X.x,X.y,bp,bp);
this._matrix=Y.toMatrix();
this._matrixInvert=Y.invert().toMatrix();
},_toIndex:function(Y,X){var bp=this._getDiagramItems(Y);
this.mainLayer.toIndex(bp.visuals,X);
this._fixOrdering(bp,false);
},_fixOrdering:function(bq,bs){var br=bs?this.shapes.length-1:0,X=bs?this.connections.length-1:0,Y,bp;
for(Y=0;
Y<bq.shapes.length;
Y++){bp=bq.shapes[Y];
bh.remove(this.shapes,bp);
bh.insert(this.shapes,bp,br);
}for(Y=0;
Y<bq.cons.length;
Y++){bp=bq.cons[Y];
bh.remove(this.connections,bp);
bh.insert(this.connections,bp,X);
}},_getDiagramItems:function(bq){var Y,br={},X=bq;
br.visuals=[];
br.shapes=[];
br.cons=[];
if(!bq){X=this._selectedItems.slice();
}else{if(!an(bq)){X=[bq];
}}for(Y=0;
Y<X.length;
Y++){var bp=X[Y];
if(bp instanceof a2){br.shapes.push(bp);
br.visuals.push(bp.visual);
}else{if(bp instanceof q){br.cons.push(bp);
br.visuals.push(bp.visual);
}}}return br;
},_removeItem:function(X,bp,Y){X.select(false);
if(X instanceof a2){this._removeShapeDataItem(X);
this._removeShape(X,bp,Y);
}else{if(X instanceof q){this._removeConnectionDataItem(X);
this._removeConnection(X,bp);
}}this.mainLayer.remove(X.visual);
},_removeShape:function(bs,bv,br){var bp,X,Y,bt=[],bu=[];
this.toolService._removeHover();
if(bv){this.undoRedoService.addCompositeItem(new P(bs));
}bh.remove(this.shapes,bs);
for(bp=0;
bp<bs.connectors.length;
bp++){Y=bs.connectors[bp];
for(var bq=0;
bq<Y.connections.length;
bq++){X=Y.connections[bq];
if(!br||!y.inArray(X,br)){if(X.sourceConnector==Y){bt.push(X);
}else{if(X.targetConnector==Y){bu.push(X);
}}}}}for(bp=0;
bp<bt.length;
bp++){bt[bp].source(null,bv);
bt[bp].updateModel();
}for(bp=0;
bp<bu.length;
bp++){bu[bp].target(null,bv);
bu[bp].updateModel();
}},_removeConnection:function(X,Y){if(X.sourceConnector){bh.remove(X.sourceConnector.connections,X);
}if(X.targetConnector){bh.remove(X.targetConnector.connections,X);
}if(Y){this.undoRedoService.addCompositeItem(new O(X));
}bh.remove(this.connections,X);
},_removeDataItems:function(bq,br){var bp,X,bs,Y;
bq=an(bq)?bq:[bq];
while(bq.length){bp=bq.shift();
bs=this._dataMap[bp.uid];
if(bs){this._removeShapeConnections(bs);
this._removeItem(bs,false);
delete this._dataMap[bp.uid];
if(br&&bp.hasChildren&&bp.loaded()){X=bp.children.data();
for(Y=0;
Y<X.length;
Y++){bq.push(X[Y]);
}}}}},_removeShapeConnections:function(bp){var X=bp.connections();
var Y;
if(X){for(Y=0;
Y<X.length;
Y++){this._removeItem(X[Y],false);
}}},_addDataItem:function(X,bq){if(!N(X)){return;
}var bp=this._dataMap[X.id];
if(bp){return bp;
}var Y=z({},this.options.shapeDefaults);
Y.dataItem=X;
bp=new a2(Y,this);
this.addShape(bp,{undoable:bq!==false});
this._dataMap[X.id]=bp;
return bp;
},_addDataItemByUid:function(X){if(!N(X)){return;
}var bp=this._dataMap[X.uid];
if(bp){return bp;
}var Y=z({},this.options.shapeDefaults);
Y.dataItem=X;
bp=new a2(Y,this);
this.addShape(bp);
this._dataMap[X.uid]=bp;
return bp;
},_addDataItems:function(bq,br){var bp,Y,bt,bs,X;
for(Y=0;
Y<bq.length;
Y++){bp=bq[Y];
bt=this._addDataItemByUid(bp);
bs=this._addDataItemByUid(br);
if(bs&&!this.connected(bs,bt)){X=this.connect(bs,bt);
X.type(h);
}}},_refreshSource:function(Y){var bt=this,br=Y.node,X=Y.action,bq=Y.items,bs=bt.options,bp;
if(Y.field){return;
}if(X=="remove"){this._removeDataItems(Y.items,true);
}else{if(!X&&!br){bt.clear();
}this._addDataItems(bq,br);
for(bp=0;
bp<bq.length;
bp++){bq[bp].load();
}}if(bs.layout){bt.layout(bs.layout);
}},_mouseDown:function(X){var Y=this._calculatePosition(X);
if(X.which==1&&this.toolService.start(Y,this._meta(X))){this._destroyToolBar();
X.preventDefault();
}},_addItem:function(X){if(X instanceof a2){this.addShape(X);
}else{if(X instanceof q){this.addConnection(X);
}}},_mouseUp:function(X){var Y=this._calculatePosition(X);
if(X.which==1&&this.toolService.end(Y,this._meta(X))){this._createToolBar();
X.preventDefault();
}},_createToolBar:function(){var Y=this.toolService.diagram;
if(!this.singleToolBar&&Y.select().length===1){var bp=Y.select()[0];
if(bp&&bp.options.editable!==false){var bw=bp.options.editable.tools;
if(this._isEditable&&bw.length===0){if(bp instanceof a2){bw=["edit","rotateClockwise","rotateAnticlockwise","delete"];
}else{if(bp instanceof q){bw=["edit","delete"];
}}}if(bw&&bw.length){var bq=20;
var br;
this.singleToolBar=new U(Y,{tools:bw,click:aT(this._toolBarClick,this),modal:true});
var bv=this.singleToolBar.element;
var bt=this.singleToolBar._popup.element.outerWidth();
var bs=this.singleToolBar._popup.element.outerHeight();
if(bp instanceof a2){var bu=this.modelToView(bp.bounds(aZ));
br=aP(bu.x,bu.y).minus(aP((bt-bu.width)/2,bs+bq));
}else{if(bp instanceof q){var X=this.modelToView(bp.bounds());
br=aP(X.x,X.y).minus(aP((bt-X.width-20)/2,bs+bq));
}}if(br){if(!this.canvas.translate){br=br.minus(aP(this.scroller.scrollLeft,this.scroller.scrollTop));
}br=this.viewToDocument(br);
br=aP(az.max(br.x,0),az.max(br.y,0));
this.singleToolBar.showAt(br);
}else{this._destroyToolBar();
}}}}},_toolBarClick:function(X){this.trigger("toolBarClick",X);
this._destroyToolBar();
},_mouseMove:function(X){if(this.pauseMouseHandlers){return;
}var Y=this._calculatePosition(X);
if((X.which===0||X.which==1)&&this.toolService.move(Y,this._meta(X))){X.preventDefault();
}},_keydown:function(X){if(this.toolService.keyDown(X.keyCode,this._meta(X))){X.preventDefault();
}},_wheel:function(Y){var X=aJ(Y),bq=this._calculatePosition(Y),bp=z(this._meta(Y),{delta:X});
if(this.toolService.wheel(bq,bp)){Y.preventDefault();
}},_meta:function(X){return{ctrlKey:X.ctrlKey,metaKey:X.metaKey,altKey:X.altKey,shiftKey:X.shiftKey};
},_calculatePosition:function(X){var bq=(X.pageX===bf?X.originalEvent:X),bp=new aP(bq.pageX,bq.pageY),Y=this.documentToModel(bp);
return Y;
},_normalizePointZoom:function(X){return X.times(1/this.zoom());
},_initialize:function(){this.shapes=[];
this._selectedItems=[];
this.connections=[];
this._dataMap={};
this._connectionsDataMap={};
this._inactiveShapeItems=new ak();
this._deferredConnectionUpdates=[];
this.undoRedoService=new bg({undone:this._syncHandler,redone:this._syncHandler});
this.id=R.randomId();
},_fetchFreshData:function(){var Y=this;
Y._dataSource();
if(Y._isEditable){Y._connectionDataSource();
}if(Y.options.autoBind){if(Y._isEditable){Y._preventRefresh=true;
Y._preventConnectionsRefresh=true;
var X=a.map([Y.dataSource,Y.connectionsDataSource],function(bp){return bp.fetch();
});
a.when.apply(null,X).done(function(){Y._preventRefresh=false;
Y._preventConnectionsRefresh=false;
Y.refresh();
});
}else{Y.dataSource.fetch();
}}},_dataSource:function(){if(N(this.options.connectionsDataSource)){this._isEditable=true;
var Y=this.options.dataSource||{};
var X=an(Y)?{data:Y}:Y;
if(this.dataSource&&this._shapesRefreshHandler){this.dataSource.unbind("change",this._shapesRefreshHandler).unbind("error",this._shapesErrorHandler);
}else{this._shapesRefreshHandler=aT(this._refreshShapes,this);
this._shapesErrorHandler=aT(this._error,this);
}this.dataSource=kendo.data.DataSource.create(X).bind("change",this._shapesRefreshHandler).bind("error",this._shapesErrorHandler);
}else{this._treeDataSource();
this._isEditable=false;
}},_connectionDataSource:function(){var Y=this.options.connectionsDataSource;
if(Y){var X=an(Y)?{data:Y}:Y;
if(this.connectionsDataSource&&this._connectionsRefreshHandler){this.connectionsDataSource.unbind("change",this._connectionsRefreshHandler).unbind("error",this._connectionsErrorHandler);
}else{this._connectionsRefreshHandler=aT(this._refreshConnections,this);
this._connectionsErrorHandler=aT(this._error,this);
}this.connectionsDataSource=kendo.data.DataSource.create(X).bind("change",this._connectionsRefreshHandler).bind("error",this._connectionsErrorHandler);
}},_refreshShapes:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeShapes(X.items);
}}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateShapes(X.items,X.field);
}}else{if(X.action==="add"){this._inactiveShapeItems.add(X.items);
}else{if(X.action==="sync"){this._syncShapes(X.items);
}else{this.refresh();
}}}}},_shouldRefresh:function(){return !this._suspended;
},_suspendModelRefresh:function(){this._suspended=(this._suspended||0)+1;
},_resumeModelRefresh:function(){this._suspended=az.max((this._suspended||0)-1,0);
},refresh:function(){if(this._preventRefresh){return;
}this.trigger("dataBound");
this.clear();
this._addShapes(this.dataSource.view());
if(this.connectionsDataSource){this._addConnections(this.connectionsDataSource.view(),false);
}if(this.options.layout){this.layout(this.options.layout);
}},refreshConnections:function(){if(this._preventConnectionsRefresh){return;
}this.trigger("dataBound");
this._addConnections(this.connectionsDataSource.view(),false);
if(this.options.layout){this.layout(this.options.layout);
}},_removeShapes:function(bq){var X=this._dataMap;
var bp,Y;
for(Y=0;
Y<bq.length;
Y++){bp=bq[Y];
if(X[bp.id]){this.remove(X[bp.id],false);
X[bp.id]=null;
}}},_syncShapes:function(bp){var X=this;
var Y=X._inactiveShapeItems;
Y.forEach(function(br){var bq=br.dataItem;
var bs=br.element;
if(!bq.isNew()){if(bs){bs._setOptionsFromModel();
X.addShape(bs,{undoable:br.undoable});
X._dataMap[bq.id]=bs;
}else{X._addDataItem(bq);
}br.activate();
Y.remove(bq);
}});
},_updateShapes:function(bq,Y){for(var bp=0;
bp<bq.length;
bp++){var X=bq[bp];
var br=this._dataMap[X.id];
if(br){br.updateOptionsFromModel(X,Y);
}}},_addShapes:function(X){for(var Y=0;
Y<X.length;
Y++){this._addDataItem(X[Y],false);
}},_refreshConnections:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeConnections(X.items);
}}else{if(X.action==="add"){this._addConnections(X.items);
}else{if(X.action==="sync"){}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateConnections(X.items);
}}else{this.refreshConnections();
}}}}},_removeConnections:function(Y){for(var X=0;
X<Y.length;
X++){this.remove(this._connectionsDataMap[Y[X].uid],false);
this._connectionsDataMap[Y[X].uid]=null;
}},_updateConnections:function(br){for(var bq=0;
bq<br.length;
bq++){var Y=br[bq];
var X=this._connectionsDataMap[Y.uid];
X.updateOptionsFromModel(Y);
var bp=this._validateConnector(Y.from);
if(bp){X.source(bp);
}var bs=this._validateConnector(Y.to);
if(bs){X.target(bs);
}}},_addConnections:function(X,br){var bq=X.length;
for(var bp=0;
bp<bq;
bp++){var Y=X[bp];
this._addConnectionDataItem(Y,br);
}},_addConnectionDataItem:function(Y,bs){if(!this._connectionsDataMap[Y.uid]){var bp=this._validateConnector(Y.from);
if(!N(bp)||bp===null){bp=new aP(Y.fromX,Y.fromY);
}var br=this._validateConnector(Y.to);
if(!N(br)||br===null){br=new aP(Y.toX,Y.toY);
}if(N(bp)&&N(br)){var bq=z({},this.options.connectionDefaults);
bq.dataItem=Y;
var X=new q(bp,br,bq);
X.type(bq.type||h);
this._connectionsDataMap[Y.uid]=X;
this.addConnection(X,bs);
}}},_validateConnector:function(Y){var X;
if(N(Y)&&Y!==null){X=this._dataMap[Y];
}return X;
},_treeDataSource:function(){var bp=this,Y=bp.options,X=Y.dataSource;
X=an(X)?{data:X}:X;
if(!X.fields){X.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}];
}if(bp.dataSource&&bp._refreshHandler){bp._unbindDataSource();
}bp._refreshHandler=aT(bp._refreshSource,bp);
bp._errorHandler=aT(bp._error,bp);
bp.dataSource=ah.create(X).bind(j,bp._refreshHandler).bind(aa,bp._errorHandler);
},_unbindDataSource:function(){var X=this;
X.dataSource.unbind(j,X._refreshHandler).unbind(aa,X._errorHandler);
},_error:function(){},_adorn:function(X,Y){if(Y!==bf&&X){if(Y){this._adorners.push(X);
this.adornerLayer.append(X.visual);
}else{bh.remove(this._adorners,X);
this.adornerLayer.remove(X.visual);
}}},_showConnectors:function(X,Y){if(Y){this._connectorsAdorner.show(X);
}else{this._connectorsAdorner.destroy();
}},_updateAdorners:function(){var Y=this._adorners;
for(var bp=0;
bp<Y.length;
bp++){var X=Y[bp];
if(X.refreshBounds){X.refreshBounds();
}X.refresh();
}},_refresh:function(){for(var X=0;
X<this.connections.length;
X++){this.connections[X].refresh();
}},_destroyToolBar:function(){if(this.singleToolBar){this.singleToolBar.hide();
this.singleToolBar.destroy();
this.singleToolBar=null;
}},_destroyGlobalToolBar:function(){if(this.toolBar){this.toolBar.hide();
this.toolBar.destroy();
this.toolBar=null;
}},exportDOMVisual:function(){var bq=this.canvas._viewBox;
var bp=ae.transform().translate(-bq.x,-bq.y);
var br=new ae.Rect([0,0],[bq.width,bq.height]);
var X=W.Path.fromRect(br);
var bs=new W.Group({transform:bp,clip:X});
var Y=this.canvas.drawingElement.children[0];
bs.children.push(Y);
return bs;
},exportVisual:function(){var Y=ae.transform().scale(1/this._zoom);
var bp=new W.Group({transform:Y});
var X=this.canvas.drawingElement.children[0];
bp.children.push(X);
return bp;
},_syncChanges:function(){this._syncShapeChanges();
this._syncConnectionChanges();
},_syncShapeChanges:function(){if(this.dataSource&&this._isEditable){this.dataSource.sync();
}},_syncConnectionChanges:function(){var X=this;
if(X.connectionsDataSource&&X._isEditable){a.when.apply(a,X._deferredConnectionUpdates).then(function(){X.connectionsDataSource.sync();
});
X.deferredConnectionUpdates=[];
}}});
y.ExportMixin.extend(S.fn,true);
if(kendo.PDFMixin){kendo.PDFMixin.extend(S.fn);
}function ad(X){var Y={};
X=X||{};
if(N(X.text)&&X.text!==null){Y.text=X.text;
}if(N(X.x)&&X.x!==null){Y.x=X.x;
}if(N(X.y)&&X.y!==null){Y.y=X.y;
}if(N(X.width)&&X.width!==null){Y.width=X.width;
}if(N(X.height)&&X.height!==null){Y.height=X.height;
}if(N(X.type)&&X.type!==null){Y.type=X.type;
}return Y;
}function ac(X){var Y={};
X=X||{};
if(N(X.text)&&X.text!==null){Y.content=X.text;
}if(N(X.type)&&X.type!==null){Y.type=X.type;
}if(N(X.from)&&X.from!==null){Y.from=X.from;
}if(N(X.fromX)&&X.fromX!==null){Y.fromX=X.fromX;
}if(N(X.fromY)&&X.fromY!==null){Y.fromY=X.fromY;
}if(N(X.to)&&X.to!==null){Y.to=X.to;
}if(N(X.toX)&&X.toX!==null){Y.toX=X.toX;
}if(N(X.toY)&&X.toY!==null){Y.toY=X.toY;
}return Y;
}function ar(X){return typeof X==="number"&&!isNaN(X);
}var U=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.diagram=X;
this.options=z({},this.options,Y);
this._tools=[];
this.createToolBar();
this.createTools();
this.appendTools();
if(this.options.modal){this.createPopup();
}this.bind(this.events,Y);
},events:["click"],createPopup:function(){this.container=a("<div/>").append(this.element);
this._popup=this.container.kendoPopup({}).getKendoPopup();
},appendTools:function(){for(var X=0;
X<this._tools.length;
X++){var Y=this._tools[X];
if(Y.buttons&&Y.buttons.length||!N(Y.buttons)){this._toolBar.add(Y);
}}},createToolBar:function(){this.element=a("<div/>");
this._toolBar=this.element.kendoToolBar({click:aT(this.click,this),resizable:false}).getKendoToolBar();
this.element.css("border","none");
},createTools:function(){for(var X=0;
X<this.options.tools.length;
X++){this.createTool(this.options.tools[X]);
}},createTool:function(X){var Y=(at(X)?X.name:X)+"Tool";
if(this[Y]){this[Y](X);
}else{this._tools.push(X);
}},showAt:function(X){if(this._popup){this._popup.open(X.x,X.y);
}},hide:function(){if(this._popup){this._popup.close();
}},newGroup:function(){return{type:"buttonGroup",buttons:[]};
},editTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-pencil",showText:"overflow",type:"button",text:"Edit",attributes:this._setAttributes({action:"edit"})});
},deleteTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-close",showText:"overflow",type:"button",text:"Delete",attributes:this._setAttributes({action:"delete"})});
},rotateAnticlockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotateccw",showText:"overflow",text:"RotateAnticlockwise",group:"rotate",attributes:this._setAttributes({action:"rotateAnticlockwise",step:X.step})});
},rotateClockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotatecw",attributes:this._setAttributes({action:"rotateClockwise",step:X.step}),showText:"overflow",text:"RotateClockwise",group:"rotate"});
},createShapeTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-shape",showText:"overflow",text:"CreateShape",group:"create",attributes:this._setAttributes({action:"createShape"})});
},createConnectionTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-connector",showText:"overflow",text:"CreateConnection",group:"create",attributes:this._setAttributes({action:"createConnection"})});
},undoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-undo",showText:"overflow",text:"Undo",group:"history",attributes:this._setAttributes({action:"undo"})});
},redoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-redo",showText:"overflow",text:"Redo",group:"history",attributes:this._setAttributes({action:"redo"})});
},_appendGroup:function(X){var Y="_"+X+"Group";
if(!this[Y]){this[Y]=this.newGroup();
this._tools.push(this[Y]);
}},_setAttributes:function(Y){var X={};
if(Y.action){X[kendo.attr("action")]=Y.action;
}if(Y.step){X[kendo.attr("step")]=Y.step;
}return X;
},_getAttributes:function(bp){var Y={};
var X=bp.attr(kendo.attr("action"));
if(X){Y.action=X;
}var bq=bp.attr(kendo.attr("step"));
if(bq){Y.step=bq;
}return Y;
},click:function(bp){var Y=this._getAttributes(a(bp.target));
var X=Y.action;
if(X){this[X](Y);
}this.trigger("click",this.eventData(X));
},eventData:function(X){var bp=this.selectedElements(),bq=[],Y=[];
if(bp instanceof a2){bq.push(bp);
}else{Y.push(bp);
}return{shapes:bq,connections:Y,action:X};
},"delete":function(){var X=this.diagram;
var Y=X._triggerRemove(this.selectedElements());
if(Y.length){this.diagram.remove(Y,true);
this.diagram._syncChanges();
}},edit:function(){this.diagram.edit(this.selectedElements()[0]);
},rotateClockwise:function(bp){var Y=this.selectedElements();
var X=parseFloat(bp.step||90);
this._rotate(X);
},rotateAnticlockwise:function(bp){var Y=this.selectedElements();
var X=parseFloat(bp.step||90);
this._rotate(-X);
},_rotate:function(Y){var X=this.diagram._resizingAdorner;
X.angle(X.angle()+Y);
X.rotate();
},selectedElements:function(){return this.diagram.select();
},createShape:function(){this.diagram.createShape();
},createConnection:function(){this.diagram.createConnection();
},undo:function(){this.diagram.undo();
},redo:function(){this.diagram.redo();
},destroy:function(){this.diagram=null;
this.element=null;
this.options=null;
if(this._toolBar){this._toolBar.destroy();
}if(this._popup){this._popup.destroy();
}}});
var Z=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.options=ab(true,{},this.options,Y);
this.element=X;
this.model=this.options.model;
this.fields=this._getFields();
this._initContainer();
this.createEditable();
},options:{editors:{}},_initContainer:function(){this.wrapper=this.element;
},createEditable:function(){var X=this.options;
this.editable=new kendo.ui.Editable(this.wrapper,{fields:this.fields,target:X.target,clearContainer:false,model:this.model});
},_isEditable:function(X){return this.model.editable&&this.model.editable(X);
},_getFields:function(){var bp=[];
var bq=this.model.fields;
for(var Y in bq){var br={};
if(this._isEditable(Y)){var X=this.options.editors[Y];
if(X){br.editor=X;
}br.field=Y;
bp.push(br);
}}return bp;
},end:function(){return this.editable.end();
},destroy:function(){this.editable.destroy();
this.editable.element.find("["+kendo.attr("container-for")+"]").empty();
this.model=this.wrapper=this.element=this.columns=this.editable=null;
}});
var aS=Z.extend({init:function(X,Y){Z.fn.init.call(this,X,Y);
this.bind(this.events,this.options);
this.open();
},events:["update","cancel"],options:{window:{modal:true,resizable:false,draggable:true,title:"Edit",visible:false}},_initContainer:function(){var Y=this;
this.wrapper=a('<div class="k-popup-edit-form"/>').attr(kendo.attr("uid"),this.model.uid);
var X="";
if(this.options.template){X+=this._renderTemplate();
this.fields=[];
}else{X+=this._renderFields();
}X+=this._renderButtons();
this.wrapper.append(a('<div class="k-edit-form-container"/>').append(X));
this.window=new kendo.ui.Window(this.wrapper,this.options.window);
this.window.bind("close",function(bp){if(bp.userTriggered){bp.sender.element.focus();
Y._cancelClick(bp);
}});
this._attachButtonEvents();
},_renderTemplate:function(){var X=this.options.template;
if(typeof X==="string"){X=window.unescape(X);
}X=kendo.template(X)(this.model);
return X;
},_renderFields:function(){var Y="";
for(var bp=0;
bp<this.fields.length;
bp++){var X=this.fields[bp];
Y+='<div class="k-edit-label"><label for="'+X.field+'">'+(X.field||"")+"</label></div>";
if(this._isEditable(X.field)){Y+="<div "+kendo.attr("container-for")+'="'+X.field+'" class="k-edit-field"></div>';
}}return Y;
},_renderButtons:function(){var X='<div class="k-edit-buttons k-state-default">';
X+=this._createButton("update");
X+=this._createButton("cancel");
X+="</div>";
return X;
},_createButton:function(X){return kendo.template(f)(M[X]);
},_attachButtonEvents:function(){this._cancelClickHandler=aT(this._cancelClick,this);
this.window.element.on(m+aL,"a.k-diagram-cancel",this._cancelClickHandler);
this._updateClickHandler=aT(this._updateClick,this);
this.window.element.on(m+aL,"a.k-diagram-update",this._updateClickHandler);
},_updateClick:function(X){X.preventDefault();
this.trigger("update");
},_cancelClick:function(X){X.preventDefault();
this.trigger("cancel");
},open:function(){this.window.center().open();
},close:function(){this.window.bind("deactivate",aT(this.destroy,this)).close();
},destroy:function(){this.window.close().destroy();
this.window.element.off(m+aL,"a.k-diagram-cancel",this._cancelClickHandler);
this.window.element.off(m+aL,"a.k-diagram-update",this._updateClickHandler);
this._cancelClickHandler=null;
this._editUpdateClickHandler=null;
this.window=null;
Z.fn.destroy.call(this);
}});
function t(X,bp){var br=bp.model.fields[bp.field];
var Y=this.dataSource.reader.model;
if(Y){var bq=Y.fn.fields.text?"text":Y.idField;
a("<input name='"+bp.field+"' />").appendTo(X).kendoDropDownList({dataValueField:Y.idField,dataTextField:bq,dataSource:this.dataSource.data().toJSON(),optionLabel:" ",valuePrimitive:true});
}}function aj(X){this.dataItem=X;
this.callbacks=[];
}aj.fn=aj.prototype={onActivate:function(X){var Y=a.Deferred();
this.callbacks.push({callback:X,deferred:Y});
return Y;
},activate:function(){var X=this.callbacks;
var bp;
for(var Y=0;
Y<X.length;
Y++){bp=this.callbacks[Y];
bp.callback(this.dataItem);
bp.deferred.resolve();
}this.callbacks=[];
}};
function ak(){this.items={};
}ak.fn=ak.prototype={add:function(Y){for(var X=0;
X<Y.length;
X++){this.items[Y[X].uid]=new aj(Y[X]);
}},forEach:function(X){for(var Y in this.items){X(this.items[Y]);
}},getByUid:function(X){return this.items[X];
},remove:function(X){delete this.items[X.uid];
}};
function n(X){var Y=X;
if(X instanceof kendo.data.Model){Y=X.toJSON();
Y[X.idField]=X._defaultId;
}return Y;
}function a5(bp){var X=[];
var br=[];
var Y,bq;
for(bq=0;
bq<bp.length;
bq++){Y=bp[bq];
if(Y instanceof a2){br.push(Y);
}else{X.push(Y);
}}return{shapes:br,connections:X};
}function w(X,Y){if(X.reader.model){return new X.reader.model(Y);
}return new kendo.data.ObservableObject(Y);
}y.ui.plugin(S);
z(R,{Shape:a2,Connection:q,Connector:u,DiagramToolBar:U});
})(window.kendo.jQuery);
return window.kendo;
},typeof define=="function"&&define.amd?define:function(a,b){b();
});
